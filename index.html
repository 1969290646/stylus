<a href="http://github.com/learnboost/switch"><img alt="Fork me on GitHub" id="ribbon" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a><html>
	<head>
		<title>Switch</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
		<style>body {
    margin: 0;
    padding: 0;
    font: 14px/1.5 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;
    color: #252519;
}
a {
    color: #252519;
}
a:hover {
    text-decoration: underline;
    color: #19469D;
}
p {
    margin: 12px 0;
}
h1, h2, h3 {
    margin: 0;
    padding: 0;
}
table#source {
    width: 100%;
    border-collapse: collapse;
}
table#source td:first-child {
    padding: 30px 40px 30px 40px;
    vertical-align: top;
}
table#source td:first-child,
table#source td:first-child pre {
    width: 450px;
}
table#source td:last-child {
    padding: 30px 0 30px 40px;
    border-left: 1px solid #E5E5EE;
    background: #F5F5FF;
}
table#source tr {
    border-bottom: 1px solid #E5E5EE;
}
table#source tr.filename {
    padding-top: 40px;
    border-top: 1px solid #E5E5EE;
}
table#source tr.filename td:first-child {
    text-transform: capitalize;
}
table#source tr.filename td:last-child {
    font-size: 12px;
}
table#source tr.filename h2 {
    margin: 0;
    padding: 0;
    cursor: pointer;
}
table#source tr.code h1,
table#source tr.code h2,
table#source tr.code h3 {
    margin-top: 30px;
    font-family: "Lucida Grande", "Helvetica Nueue", Arial, sans-serif;
    font-size: 18px;
}
table#source tr.code h2 {
    font-size: 16px;
}
table#source tr.code h3 {
    font-size: 14px;
}
table#source tr.code ul {
    margin: 15px 0 15px 35px;
    padding: 0;
}
table#source tr.code ul li {
    margin: 0;
    padding: 1px 0;
}
table#source tr.code ul li p {
    margin: 0;
    padding: 0;
}
table#source tr.code td:first-child pre {
    padding: 20px;
}
#ribbon {
    position: fixed;
    top: 0;
    right: 0;
}
code .string { color: #219161; }
code .regexp { color: #219161; }
code .keyword { color: #954121; }
code .number { color: #19469D; }
code .comment { color: #bbb; }
code .this { color: #19469D; }</style>
		<script>
			$(function(){
				$('tr.code').hide();
				$('tr.filename').toggle(function(){
					$(this).nextUntil('.filename').fadeIn();
				}, function(){
					$(this).nextUntil('.filename').fadeOut();
				});
			});
		</script>
	</head>
	<body>
<table id="source"><tbody><tr><td><h1>Switch</h1><p>Expressive CSS language for nodejs</p></td><td></td></tr><tr class="filename"><td><h2 id="lib/convert/css.js"><a href="#">css</a></h2></td><td>lib/convert/css.js</td></tr><tr class="code">
<td class="docs">
<p>Convert the given <code>css</code> to stylus source.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  css</p></li><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span>(<span class="variable">css</span>){
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Converter</span>(<span class="variable">css</span>).<span class="variable">stylus</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Converter</code> with the given <code>css</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  css</p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="class">Converter</span>(<span class="variable">css</span>) {
  <span class="keyword">var</span> <span class="variable">cssom</span> = <span class="variable">require</span>(<span class="string">'cssom'</span>);
  <span class="this">this</span>.<span class="variable">css</span> = <span class="variable">css</span>;
  <span class="this">this</span>.<span class="variable">types</span> = <span class="variable">cssom</span>.<span class="class">CSSRule</span>;
  <span class="this">this</span>.<span class="variable">root</span> = <span class="variable">cssom</span>.<span class="variable">parse</span>(<span class="variable">css</span>);
  <span class="this">this</span>.<span class="variable">indents</span> = <span class="number integer">0</span>;
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Convert to stylus.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Converter</span>.<span class="variable">prototype</span>.<span class="variable">stylus</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">visitRules</span>(<span class="this">this</span>.<span class="variable">root</span>.<span class="variable">cssRules</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return indent string.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Converter</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'indent'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="class">Array</span>(<span class="this">this</span>.<span class="variable">indents</span> + <span class="number integer">1</span>).<span class="variable">join</span>(<span class="string">'  '</span>);
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit <code>node</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>CSSRule</em>  node</p></li><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Converter</span>.<span class="variable">prototype</span>.<span class="variable">visit</span> = <span class="keyword">function</span>(<span class="variable">node</span>){
  <span class="keyword">switch</span> (<span class="variable">node</span>.<span class="variable">type</span>) {
    <span class="keyword">case</span> <span class="this">this</span>.<span class="variable">types</span>.<span class="class">STYLE_RULE</span>:
      <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">visitStyle</span>(<span class="variable">node</span>);
    <span class="keyword">case</span> <span class="this">this</span>.<span class="variable">types</span>.<span class="class">MEDIA_RULE</span>:
      <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">visitMedia</span>(<span class="variable">node</span>);
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit the rules on <code>node</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>CSSRule</em>  node</p></li><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Converter</span>.<span class="variable">prototype</span>.<span class="variable">visitRules</span> = <span class="keyword">function</span>(<span class="variable">node</span>){
  <span class="keyword">var</span> <span class="variable">buf</span> = <span class="string">''</span>;
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="variable">node</span>.<span class="variable">length</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
    <span class="variable">buf</span> += <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">node</span>[<span class="variable">i</span>]);
  }
  <span class="keyword">return</span> <span class="variable">buf</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit CSSMediaRule <code>node</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>CSSMediaRule</em>  node</p></li><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Converter</span>.<span class="variable">prototype</span>.<span class="variable">visitMedia</span> = <span class="keyword">function</span>(<span class="variable">node</span>){
  <span class="keyword">var</span> <span class="variable">buf</span> = <span class="this">this</span>.<span class="variable">indent</span> + <span class="string">'@media '</span>;
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="variable">node</span>.<span class="variable">media</span>.<span class="variable">length</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
    <span class="variable">buf</span> += <span class="variable">node</span>.<span class="variable">media</span>[<span class="variable">i</span>];
  }
  <span class="variable">buf</span> += <span class="string">'\n'</span>;
  ++<span class="this">this</span>.<span class="variable">indents</span>;
  <span class="variable">buf</span> += <span class="this">this</span>.<span class="variable">visitRules</span>(<span class="variable">node</span>.<span class="variable">cssRules</span>);
  --<span class="this">this</span>.<span class="variable">indents</span>;
  <span class="keyword">return</span> <span class="variable">buf</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit CSSStyleRule <code>node</code>.`</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>CSSStyleRule</em>  node</p></li><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Converter</span>.<span class="variable">prototype</span>.<span class="variable">visitStyle</span> = <span class="keyword">function</span>(<span class="variable">node</span>){
  <span class="keyword">var</span> <span class="variable">buf</span> = <span class="this">this</span>.<span class="variable">indent</span> + <span class="variable">node</span>.<span class="variable">selectorText</span> + <span class="string">'\n'</span>;
  ++<span class="this">this</span>.<span class="variable">indents</span>;
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="variable">node</span>.<span class="variable">style</span>.<span class="variable">length</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
    <span class="keyword">var</span> <span class="variable">prop</span> = <span class="variable">node</span>.<span class="variable">style</span>[<span class="variable">i</span>]
      , <span class="variable">val</span> = <span class="variable">node</span>.<span class="variable">style</span>[<span class="variable">prop</span>];
    <span class="keyword">if</span> (<span class="variable">prop</span>) {
      <span class="variable">buf</span> += <span class="this">this</span>.<span class="variable">indent</span> + <span class="variable">prop</span> + <span class="string">' '</span> + <span class="variable">val</span> + <span class="string">'\n'</span>;
    }
  }
  --<span class="this">this</span>.<span class="variable">indents</span>;
  <span class="keyword">return</span> <span class="variable">buf</span> + <span class="string">'\n'</span>;
};</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/functions/index.js"><a href="#">index</a></h2></td><td>lib/functions/index.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'../nodes'</span>)
  , <span class="variable">utils</span> = <span class="variable">require</span>(<span class="string">'../utils'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Convert the given <code>color</code> to an <code>HSLA</code> node,
or h,s,l,a component values.</p>

<h2>Examples</h2>

<p>   hsla(10deg, 50%, 30%, 0.5)
   // =&gt; HSLA</p>

<p>   hsla(#ffcc00)
   // =&gt; HSLA</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Color | Unit</em>  h</p></li><li><p><strong>param</strong>: <em>Unit</em>  s</p></li><li><p><strong>param</strong>: <em>Unit</em>  l</p></li><li><p><strong>param</strong>: <em>Unit</em>  a</p></li><li><p><strong>return</strong>: <em>HSLA</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">hsla</span> = <span class="keyword">function</span>(<span class="variable">h</span>,<span class="variable">s</span>,<span class="variable">l</span>,<span class="variable">a</span>){
  <span class="keyword">switch</span> (<span class="variable">arguments</span>.<span class="variable">length</span>) {
    <span class="keyword">case</span> <span class="number integer">1</span>:
      <span class="variable">utils</span>.<span class="variable">assertColor</span>(<span class="variable">h</span>);
      <span class="keyword">return</span> <span class="variable">h</span>.<span class="variable">hsl</span>;
    <span class="keyword">default</span>:
      <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">h</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'hue'</span>);
      <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">s</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'saturation'</span>);
      <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">l</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'lightness'</span>);
      <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">a</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'alpha'</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">HSLA</span>(<span class="variable">h</span>.<span class="variable">val</span>,<span class="variable">s</span>.<span class="variable">val</span>,<span class="variable">l</span>.<span class="variable">val</span>,<span class="variable">a</span>.<span class="variable">val</span>);
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Convert the given <code>color</code> to an <code>HSLA</code> node,
or h,s,l component values.</p>

<h2>Examples</h2>

<p>   hsl(10, 50, 30)
   // =&gt; HSLA</p>

<p>   hsl(#ffcc00)
   // =&gt; HSLA</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Color | Unit | HSLA</em>  h</p></li><li><p><strong>param</strong>: <em>Unit</em>  s</p></li><li><p><strong>param</strong>: <em>Unit</em>  l</p></li><li><p><strong>return</strong>: <em>HSLA</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">hsl</span> = <span class="keyword">function</span>(<span class="variable">h</span>,<span class="variable">s</span>,<span class="variable">l</span>){
  <span class="keyword">if</span> (<span class="variable">arguments</span>.<span class="variable">length</span> &<span class="variable">gt</span>; <span class="number integer">1</span>) {
    <span class="keyword">return</span> <span class="variable">exports</span>.<span class="variable">hsla</span>(<span class="variable">h</span>,<span class="variable">s</span>,<span class="variable">l</span>,<span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="number integer">1</span>));
  }
  <span class="variable">utils</span>.<span class="variable">assertColor</span>(<span class="variable">h</span>, <span class="string">'color'</span>);
  <span class="keyword">return</span> <span class="variable">h</span>.<span class="variable">hsl</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return type of <code>node</code>.</p>

<h2>Examples</h2>

<p>   type(12)
   // =&gt; 'unit'</p>

<p>   type(#fff)
   // =&gt; 'color'</p>

<p>   type(type)
   // =&gt; 'function'</p>

<p>   type(unbound)
   typeof(unbound)
   type-of(unbound)
   // =&gt; 'ident'</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  node</p></li><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">type</span> =
<span class="variable">exports</span>.<span class="keyword">typeof</span> =
<span class="variable">exports</span>[<span class="string">'type-of'</span>] = <span class="keyword">function</span>(<span class="variable">node</span>){
  <span class="variable">utils</span>.<span class="variable">assertPresent</span>(<span class="variable">node</span>, <span class="string">'expression'</span>);
  <span class="keyword">var</span> <span class="variable">type</span> = <span class="variable">node</span>.<span class="variable">nodeName</span>;
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">String</span>(<span class="variable">type</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return the hue of the given <code>color</code>.</p>

<h2>Examples</h2>

<p>   hue(hsl(50deg, 100%, 80%))
   // =&gt; 50deg</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>HSLA | Color</em>  color</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">hue</span> = <span class="keyword">function</span>(<span class="variable">color</span>){
  <span class="variable">utils</span>.<span class="variable">assertColor</span>(<span class="variable">color</span>, <span class="string">'hue'</span>);
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="class">Math</span>.<span class="variable">round</span>(<span class="variable">color</span>.<span class="variable">hsl</span>.<span class="variable">h</span>), <span class="string">'deg'</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return the saturation of the given <code>color</code>.</p>

<h2>Examples</h2>

<p>   saturation(hsl(50deg, 100%, 80%))
   // =&gt; 100%</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>HSLA | Color</em>  color</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">saturation</span> = <span class="keyword">function</span>(<span class="variable">color</span>){
  <span class="variable">utils</span>.<span class="variable">assertColor</span>(<span class="variable">color</span>, <span class="string">'saturation'</span>);
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="class">Math</span>.<span class="variable">round</span>(<span class="variable">color</span>.<span class="variable">hsl</span>.<span class="variable">s</span>), <span class="string">'%'</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return the lightness of the given <code>color</code>.</p>

<h2>Examples</h2>

<p>   lightness(hsl(50def, 100%, 80%))
   // =&gt; 80%</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>HSLA | Color</em>  color</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">lightness</span> = <span class="keyword">function</span>(<span class="variable">color</span>){
  <span class="variable">utils</span>.<span class="variable">assertColor</span>(<span class="variable">color</span>, <span class="string">'lightness'</span>);
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="class">Math</span>.<span class="variable">round</span>(<span class="variable">color</span>.<span class="variable">hsl</span>.<span class="variable">l</span>), <span class="string">'%'</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return the alpha component of the given <code>color</code>.</p>

<h2>Examples</h2>

<p>  alpha(#fff)
  // =&gt; 1</p>

<p>  alpha(rgba(0,0,0,0.3))
  // =&gt; 0.3</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Color | HSLA</em>  color</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">alpha</span> = <span class="keyword">function</span>(<span class="variable">color</span>){
  <span class="variable">utils</span>.<span class="variable">assertColor</span>(<span class="variable">color</span>, <span class="string">'alpha'</span>);
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">color</span>.<span class="variable">rgba</span>.<span class="variable">a</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return the red component of the given <code>color</code>.</p>

<h2>Examples</h2>

<p>   red(#c00)
   // =&gt; 204</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Color | HSLA</em>  color</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">red</span> = <span class="keyword">function</span>(<span class="variable">color</span>){
  <span class="variable">utils</span>.<span class="variable">assertColor</span>(<span class="variable">color</span>, <span class="string">'red'</span>);
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">color</span>.<span class="variable">rgba</span>.<span class="variable">r</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return the green component of the given <code>color</code>.</p>

<h2>Examples</h2>

<p>   green(#0c0)
   // =&gt; 204</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Color | HSLA</em>  color</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">green</span> = <span class="keyword">function</span>(<span class="variable">color</span>){
  <span class="variable">utils</span>.<span class="variable">assertColor</span>(<span class="variable">color</span>, <span class="string">'green'</span>);
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">color</span>.<span class="variable">rgba</span>.<span class="variable">g</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return the blue component of the given <code>color</code>.</p>

<h2>Examples</h2>

<p>   blue(#00c)
   // =&gt; 204</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Color | HSLA</em>  color</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">blue</span> = <span class="keyword">function</span>(<span class="variable">color</span>){
  <span class="variable">utils</span>.<span class="variable">assertColor</span>(<span class="variable">color</span>, <span class="string">'blue'</span>);
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">color</span>.<span class="variable">rgba</span>.<span class="variable">b</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a <code>Color</code> from the r,g,b,a channels.</p>

<h2>Examples</h2>

<p>   rgba(255,0,0,0.5)
   // =&gt; rgba(255,0,0,0.5)</p>

<p>   rgba(255,0,0,1)
   // =&gt; #ff0000</p>

<p>   rgba(#ffcc00, 0.5)
   // rgba(255,204,0,0.5)</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Unit | Color | HSLA</em>  r</p></li><li><p><strong>param</strong>: <em>Unit</em>  g</p></li><li><p><strong>param</strong>: <em>Unit</em>  b</p></li><li><p><strong>param</strong>: <em>Unit</em>  a</p></li><li><p><strong>return</strong>: <em>Color</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">rgba</span> = <span class="keyword">function</span>(<span class="variable">r</span>,<span class="variable">g</span>,<span class="variable">b</span>,<span class="variable">a</span>){
  <span class="keyword">switch</span> (<span class="variable">arguments</span>.<span class="variable">length</span>) {
    <span class="keyword">case</span> <span class="number integer">1</span>:
      <span class="variable">utils</span>.<span class="variable">assertColor</span>(<span class="variable">r</span>);
      <span class="keyword">var</span> <span class="variable">color</span> = <span class="variable">r</span>.<span class="variable">rgba</span>;
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Color</span>(
          <span class="variable">color</span>.<span class="variable">r</span>
        , <span class="variable">color</span>.<span class="variable">g</span>
        , <span class="variable">color</span>.<span class="variable">b</span>
        , <span class="variable">color</span>.<span class="variable">a</span>);
    <span class="keyword">case</span> <span class="number integer">2</span>:
      <span class="variable">utils</span>.<span class="variable">assertColor</span>(<span class="variable">r</span>);
      <span class="keyword">var</span> <span class="variable">color</span> = <span class="variable">r</span>.<span class="variable">rgba</span>;
      <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">g</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Color</span>(
          <span class="variable">color</span>.<span class="variable">r</span>
        , <span class="variable">color</span>.<span class="variable">g</span>
        , <span class="variable">color</span>.<span class="variable">b</span>
        , <span class="variable">g</span>.<span class="variable">val</span>);
    <span class="keyword">default</span>:
      <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">r</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'red'</span>);
      <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">g</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'green'</span>);
      <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">b</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'blue'</span>);
      <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">a</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'alpha'</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Color</span>(
          <span class="variable">r</span>.<span class="variable">val</span>
        , <span class="variable">g</span>.<span class="variable">val</span>
        , <span class="variable">b</span>.<span class="variable">val</span>
        , <span class="variable">a</span>.<span class="variable">val</span>);
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a <code>Color</code> from the r,g,b channels.</p>

<h2>Examples</h2>

<p>   rgb(255,204,0)
   // =&gt; #ffcc00</p>

<p>   rgb(#fff)
   // =&gt; #fff</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Unit | Color | HSLA</em>  r</p></li><li><p><strong>param</strong>: <em>Unit</em>  g</p></li><li><p><strong>param</strong>: <em>Unit</em>  b</p></li><li><p><strong>return</strong>: <em>Color</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">rgb</span> = <span class="keyword">function</span>(<span class="variable">r</span>,<span class="variable">g</span>,<span class="variable">b</span>){
  <span class="keyword">switch</span> (<span class="variable">arguments</span>.<span class="variable">length</span>) {
    <span class="keyword">case</span> <span class="number integer">1</span>:
      <span class="variable">utils</span>.<span class="variable">assertColor</span>(<span class="variable">r</span>);
      <span class="keyword">var</span> <span class="variable">color</span> = <span class="variable">r</span>.<span class="variable">rgba</span>;
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Color</span>(
          <span class="variable">color</span>.<span class="variable">r</span>
        , <span class="variable">color</span>.<span class="variable">g</span>
        , <span class="variable">color</span>.<span class="variable">b</span>
        , <span class="number integer">1</span>);
    <span class="keyword">default</span>:
      <span class="keyword">return</span> <span class="variable">exports</span>.<span class="variable">rgba</span>(<span class="variable">r</span>,<span class="variable">g</span>,<span class="variable">b</span>,<span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="number integer">1</span>));
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Unquote the given <code>str</code>.</p>

<h2>Examples</h2>

<p>   unquote("sans-serif")
   // =&gt; sans-serif</p>

<p>   unquote(sans-serif)
   // =&gt; sans-serif</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String | Ident</em>  val</p></li><li><p><strong>return</strong>: <em>Ident</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">unquote</span> = <span class="keyword">function</span>(<span class="variable">val</span>){
  <span class="variable">utils</span>.<span class="variable">assertString</span>(<span class="variable">val</span>, <span class="string">'string'</span>);
  <span class="keyword">return</span> <span class="variable">val</span>.<span class="variable">string</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Absolute value of <code>n</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Unit</em>  n</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">abs</span> = <span class="keyword">function</span>(<span class="variable">n</span>){
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">n</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'unit'</span>);
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="class">Math</span>.<span class="variable">abs</span>(<span class="variable">n</span>.<span class="variable">val</span>), <span class="variable">n</span>.<span class="variable">type</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Nearest integer above <code>n</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Unit</em>  n</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">ceil</span> = <span class="keyword">function</span>(<span class="variable">n</span>){
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">n</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'unit'</span>);
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="class">Math</span>.<span class="variable">ceil</span>(<span class="variable">n</span>.<span class="variable">val</span>), <span class="variable">n</span>.<span class="variable">type</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Nearest integer below <code>n</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Unit</em>  n</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">floor</span> = <span class="keyword">function</span>(<span class="variable">n</span>){
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">n</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'unit'</span>);
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="class">Math</span>.<span class="variable">floor</span>(<span class="variable">n</span>.<span class="variable">val</span>), <span class="variable">n</span>.<span class="variable">type</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Round <code>n</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Unit</em>  n</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">round</span> = <span class="keyword">function</span>(<span class="variable">n</span>){
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">n</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'unit'</span>);
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="class">Math</span>.<span class="variable">round</span>(<span class="variable">n</span>.<span class="variable">val</span>), <span class="variable">n</span>.<span class="variable">type</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Min of <code>a</code> and <code>b</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Unit</em>  a</p></li><li><p><strong>param</strong>: <em>Unit</em>  b</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">min</span> = <span class="keyword">function</span>(<span class="variable">a</span>, <span class="variable">b</span>){
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">a</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'a'</span>);
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">b</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'b'</span>);
  <span class="keyword">return</span> <span class="variable">a</span>.<span class="variable">val</span> &<span class="variable">lt</span>; <span class="variable">b</span>.<span class="variable">val</span> ? <span class="variable">a</span> : <span class="variable">b</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Max of <code>a</code> and <code>b</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Unit</em>  a</p></li><li><p><strong>param</strong>: <em>Unit</em>  b</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">max</span> = <span class="keyword">function</span>(<span class="variable">a</span>, <span class="variable">b</span>){
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">a</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'a'</span>);
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">b</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'b'</span>);
  <span class="keyword">return</span> <span class="variable">a</span>.<span class="variable">val</span> &<span class="variable">gt</span>; <span class="variable">b</span>.<span class="variable">val</span> ? <span class="variable">a</span> : <span class="variable">b</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Check if <code>n</code> is even.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Unit</em>  n</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">even</span> = <span class="keyword">function</span>(<span class="variable">n</span>){
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">n</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'unit'</span>);
  <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="class">Boolean</span>(<span class="number integer">0</span> == <span class="variable">n</span> % <span class="number integer">2</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Check if <code>n</code> is odd.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Unit</em>  n</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">odd</span> = <span class="keyword">function</span>(<span class="variable">n</span>){
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">n</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'unit'</span>);
  <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="class">Boolean</span>(<span class="number integer">1</span> == <span class="variable">n</span> % <span class="number integer">2</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Lighten <code>color</code> by <code>amount</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Color | HSLA</em>  color</p></li><li><p><strong>param</strong>: <em>Unit</em>  amount</p></li><li><p><strong>return</strong>: <em>HSLA</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">lighten</span> = <span class="keyword">function</span>(<span class="variable">color</span>, <span class="variable">amount</span>){
  <span class="variable">utils</span>.<span class="variable">assertColor</span>(<span class="variable">color</span>, <span class="string">'color'</span>);
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">amount</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'amount'</span>);
  <span class="keyword">var</span> <span class="variable">hsl</span> = <span class="variable">color</span>.<span class="variable">hsl</span>;
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">HSLA</span>(
      <span class="variable">hsl</span>.<span class="variable">h</span>
    , <span class="variable">hsl</span>.<span class="variable">s</span>
    , <span class="variable">hsl</span>.<span class="variable">l</span> + <span class="variable">amount</span>.<span class="variable">val</span>
    , <span class="variable">hsl</span>.<span class="variable">a</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Darken <code>color</code> by <code>amount</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Color | HSLA</em>  color</p></li><li><p><strong>param</strong>: <em>Unit</em>  amount</p></li><li><p><strong>return</strong>: <em>HSLA</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">darken</span> = <span class="keyword">function</span>(<span class="variable">color</span>, <span class="variable">amount</span>){
  <span class="variable">utils</span>.<span class="variable">assertColor</span>(<span class="variable">color</span>, <span class="string">'color'</span>);
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">amount</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'amount'</span>);
  <span class="keyword">var</span> <span class="variable">hsl</span> = <span class="variable">color</span>.<span class="variable">hsl</span>;
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">HSLA</span>(
      <span class="variable">hsl</span>.<span class="variable">h</span>
    , <span class="variable">hsl</span>.<span class="variable">s</span>
    , <span class="variable">hsl</span>.<span class="variable">l</span> - <span class="variable">amount</span>.<span class="variable">val</span>
    , <span class="variable">hsl</span>.<span class="variable">a</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Assign <code>type</code> to the given <code>unit</code> or return <code>unit</code>'s type.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Unit</em>  unit</p></li><li><p><strong>param</strong>: <em>String | Ident</em>  type</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">unit</span> = <span class="keyword">function</span>(<span class="variable">unit</span>, <span class="variable">type</span>){
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">unit</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>, <span class="string">'unit'</span>);

  <span class="comment">// Assign</span>
  <span class="keyword">if</span> (<span class="variable">type</span>) {
    <span class="variable">utils</span>.<span class="variable">assertString</span>(<span class="variable">type</span>, <span class="string">'type'</span>);
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">unit</span>.<span class="variable">val</span>, <span class="variable">type</span>.<span class="variable">string</span>);
  } <span class="keyword">else</span> {
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">String</span>(<span class="variable">unit</span>.<span class="variable">type</span> || <span class="string">''</span>);
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Lookup variable <code>name</code> or return Null.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>return</strong>: <em>Mixed</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">lookup</span> = <span class="keyword">function</span>(<span class="variable">name</span>){
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">name</span>, <span class="variable">nodes</span>.<span class="class">String</span>, <span class="string">'name'</span>);
  <span class="keyword">var</span> <span class="variable">node</span> = <span class="this">this</span>.<span class="variable">lookup</span>(<span class="variable">name</span>.<span class="variable">val</span>);
  <span class="keyword">if</span> (!<span class="variable">node</span>) <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="keyword">null</span>;
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">node</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Perform <code>op</code> on the <code>left</code> and <code>right</code> operands.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  op</p></li><li><p><strong>param</strong>: <em>Node</em>  left</p></li><li><p><strong>param</strong>: <em>Node</em>  right</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">operate</span> = <span class="keyword">function</span>(<span class="variable">op</span>, <span class="variable">left</span>, <span class="variable">right</span>){
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">op</span>, <span class="variable">nodes</span>.<span class="class">String</span>, <span class="string">'op'</span>);
  <span class="variable">utils</span>.<span class="variable">assertPresent</span>(<span class="variable">left</span>, <span class="string">'left'</span>);
  <span class="variable">utils</span>.<span class="variable">assertPresent</span>(<span class="variable">right</span>, <span class="string">'right'</span>);
  <span class="keyword">return</span> <span class="variable">left</span>.<span class="variable">operate</span>(<span class="variable">op</span>.<span class="variable">val</span>, <span class="variable">right</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Test if <code>val</code> matches the given <code>pattern</code>.</p>

<h2>Examples</h2>

<pre><code>match('^foo(bar)?', foo)
match('^foo(bar)?', foobar)
match('^foo(bar)?', 'foo')
match('^foo(bar)?', 'foobar')
// =&gt; true

match('^foo(bar)?', 'bar')
// =&gt; false</code></pre>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  pattern</p></li><li><p><strong>param</strong>: <em>String | Ident</em>  val</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">match</span> = <span class="keyword">function</span>(<span class="variable">pattern</span>, <span class="variable">val</span>){
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">pattern</span>, <span class="variable">nodes</span>.<span class="class">String</span>, <span class="string">'pattern'</span>);
  <span class="variable">utils</span>.<span class="variable">assertString</span>(<span class="variable">val</span>, <span class="string">'val'</span>);
  <span class="keyword">var</span> <span class="variable">re</span> = <span class="keyword">new</span> <span class="class">RegExp</span>(<span class="variable">pattern</span>.<span class="variable">val</span>);
  <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="class">Boolean</span>(<span class="variable">re</span>.<span class="variable">test</span>(<span class="variable">val</span>.<span class="variable">string</span>));
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return length of the given <code>expr</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Expression</em>  expr</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code>(<span class="variable">exports</span>.<span class="variable">length</span> = <span class="keyword">function</span>(<span class="variable">expr</span>){
  <span class="keyword">if</span> (<span class="variable">expr</span>) {
    <span class="keyword">if</span> (<span class="variable">expr</span>.<span class="variable">nodes</span>) {
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">expr</span>.<span class="variable">nodes</span>.<span class="variable">length</span>);
    } <span class="keyword">else</span> {
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="number integer">1</span>);
    }
  }
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="number integer">0</span>);
}).<span class="variable">tuple</span> = <span class="variable">true</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Throw an error with the given <code>msg</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  msg</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">error</span> = <span class="keyword">function</span>(<span class="variable">msg</span>){
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">msg</span>, <span class="variable">nodes</span>.<span class="class">String</span>, <span class="string">'msg'</span>);
  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="variable">msg</span>.<span class="variable">val</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Warn with the given <code>msg</code> prefixed by "Warning: ".</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  msg</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">warn</span> = <span class="keyword">function</span>(<span class="variable">msg</span>){
  <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">msg</span>, <span class="variable">nodes</span>.<span class="class">String</span>, <span class="string">'msg'</span>);
  <span class="variable">console</span>.<span class="variable">warn</span>(<span class="string">'Warning: %s'</span>, <span class="variable">msg</span>.<span class="variable">val</span>);
  <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="keyword">null</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Output stack trace.</p>

<ul><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">trace</span> = <span class="keyword">function</span>(){
  <span class="variable">console</span>.<span class="variable">log</span>(<span class="this">this</span>.<span class="variable">stack</span>);
  <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="keyword">null</span>;
};</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/functions/url.js"><a href="#">url</a></h2></td><td>lib/functions/url.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'../nodes'</span>)
  , <span class="variable">parse</span> = <span class="variable">require</span>(<span class="string">'url'</span>).<span class="variable">parse</span>
  , <span class="variable">extname</span> = <span class="variable">require</span>(<span class="string">'path'</span>).<span class="variable">extname</span>
  , <span class="variable">fs</span> = <span class="variable">require</span>(<span class="string">'fs'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Mime table.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">mimes</span> = {
    <span class="string">'.gif'</span>: <span class="string">'image/gif'</span>
  , <span class="string">'.png'</span>: <span class="string">'image/png'</span>
  , <span class="string">'.jpg'</span>: <span class="string">'image/jpeg'</span>
  , <span class="string">'.jpeg'</span>: <span class="string">'image/jpeg'</span>
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a url() function with the given <code>options</code>.</p>

<h2>Options</h2>

<ul><li><code>limit</code> bytesize limit defaulting to 30Kb</li><li><code>paths</code> image resolution path(s), defaults to CWD</li></ul>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  options</p></li><li><p><strong>return</strong>: <em>Function</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span>(<span class="variable">options</span>) {
  <span class="variable">options</span> = <span class="variable">options</span> || {};

  <span class="keyword">var</span> <span class="variable">sizeLimit</span> = <span class="variable">options</span>.<span class="variable">limit</span> || <span class="number integer">30000</span>
    , <span class="variable">paths</span> = <span class="variable">options</span>.<span class="variable">paths</span> || [<span class="variable">process</span>.<span class="variable">cwd</span>()];

  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="variable">url</span>){
    <span class="keyword">var</span> <span class="variable">buf</span>
      , <span class="variable">url</span> = <span class="variable">parse</span>(<span class="variable">url</span>.<span class="variable">val</span>)
      , <span class="variable">ext</span> = <span class="variable">extname</span>(<span class="variable">url</span>.<span class="variable">pathname</span>)
      , <span class="variable">mime</span> = <span class="variable">mimes</span>[<span class="variable">ext</span>]
      , <span class="variable">literal</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Ident</span>(<span class="string">'url(&quot;'</span> + <span class="variable">url</span>.<span class="variable">href</span> + <span class="string">'&quot;)'</span>);

    <span class="comment">// Not supported</span>
    <span class="keyword">if</span> (!<span class="variable">mime</span>) <span class="keyword">return</span> <span class="variable">literal</span>;

    <span class="comment">// Absolute</span>
    <span class="keyword">if</span> (<span class="variable">url</span>.<span class="variable">protocol</span>) <span class="keyword">return</span> <span class="variable">literal</span>;

    <span class="comment">// Lookup</span>
    <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">paths</span>.<span class="variable">length</span>; ++<span class="variable">i</span>) {
      <span class="keyword">try</span> {
        <span class="keyword">var</span> <span class="variable">path</span> = <span class="variable">paths</span>[<span class="variable">i</span>] + <span class="string">'/'</span> + <span class="variable">url</span>.<span class="variable">pathname</span>;
        <span class="variable">buf</span> = <span class="variable">fs</span>.<span class="variable">readFileSync</span>(<span class="variable">path</span>);
        <span class="keyword">break</span>;
      } <span class="keyword">catch</span> (<span class="variable">err</span>) {
        <span class="comment">// Ignore</span>
      }
    }

    <span class="comment">// Failed to lookup</span>
    <span class="keyword">if</span> (!<span class="variable">buf</span>) <span class="keyword">return</span> <span class="variable">literal</span>;

    <span class="comment">// To large</span>
    <span class="keyword">if</span> (<span class="variable">buf</span>.<span class="variable">length</span> &<span class="variable">gt</span>; <span class="variable">sizeLimit</span>) <span class="keyword">return</span> <span class="variable">literal</span>;

    <span class="comment">// Encode</span>
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">String</span>(<span class="string">'data:'</span> + <span class="variable">mime</span> + <span class="string">';base64,'</span> + <span class="variable">buf</span>.<span class="variable">toString</span>(<span class="string">'base64'</span>));
  }
};</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/lexer.js"><a href="#">lexer</a></h2></td><td>lib/lexer.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Token</span> = <span class="variable">require</span>(<span class="string">'./token'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./nodes'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Operator aliases.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">alias</span> = {
    <span class="variable">and</span>: <span class="string">'&amp;&amp;'</span>
  , <span class="variable">or</span>: <span class="string">'||'</span>
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Numeric strings used for exceptions.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">numberString</span> = [, <span class="string">'one'</span>, <span class="string">'two'</span>];</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Units.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">units</span> = [
    <span class="string">'em'</span>
  , <span class="string">'ex'</span>
  , <span class="string">'px'</span>
  , <span class="string">'mm'</span>
  , <span class="string">'cm'</span>
  , <span class="string">'in'</span>
  , <span class="string">'pt'</span>
  , <span class="string">'pc'</span>
  , <span class="string">'deg'</span>
  , <span class="string">'rad'</span>
  , <span class="string">'grad'</span>
  , <span class="string">'ms'</span>
  , <span class="string">'s'</span>
  , <span class="string">'Hz'</span>
  , <span class="string">'kHz'</span>
  , <span class="string">'%'</span>].<span class="variable">join</span>(<span class="string">'|'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Unit RegExp.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">unit</span> = <span class="keyword">new</span> <span class="class">RegExp</span>(<span class="string">'^(\\d+\\.\\d+|\\d+|\\.\\d+)('</span> + <span class="variable">units</span> + <span class="string">')? *'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Color names.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">colors</span> = {
    <span class="variable">aliceblue</span>: [<span class="number integer">240</span>, <span class="number integer">248</span>, <span class="number integer">255</span>]
  , <span class="variable">antiquewhite</span>: [<span class="number integer">250</span>, <span class="number integer">235</span>, <span class="number integer">215</span>]
  , <span class="variable">aqua</span>: [<span class="number integer">0</span>, <span class="number integer">255</span>, <span class="number integer">255</span>]
  , <span class="variable">aquamarine</span>: [<span class="number integer">127</span>, <span class="number integer">255</span>, <span class="number integer">212</span>]
  , <span class="variable">azure</span>: [<span class="number integer">240</span>, <span class="number integer">255</span>, <span class="number integer">255</span>]
  , <span class="variable">beige</span>: [<span class="number integer">245</span>, <span class="number integer">245</span>, <span class="number integer">220</span>]
  , <span class="variable">bisque</span>: [<span class="number integer">255</span>, <span class="number integer">228</span>, <span class="number integer">196</span>]
  , <span class="variable">black</span>: [<span class="number integer">0</span>, <span class="number integer">0</span>, <span class="number integer">0</span>]
  , <span class="variable">blanchedalmond</span>: [<span class="number integer">255</span>, <span class="number integer">235</span>, <span class="number integer">205</span>]
  , <span class="variable">blue</span>: [<span class="number integer">0</span>, <span class="number integer">0</span>, <span class="number integer">255</span>]
  , <span class="variable">blueviolet</span>: [<span class="number integer">138</span>, <span class="number integer">43</span>, <span class="number integer">226</span>]
  , <span class="variable">brown</span>: [<span class="number integer">165</span>, <span class="number integer">42</span>, <span class="number integer">42</span>]
  , <span class="variable">burlywood</span>: [<span class="number integer">222</span>, <span class="number integer">184</span>, <span class="number integer">135</span>]
  , <span class="variable">cadetblue</span>: [<span class="number integer">95</span>, <span class="number integer">158</span>, <span class="number integer">160</span>]
  , <span class="variable">chartreuse</span>: [<span class="number integer">127</span>, <span class="number integer">255</span>, <span class="number integer">0</span>]
  , <span class="variable">chocolate</span>: [<span class="number integer">210</span>, <span class="number integer">105</span>, <span class="number integer">30</span>]
  , <span class="variable">coral</span>: [<span class="number integer">255</span>, <span class="number integer">127</span>, <span class="number integer">80</span>]
  , <span class="variable">cornflowerblue</span>: [<span class="number integer">100</span>, <span class="number integer">149</span>, <span class="number integer">237</span>]
  , <span class="variable">cornsilk</span>: [<span class="number integer">255</span>, <span class="number integer">248</span>, <span class="number integer">220</span>]
  , <span class="variable">crimson</span>: [<span class="number integer">220</span>, <span class="number integer">20</span>, <span class="number integer">60</span>]
  , <span class="variable">cyan</span>: [<span class="number integer">0</span>, <span class="number integer">255</span>, <span class="number integer">255</span>]
  , <span class="variable">darkblue</span>: [<span class="number integer">0</span>, <span class="number integer">0</span>, <span class="number integer">139</span>]
  , <span class="variable">darkcyan</span>: [<span class="number integer">0</span>, <span class="number integer">139</span>, <span class="number integer">139</span>]
  , <span class="variable">darkgoldenrod</span>: [<span class="number integer">184</span>, <span class="number integer">132</span>, <span class="number integer">11</span>]
  , <span class="variable">darkgray</span>: [<span class="number integer">169</span>, <span class="number integer">169</span>, <span class="number integer">169</span>]
  , <span class="variable">darkgreen</span>: [<span class="number integer">0</span>, <span class="number integer">100</span>, <span class="number integer">0</span>]
  , <span class="variable">darkgrey</span>: [<span class="number integer">169</span>, <span class="number integer">169</span>, <span class="number integer">169</span>]
  , <span class="variable">darkkhaki</span>: [<span class="number integer">189</span>, <span class="number integer">183</span>, <span class="number integer">107</span>]
  , <span class="variable">darkmagenta</span>: [<span class="number integer">139</span>, <span class="number integer">0</span>, <span class="number integer">139</span>]
  , <span class="variable">darkolivegreen</span>: [<span class="number integer">85</span>, <span class="number integer">107</span>, <span class="number integer">47</span>]
  , <span class="variable">darkorange</span>: [<span class="number integer">255</span>, <span class="number integer">140</span>, <span class="number integer">0</span>]
  , <span class="variable">darkorchid</span>: [<span class="number integer">153</span>, <span class="number integer">50</span>, <span class="number integer">204</span>]
  , <span class="variable">darkred</span>: [<span class="number integer">139</span>, <span class="number integer">0</span>, <span class="number integer">0</span>]
  , <span class="variable">darksalmon</span>: [<span class="number integer">233</span>, <span class="number integer">150</span>, <span class="number integer">122</span>]
  , <span class="variable">darkseagreen</span>: [<span class="number integer">143</span>, <span class="number integer">188</span>, <span class="number integer">143</span>]
  , <span class="variable">darkslateblue</span>: [<span class="number integer">72</span>, <span class="number integer">61</span>, <span class="number integer">139</span>]
  , <span class="variable">darkslategray</span>: [<span class="number integer">47</span>, <span class="number integer">79</span>, <span class="number integer">79</span>]
  , <span class="variable">darkslategrey</span>: [<span class="number integer">47</span>, <span class="number integer">79</span>, <span class="number integer">79</span>]
  , <span class="variable">darkturquoise</span>: [<span class="number integer">0</span>, <span class="number integer">206</span>, <span class="number integer">209</span>]
  , <span class="variable">darkviolet</span>: [<span class="number integer">148</span>, <span class="number integer">0</span>, <span class="number integer">211</span>]
  , <span class="variable">deeppink</span>: [<span class="number integer">255</span>, <span class="number integer">20</span>, <span class="number integer">147</span>]
  , <span class="variable">deepskyblue</span>: [<span class="number integer">0</span>, <span class="number integer">191</span>, <span class="number integer">255</span>]
  , <span class="variable">dimgray</span>: [<span class="number integer">105</span>, <span class="number integer">105</span>, <span class="number integer">105</span>]
  , <span class="variable">dimgrey</span>: [<span class="number integer">105</span>, <span class="number integer">105</span>, <span class="number integer">105</span>]
  , <span class="variable">dodgerblue</span>: [<span class="number integer">30</span>, <span class="number integer">144</span>, <span class="number integer">255</span>]
  , <span class="variable">firebrick</span>: [<span class="number integer">178</span>, <span class="number integer">34</span>, <span class="number integer">34</span>]
  , <span class="variable">floralwhite</span>: [<span class="number integer">255</span>, <span class="number integer">255</span>, <span class="number integer">240</span>]
  , <span class="variable">forestgreen</span>: [<span class="number integer">34</span>, <span class="number integer">139</span>, <span class="number integer">34</span>]
  , <span class="variable">fuchsia</span>: [<span class="number integer">255</span>, <span class="number integer">0</span>, <span class="number integer">255</span>]
  , <span class="variable">gainsboro</span>: [<span class="number integer">220</span>, <span class="number integer">220</span>, <span class="number integer">220</span>]
  , <span class="variable">ghostwhite</span>: [<span class="number integer">248</span>, <span class="number integer">248</span>, <span class="number integer">255</span>]
  , <span class="variable">gold</span>: [<span class="number integer">255</span>, <span class="number integer">215</span>, <span class="number integer">0</span>]
  , <span class="variable">goldenrod</span>: [<span class="number integer">218</span>, <span class="number integer">165</span>, <span class="number integer">32</span>]
  , <span class="variable">gray</span>: [<span class="number integer">128</span>, <span class="number integer">128</span>, <span class="number integer">128</span>]
  , <span class="variable">green</span>: [<span class="number integer">0</span>, <span class="number integer">128</span>, <span class="number integer">0</span>]
  , <span class="variable">greenyellow</span>: [<span class="number integer">173</span>, <span class="number integer">255</span>, <span class="number integer">47</span>]
  , <span class="variable">grey</span>: [<span class="number integer">128</span>, <span class="number integer">128</span>, <span class="number integer">128</span>]
  , <span class="variable">honeydew</span>: [<span class="number integer">240</span>, <span class="number integer">255</span>, <span class="number integer">240</span>]
  , <span class="variable">hotpink</span>: [<span class="number integer">255</span>, <span class="number integer">105</span>, <span class="number integer">180</span>]
  , <span class="variable">indianred</span>: [<span class="number integer">205</span>, <span class="number integer">92</span>, <span class="number integer">92</span>]
  , <span class="variable">indigo</span>: [<span class="number integer">75</span>, <span class="number integer">0</span>, <span class="number integer">130</span>]
  , <span class="variable">ivory</span>: [<span class="number integer">255</span>, <span class="number integer">255</span>, <span class="number integer">240</span>]
  , <span class="variable">khaki</span>: [<span class="number integer">240</span>, <span class="number integer">230</span>, <span class="number integer">140</span>]
  , <span class="variable">lavender</span>: [<span class="number integer">230</span>, <span class="number integer">230</span>, <span class="number integer">250</span>]
  , <span class="variable">lavenderblush</span>: [<span class="number integer">255</span>, <span class="number integer">240</span>, <span class="number integer">245</span>]
  , <span class="variable">lawngreen</span>: [<span class="number integer">124</span>, <span class="number integer">252</span>, <span class="number integer">0</span>]
  , <span class="variable">lemonchiffon</span>: [<span class="number integer">255</span>, <span class="number integer">250</span>, <span class="number integer">205</span>]
  , <span class="variable">lightblue</span>: [<span class="number integer">173</span>, <span class="number integer">216</span>, <span class="number integer">230</span>]
  , <span class="variable">lightcoral</span>: [<span class="number integer">240</span>, <span class="number integer">128</span>, <span class="number integer">128</span>]
  , <span class="variable">lightcyan</span>: [<span class="number integer">224</span>, <span class="number integer">255</span>, <span class="number integer">255</span>]
  , <span class="variable">lightgoldenrodyellow</span>: [<span class="number integer">250</span>, <span class="number integer">250</span>, <span class="number integer">210</span>]
  , <span class="variable">lightgray</span>: [<span class="number integer">211</span>, <span class="number integer">211</span>, <span class="number integer">211</span>]
  , <span class="variable">lightgreen</span>: [<span class="number integer">144</span>, <span class="number integer">238</span>, <span class="number integer">144</span>]
  , <span class="variable">lightgrey</span>: [<span class="number integer">211</span>, <span class="number integer">211</span>, <span class="number integer">211</span>]
  , <span class="variable">lightpink</span>: [<span class="number integer">255</span>, <span class="number integer">182</span>, <span class="number integer">193</span>]
  , <span class="variable">lightsalmon</span>: [<span class="number integer">255</span>, <span class="number integer">160</span>, <span class="number integer">122</span>]
  , <span class="variable">lightseagreen</span>: [<span class="number integer">32</span>, <span class="number integer">178</span>, <span class="number integer">170</span>]
  , <span class="variable">lightskyblue</span>: [<span class="number integer">135</span>, <span class="number integer">206</span>, <span class="number integer">250</span>]
  , <span class="variable">lightslategray</span>: [<span class="number integer">119</span>, <span class="number integer">136</span>, <span class="number integer">153</span>]
  , <span class="variable">lightslategrey</span>: [<span class="number integer">119</span>, <span class="number integer">136</span>, <span class="number integer">153</span>]
  , <span class="variable">lightsteelblue</span>: [<span class="number integer">176</span>, <span class="number integer">196</span>, <span class="number integer">222</span>]
  , <span class="variable">lightyellow</span>: [<span class="number integer">255</span>, <span class="number integer">255</span>, <span class="number integer">224</span>]
  , <span class="variable">lime</span>: [<span class="number integer">0</span>, <span class="number integer">255</span>, <span class="number integer">0</span>]
  , <span class="variable">limegreen</span>: [<span class="number integer">50</span>, <span class="number integer">205</span>, <span class="number integer">50</span>]
  , <span class="variable">linen</span>: [<span class="number integer">250</span>, <span class="number integer">240</span>, <span class="number integer">230</span>]
  , <span class="variable">magenta</span>: [<span class="number integer">255</span>, <span class="number integer">0</span>, <span class="number integer">255</span>]
  , <span class="variable">maroon</span>: [<span class="number integer">128</span>, <span class="number integer">0</span>, <span class="number integer">0</span>]
  , <span class="variable">mediumaquamarine</span>: [<span class="number integer">102</span>, <span class="number integer">205</span>, <span class="number integer">170</span>]
  , <span class="variable">mediumblue</span>: [<span class="number integer">0</span>, <span class="number integer">0</span>, <span class="number integer">205</span>]
  , <span class="variable">mediumorchid</span>: [<span class="number integer">186</span>, <span class="number integer">85</span>, <span class="number integer">211</span>]
  , <span class="variable">mediumpurple</span>: [<span class="number integer">147</span>, <span class="number integer">112</span>, <span class="number integer">219</span>]
  , <span class="variable">mediumseagreen</span>: [<span class="number integer">60</span>, <span class="number integer">179</span>, <span class="number integer">113</span>]
  , <span class="variable">mediumslateblue</span>: [<span class="number integer">123</span>, <span class="number integer">104</span>, <span class="number integer">238</span>]
  , <span class="variable">mediumspringgreen</span>: [<span class="number integer">0</span>, <span class="number integer">250</span>, <span class="number integer">154</span>]
  , <span class="variable">mediumturquoise</span>: [<span class="number integer">72</span>, <span class="number integer">209</span>, <span class="number integer">204</span>]
  , <span class="variable">mediumvioletred</span>: [<span class="number integer">199</span>, <span class="number integer">21</span>, <span class="number integer">133</span>]
  , <span class="variable">midnightblue</span>: [<span class="number integer">25</span>, <span class="number integer">25</span>, <span class="number integer">112</span>]
  , <span class="variable">mintcream</span>: [<span class="number integer">245</span>, <span class="number integer">255</span>, <span class="number integer">250</span>]
  , <span class="variable">mistyrose</span>: [<span class="number integer">255</span>, <span class="number integer">228</span>, <span class="number integer">225</span>]
  , <span class="variable">moccasin</span>: [<span class="number integer">255</span>, <span class="number integer">228</span>, <span class="number integer">181</span>]
  , <span class="variable">navajowhite</span>: [<span class="number integer">255</span>, <span class="number integer">222</span>, <span class="number integer">173</span>]
  , <span class="variable">navy</span>: [<span class="number integer">0</span>, <span class="number integer">0</span>, <span class="number integer">128</span>]
  , <span class="variable">oldlace</span>: [<span class="number integer">253</span>, <span class="number integer">245</span>, <span class="number integer">230</span>]
  , <span class="variable">olive</span>: [<span class="number integer">128</span>, <span class="number integer">128</span>, <span class="number integer">0</span>]
  , <span class="variable">olivedrab</span>: [<span class="number integer">107</span>, <span class="number integer">142</span>, <span class="number integer">35</span>]
  , <span class="variable">orange</span>: [<span class="number integer">255</span>, <span class="number integer">165</span>, <span class="number integer">0</span>]
  , <span class="variable">orangered</span>: [<span class="number integer">255</span>, <span class="number integer">69</span>, <span class="number integer">0</span>]
  , <span class="variable">orchid</span>: [<span class="number integer">218</span>, <span class="number integer">112</span>, <span class="number integer">214</span>]
  , <span class="variable">palegoldenrod</span>: [<span class="number integer">238</span>, <span class="number integer">232</span>, <span class="number integer">170</span>]
  , <span class="variable">palegreen</span>: [<span class="number integer">152</span>, <span class="number integer">251</span>, <span class="number integer">152</span>]
  , <span class="variable">paleturquoise</span>: [<span class="number integer">175</span>, <span class="number integer">238</span>, <span class="number integer">238</span>]
  , <span class="variable">palevioletred</span>: [<span class="number integer">219</span>, <span class="number integer">112</span>, <span class="number integer">147</span>]
  , <span class="variable">papayawhip</span>: [<span class="number integer">255</span>, <span class="number integer">239</span>, <span class="number integer">213</span>]
  , <span class="variable">peachpuff</span>: [<span class="number integer">255</span>, <span class="number integer">218</span>, <span class="number integer">185</span>]
  , <span class="variable">peru</span>: [<span class="number integer">205</span>, <span class="number integer">133</span>, <span class="number integer">63</span>]
  , <span class="variable">pink</span>: [<span class="number integer">255</span>, <span class="number integer">192</span>, <span class="number integer">203</span>]
  , <span class="variable">plum</span>: [<span class="number integer">221</span>, <span class="number integer">160</span>, <span class="number integer">203</span>]
  , <span class="variable">powderblue</span>: [<span class="number integer">176</span>, <span class="number integer">224</span>, <span class="number integer">230</span>]
  , <span class="variable">purple</span>: [<span class="number integer">128</span>, <span class="number integer">0</span>, <span class="number integer">128</span>]
  , <span class="variable">red</span>: [<span class="number integer">255</span>, <span class="number integer">0</span>, <span class="number integer">0</span>]
  , <span class="variable">rosybrown</span>: [<span class="number integer">188</span>, <span class="number integer">143</span>, <span class="number integer">143</span>]
  , <span class="variable">royalblue</span>: [<span class="number integer">65</span>, <span class="number integer">105</span>, <span class="number integer">225</span>]
  , <span class="variable">saddlebrown</span>: [<span class="number integer">139</span>, <span class="number integer">69</span>, <span class="number integer">19</span>]
  , <span class="variable">salmon</span>: [<span class="number integer">250</span>, <span class="number integer">128</span>, <span class="number integer">114</span>]
  , <span class="variable">sandybrown</span>: [<span class="number integer">244</span>, <span class="number integer">164</span>, <span class="number integer">96</span>]
  , <span class="variable">seagreen</span>: [<span class="number integer">46</span>, <span class="number integer">139</span>, <span class="number integer">87</span>]
  , <span class="variable">seashell</span>: [<span class="number integer">255</span>, <span class="number integer">245</span>, <span class="number integer">238</span>]
  , <span class="variable">sienna</span>: [<span class="number integer">160</span>, <span class="number integer">82</span>, <span class="number integer">45</span>]
  , <span class="variable">silver</span>: [<span class="number integer">192</span>, <span class="number integer">192</span>, <span class="number integer">192</span>]
  , <span class="variable">skyblue</span>: [<span class="number integer">135</span>, <span class="number integer">206</span>, <span class="number integer">235</span>]
  , <span class="variable">slateblue</span>: [<span class="number integer">106</span>, <span class="number integer">90</span>, <span class="number integer">205</span>]
  , <span class="variable">slategray</span>: [<span class="number integer">119</span>, <span class="number integer">128</span>, <span class="number integer">144</span>]
  , <span class="variable">slategrey</span>: [<span class="number integer">119</span>, <span class="number integer">128</span>, <span class="number integer">144</span>]
  , <span class="variable">snow</span>: [<span class="number integer">255</span>, <span class="number integer">255</span>, <span class="number integer">250</span>]
  , <span class="variable">springgreen</span>: [<span class="number integer">0</span>, <span class="number integer">255</span>, <span class="number integer">127</span>]
  , <span class="variable">steelblue</span>: [<span class="number integer">70</span>, <span class="number integer">130</span>, <span class="number integer">180</span>]
  , <span class="variable">tan</span>: [<span class="number integer">210</span>, <span class="number integer">180</span>, <span class="number integer">140</span>]
  , <span class="variable">teal</span>: [<span class="number integer">0</span>, <span class="number integer">128</span>, <span class="number integer">128</span>]
  , <span class="variable">tle</span>: [<span class="number integer">216</span>, <span class="number integer">191</span>, <span class="number integer">216</span>]
  , <span class="variable">tomato</span>: [<span class="number integer">255</span>, <span class="number integer">99</span>, <span class="number integer">71</span>]
  , <span class="variable">turquoise</span>: [<span class="number integer">64</span>, <span class="number integer">224</span>, <span class="number integer">208</span>]
  , <span class="variable">violet</span>: [<span class="number integer">238</span>, <span class="number integer">130</span>, <span class="number integer">238</span>]
  , <span class="variable">wheat</span>: [<span class="number integer">245</span>, <span class="number integer">222</span>, <span class="number integer">179</span>]
  , <span class="variable">white</span>: [<span class="number integer">255</span>, <span class="number integer">255</span>, <span class="number integer">255</span>]
  , <span class="variable">whitesmoke</span>: [<span class="number integer">245</span>, <span class="number integer">245</span>, <span class="number integer">245</span>]
  , <span class="variable">yellow</span>: [<span class="number integer">255</span>, <span class="number integer">255</span>, <span class="number integer">0</span>]
  , <span class="variable">yellowgreen</span>: [<span class="number integer">154</span>, <span class="number integer">205</span>, <span class="number integer">5</span>]
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Color RegExp.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">color</span> = <span class="keyword">new</span> <span class="class">RegExp</span>(<span class="string">'^('</span> + <span class="class">Object</span>.<span class="variable">keys</span>(<span class="variable">colors</span>).<span class="variable">join</span>(<span class="string">'|'</span>) + <span class="string">')(\\()? *'</span>)</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Lexer</code> with the given <code>str</code> and <code>options</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  str</p></li><li><p><strong>param</strong>: <em>Object</em>  options</p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Lexer</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Lexer</span>(<span class="variable">str</span>, <span class="variable">options</span>) {
  <span class="variable">options</span> = <span class="variable">options</span> || {};
  <span class="this">this</span>.<span class="variable">str</span> = <span class="variable">str</span>.<span class="variable">replace</span>(<span class="regexp">/\r\n?/g</span>, <span class="string">'\n'</span>).<span class="variable">replace</span>(<span class="regexp">/\t/g</span>, <span class="string">'  '</span>);
  <span class="this">this</span>.<span class="variable">filename</span> = <span class="variable">options</span>.<span class="variable">filename</span> || <span class="string">'stylus'</span>;
  <span class="this">this</span>.<span class="variable">stash</span> = [];
  <span class="this">this</span>.<span class="variable">prevIndents</span> = <span class="number integer">0</span>;
  <span class="this">this</span>.<span class="variable">lineno</span> = <span class="number integer">1</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Lexer prototype.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Lexer</span>.<span class="variable">prototype</span> = {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Custom inspect.
   </p>
</td>
<td class="code">
<pre><code><span class="variable">inspect</span>: <span class="keyword">function</span>(){
    <span class="keyword">var</span> <span class="variable">tok</span>
      , <span class="variable">tmp</span> = <span class="this">this</span>.<span class="variable">str</span>
      , <span class="variable">buf</span> = [];
    <span class="keyword">while</span> (<span class="string">'eos'</span> != (<span class="variable">tok</span> = <span class="this">this</span>.<span class="variable">next</span>).<span class="variable">type</span>) {
      <span class="variable">buf</span>.<span class="variable">push</span>(<span class="variable">tok</span>.<span class="variable">inspect</span>());
    }
    <span class="this">this</span>.<span class="variable">str</span> = <span class="variable">tmp</span>;
    <span class="this">this</span>.<span class="variable">prevIndents</span> = <span class="number integer">0</span>;
    <span class="keyword">return</span> <span class="variable">buf</span>.<span class="variable">concat</span>(<span class="variable">tok</span>.<span class="variable">inspect</span>()).<span class="variable">join</span>(<span class="string">'\n'</span>);
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Lookahead <code>n</code> tokens.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  n</p></li><li><p><strong>return</strong>: <em>Object</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">lookahead</span>: <span class="keyword">function</span>(<span class="variable">n</span>){
    <span class="keyword">var</span> <span class="variable">fetch</span> = <span class="variable">n</span> - <span class="this">this</span>.<span class="variable">stash</span>.<span class="variable">length</span>;
    <span class="keyword">while</span> (<span class="variable">fetch</span>-- &<span class="variable">gt</span>; <span class="number integer">0</span>) <span class="this">this</span>.<span class="variable">stash</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">advance</span>);
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">stash</span>[--<span class="variable">n</span>];
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Consume the given <code>len</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number | Array</em>  len</p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">skip</span>: <span class="keyword">function</span>(<span class="variable">len</span>){
    <span class="this">this</span>.<span class="variable">str</span> = <span class="this">this</span>.<span class="variable">str</span>.<span class="variable">substr</span>(<span class="class">Array</span>.<span class="variable">isArray</span>(<span class="variable">len</span>)
      ? <span class="variable">len</span>[<span class="number integer">0</span>].<span class="variable">length</span>
      : <span class="variable">len</span>);
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Fetch next token including those stashed by peek.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Token</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">next</span>() {
    <span class="keyword">var</span> <span class="variable">tok</span> = <span class="this">this</span>.<span class="variable">stashed</span> || <span class="this">this</span>.<span class="variable">advance</span>;
    <span class="keyword">switch</span> (<span class="variable">tok</span>.<span class="variable">type</span>) {
      <span class="keyword">case</span> <span class="string">'newline'</span>:
      <span class="keyword">case</span> <span class="string">'selector'</span>:
      <span class="keyword">case</span> <span class="string">'indent'</span>:
        ++<span class="this">this</span>.<span class="variable">lineno</span>;
    }
    <span class="variable">tok</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
    <span class="keyword">return</span> <span class="variable">tok</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Fetch next token.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Token</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">advance</span>() {
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">eos</span>
      || <span class="this">this</span>.<span class="keyword">null</span>
      || <span class="this">this</span>.<span class="variable">keyword</span>
      || <span class="this">this</span>.<span class="variable">charset</span>
      || <span class="this">this</span>.<span class="variable">comment</span>
      || <span class="this">this</span>.<span class="variable">newline</span>
      || <span class="this">this</span>.<span class="variable">escaped</span>
      || <span class="this">this</span>.<span class="variable">important</span>
      || <span class="this">this</span>.<span class="variable">literal</span>
      || <span class="this">this</span>.<span class="keyword">function</span>
      || <span class="this">this</span>.<span class="variable">paren</span>
      || <span class="this">this</span>.<span class="keyword">import</span>
      || <span class="this">this</span>.<span class="variable">color</span>
      || <span class="this">this</span>.<span class="variable">string</span>
      || <span class="this">this</span>.<span class="variable">unit</span>
      || <span class="this">this</span>.<span class="variable">namedop</span>
      || <span class="this">this</span>.<span class="variable">boolean</span>
      || <span class="this">this</span>.<span class="variable">ident</span>
      || <span class="this">this</span>.<span class="variable">op</span>
      || <span class="this">this</span>.<span class="variable">selector</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Lookahead a single token.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Token</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">peek</span>() {
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">lookahead</span>(<span class="number integer">1</span>);
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return the next possibly stashed token.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Token</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">stashed</span>() {
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">stash</span>.<span class="variable">shift</span>();
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>EOS | trailing outdents.
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">eos</span>() {
    <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">str</span>.<span class="variable">length</span>) <span class="keyword">return</span>;
    <span class="keyword">return</span> --<span class="this">this</span>.<span class="variable">prevIndents</span> &<span class="variable">lt</span>; <span class="number integer">0</span>
      ? <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'eos'</span>)
      : <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'outdent'</span>);
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>'\' . ' '*
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">escaped</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^\\(.) */</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="keyword">var</span> <span class="variable">c</span> = <span class="variable">captures</span>[<span class="number integer">1</span>];
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'ident'</span>, <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Ident</span>(<span class="variable">c</span>));
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>'@css' ' '<em> '{' .</em> '}' ' '*
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">literal</span>() {
    <span class="comment">// HACK attack !!!</span>
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^@css *\{/</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">var</span> <span class="variable">c</span>
        , <span class="variable">braces</span> = <span class="number integer">1</span>
        , <span class="variable">css</span> = <span class="string">''</span>;
      <span class="keyword">while</span> (<span class="variable">c</span> = <span class="this">this</span>.<span class="variable">str</span>[<span class="number integer">0</span>]) {
        <span class="this">this</span>.<span class="variable">str</span> = <span class="this">this</span>.<span class="variable">str</span>.<span class="variable">substr</span>(<span class="number integer">1</span>);
        <span class="keyword">switch</span> (<span class="variable">c</span>) {
          <span class="keyword">case</span> <span class="string">'{'</span>: ++<span class="variable">braces</span>; <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">'}'</span>: --<span class="variable">braces</span>; <span class="keyword">break</span>;
        }
        <span class="variable">css</span> += <span class="variable">c</span>;
        <span class="keyword">if</span> (!<span class="variable">braces</span>) <span class="keyword">break</span>;
      }
      <span class="variable">css</span> = <span class="variable">css</span>.<span class="variable">replace</span>(<span class="regexp">/\s*}$/</span>, <span class="string">''</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'literal'</span>, <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Literal</span>(<span class="variable">css</span>));
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>'!important' ' '*
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">important</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^!important */</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'ident'</span>, <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Ident</span>(<span class="string">'!important'</span>));
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>'(' | ')' ' '*
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">paren</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^([()]) */</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="keyword">var</span> <span class="variable">paren</span> = <span class="variable">captures</span>[<span class="number integer">1</span>];
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">if</span> (<span class="string">')'</span> == <span class="variable">paren</span>) <span class="this">this</span>.<span class="variable">isURL</span> = <span class="variable">false</span>;
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Token</span>(<span class="variable">paren</span>, <span class="variable">paren</span>);
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>'null'
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="keyword">null</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^(null)\b */</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'null'</span>, <span class="variable">nodes</span>.<span class="keyword">null</span>);
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>  'if'
| 'else'
| 'unless'
| 'return'
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">keyword</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^(return|if|else|unless)\b */</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="keyword">var</span> <span class="variable">keyword</span> = <span class="variable">captures</span>[<span class="number integer">1</span>];
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Token</span>(<span class="variable">keyword</span>, <span class="variable">keyword</span>);
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>  'not'
| 'and'
| 'or'
| 'is a'
| 'is defined'
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">namedop</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^(not|and|or|is a|is defined)\b( *)/</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="keyword">var</span> <span class="variable">op</span> = <span class="variable">captures</span>[<span class="number integer">1</span>];
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="variable">op</span> = <span class="variable">alias</span>[<span class="variable">op</span>] || <span class="variable">op</span>;
      <span class="keyword">var</span> <span class="variable">tok</span> = <span class="keyword">new</span> <span class="class">Token</span>(<span class="variable">op</span>, <span class="variable">op</span>);
      <span class="variable">tok</span>.<span class="variable">space</span> = <span class="variable">captures</span>[<span class="number integer">2</span>];
      <span class="keyword">return</span> <span class="variable">tok</span>;
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>  ','
| '+'
| '-'
| '*'
| '/'
| '%'
| '**'
| '!'
| '&amp;'
| '&amp;&amp;'
| '||'
| '&gt;'
| '&gt;='
| '&lt;'
| '&lt;='
| '='
| '=='
| '!='
| '!'
| '~'
| '?='
| '?'
| ':'
| '['
| ']'
| '..'
| '...'
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">op</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^([.]{2,3}|&amp;&amp;|\|\||[!&lt;&gt;=?]=|\*\*|[-,=?:!~+&lt;&gt;*\/</span>%&<span class="variable">amp</span>;\[\]])( *)/.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="keyword">var</span> <span class="variable">op</span> = <span class="variable">captures</span>[<span class="number integer">1</span>];
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="variable">op</span> = <span class="variable">alias</span>[<span class="variable">op</span>] || <span class="variable">op</span>;
      <span class="keyword">var</span> <span class="variable">tok</span> = <span class="keyword">new</span> <span class="class">Token</span>(<span class="variable">op</span>, <span class="variable">op</span>);
      <span class="variable">tok</span>.<span class="variable">space</span> = <span class="variable">captures</span>[<span class="number integer">2</span>];
      <span class="keyword">return</span> <span class="variable">tok</span>;
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<ul><li><p><strong>impor</strong>: <em>t</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="keyword">import</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^@import */</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="this">this</span>.<span class="variable">str</span> = <span class="this">this</span>.<span class="variable">str</span>.<span class="variable">substr</span>(<span class="variable">captures</span>[<span class="number integer">0</span>].<span class="variable">length</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'import'</span>);
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>'//' *
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">comment</span>() {
    <span class="comment">// Single line</span>
    <span class="keyword">if</span> (<span class="string">'/'</span> == <span class="this">this</span>.<span class="variable">str</span>[<span class="number integer">0</span>] &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="string">'/'</span> == <span class="this">this</span>.<span class="variable">str</span>[<span class="number integer">1</span>]) {
      <span class="keyword">var</span> <span class="variable">end</span> = <span class="this">this</span>.<span class="variable">str</span>.<span class="variable">indexOf</span>(<span class="string">'\n'</span>);
      <span class="keyword">if</span> (-<span class="number integer">1</span> == <span class="variable">end</span>) <span class="variable">end</span> = <span class="this">this</span>.<span class="variable">str</span>.<span class="variable">length</span>;
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">end</span>);
      <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">advance</span>;
    }

    <span class="comment">// Multi-line</span>
    <span class="keyword">if</span> (<span class="string">'/'</span> == <span class="this">this</span>.<span class="variable">str</span>[<span class="number integer">0</span>] &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="string">'*'</span> == <span class="this">this</span>.<span class="variable">str</span>[<span class="number integer">1</span>]) {
      <span class="keyword">var</span> <span class="variable">end</span> = <span class="this">this</span>.<span class="variable">str</span>.<span class="variable">indexOf</span>(<span class="string">'*/'</span>);
      <span class="keyword">if</span> (-<span class="number integer">1</span> == <span class="variable">end</span>) <span class="variable">end</span> = <span class="this">this</span>.<span class="variable">str</span>.<span class="variable">length</span>;
      <span class="keyword">var</span> <span class="variable">lines</span> = <span class="this">this</span>.<span class="variable">str</span>.<span class="variable">substr</span>(<span class="number integer">0</span>, <span class="variable">end</span>).<span class="variable">split</span>(<span class="string">'\n'</span>).<span class="variable">length</span> - <span class="number integer">1</span>;
      <span class="this">this</span>.<span class="variable">lineno</span> += <span class="variable">lines</span>;
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">end</span> + <span class="number integer">2</span>);
      <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">advance</span>;
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>'true' | 'false'
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">boolean</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^(true|false)\b( *)/</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="keyword">var</span> <span class="variable">val</span> = <span class="string">'true'</span> == <span class="variable">captures</span>[<span class="number integer">1</span>]
        ? <span class="variable">nodes</span>.<span class="variable">true</span>
        : <span class="variable">nodes</span>.<span class="variable">false</span>;
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">var</span> <span class="variable">tok</span> = <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'boolean'</span>, <span class="variable">val</span>);
      <span class="variable">tok</span>.<span class="variable">space</span> = <span class="variable">captures</span>[<span class="number integer">2</span>];
      <span class="keyword">return</span> <span class="variable">tok</span>;
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>-?[a-zA-Z] [-\w\d]* '('
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="keyword">function</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^(-?[a-zA-Z][-\w\d]*)\(( *)/</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="keyword">var</span> <span class="variable">name</span> = <span class="variable">captures</span>[<span class="number integer">1</span>];
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="this">this</span>.<span class="variable">isURL</span> = <span class="string">'url'</span> == <span class="variable">name</span>;
      <span class="keyword">var</span> <span class="variable">tok</span> = <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'function'</span>, <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Ident</span>(<span class="variable">name</span>));
      <span class="variable">tok</span>.<span class="variable">space</span> = <span class="variable">captures</span>[<span class="number integer">2</span>];
      <span class="keyword">return</span> <span class="variable">tok</span>;
    } 
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>-?[a-zA-Z] [-\w\d]*
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">ident</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^(-?[a-zA-Z][-\w\d]*)( *)/</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="keyword">var</span> <span class="variable">name</span> = <span class="variable">captures</span>[<span class="number integer">1</span>];
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">var</span> <span class="variable">tok</span> = <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'ident'</span>, <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Ident</span>(<span class="variable">name</span>));
      <span class="variable">tok</span>.<span class="variable">space</span> = <span class="variable">captures</span>[<span class="number integer">2</span>];
      <span class="keyword">return</span> <span class="variable">tok</span>;
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>'@charset'
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">charset</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^@charset */</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'charset'</span>);
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>'\n' ' '+
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">newline</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^\n( *)/</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="keyword">var</span> <span class="variable">tok</span>
        , <span class="variable">spaces</span> = <span class="variable">captures</span>[<span class="number integer">1</span>].<span class="variable">length</span>
        , <span class="variable">indents</span> = <span class="variable">spaces</span> / <span class="number integer">2</span>;

      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);

      <span class="comment">// Reset state</span>
      <span class="this">this</span>.<span class="variable">isVariable</span> = <span class="variable">false</span>;
      
      <span class="comment">// Blank line</span>
      <span class="keyword">if</span> (<span class="string">'\n'</span> == <span class="this">this</span>.<span class="variable">str</span>[<span class="number integer">0</span>]) {
        ++<span class="this">this</span>.<span class="variable">lineno</span>;
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">advance</span>;
      }

      <span class="comment">// To few spaces</span>
      <span class="keyword">if</span> (<span class="number integer">0</span> != <span class="variable">spaces</span> % <span class="number integer">2</span>) {
        <span class="keyword">var</span> <span class="variable">str</span> = <span class="number integer">1</span> == <span class="variable">spaces</span> ? <span class="string">'space'</span> : <span class="string">'spaces'</span>
          , <span class="variable">spaces</span> = <span class="variable">numberString</span>[<span class="variable">spaces</span>] || <span class="variable">spaces</span>;
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'Invalid indentation, got '</span> + <span class="variable">spaces</span> + <span class="string">' '</span> + <span class="variable">str</span> + <span class="string">' and expected multiple of two'</span>);
      <span class="comment">// To many spaces</span>
      } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">indents</span> &<span class="variable">gt</span>; <span class="this">this</span>.<span class="variable">prevIndents</span> + <span class="number integer">1</span>) {
        <span class="keyword">var</span> <span class="variable">str</span> = <span class="number integer">1</span> == <span class="variable">spaces</span> ? <span class="string">'space'</span> : <span class="string">'spaces'</span>
          , <span class="variable">expected</span> = <span class="number integer">2</span> * (<span class="this">this</span>.<span class="variable">prevIndents</span> * <span class="number integer">2</span>) || <span class="number integer">2</span>
          , <span class="variable">expected</span> = <span class="variable">numberString</span>[<span class="variable">expected</span>] || <span class="variable">expected</span>
          , <span class="variable">spaces</span> = <span class="variable">numberString</span>[<span class="variable">spaces</span>] || <span class="variable">spaces</span>;
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'Invalid indentation, got '</span> + <span class="variable">spaces</span> + <span class="string">' '</span> + <span class="variable">str</span> + <span class="string">' and expected '</span> + <span class="variable">expected</span>);
      <span class="comment">// Outdent</span>
      } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">indents</span> &<span class="variable">lt</span>; <span class="this">this</span>.<span class="variable">prevIndents</span>) {
        <span class="keyword">var</span> <span class="variable">n</span> = <span class="this">this</span>.<span class="variable">prevIndents</span> - <span class="variable">indents</span>;
        <span class="keyword">while</span> (--<span class="variable">n</span>) <span class="this">this</span>.<span class="variable">stash</span>.<span class="variable">push</span>(<span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'outdent'</span>));
        <span class="this">this</span>.<span class="variable">prevIndents</span> = <span class="variable">indents</span>;
        <span class="variable">tok</span> = <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'outdent'</span>);
      <span class="comment">// Indent</span>
      } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">indents</span> != <span class="this">this</span>.<span class="variable">prevIndents</span>) {
        <span class="this">this</span>.<span class="variable">prevIndents</span> = <span class="variable">indents</span>;
        <span class="variable">tok</span> = <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'indent'</span>);
      <span class="comment">// Newline</span>
      } <span class="keyword">else</span> {
        <span class="variable">tok</span> = <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'newline'</span>);
      }

      <span class="keyword">return</span> <span class="variable">tok</span>;
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>(digit+ | digit* '.' digit+) unit
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">unit</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="variable">unit</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'unit'</span>, <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">parseFloat</span>(<span class="variable">captures</span>[<span class="number integer">1</span>]), <span class="variable">captures</span>[<span class="number integer">2</span>]));
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>'"' [^"]+ '"' | "'"" [^']+ "'"
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">string</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;

    <span class="comment">// url() special case</span>
    <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">isURL</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; (<span class="variable">captures</span> = <span class="regexp">/^([^'&quot;][^)]+) */</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>))) {
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'string'</span>, <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">String</span>(<span class="variable">captures</span>[<span class="number integer">1</span>]));
    }

    <span class="comment">// Regular string</span>
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^(&quot;[^&quot;]*&quot;|'[^']*') */</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="keyword">var</span> <span class="variable">str</span> = <span class="variable">captures</span>[<span class="number integer">1</span>];
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'string'</span>, <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">String</span>(<span class="variable">str</span>.<span class="variable">slice</span>(<span class="number integer">1</span>,-<span class="number integer">1</span>)));
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h1>nnnnnn | #nnn | colorString</h1>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">color</span>() {
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">hex6</span>
      || <span class="this">this</span>.<span class="variable">hex3</span>
      || <span class="this">this</span>.<span class="variable">colorString</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h1>nnn</h1>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">hex3</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^#([a-f-A-F0-9]{3}) */</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">var</span> <span class="variable">rgb</span> = <span class="variable">captures</span>[<span class="number integer">1</span>]
        , <span class="variable">r</span> = <span class="variable">parseInt</span>(<span class="variable">rgb</span>[<span class="number integer">0</span>] + <span class="variable">rgb</span>[<span class="number integer">0</span>], <span class="number integer">16</span>)
        , <span class="variable">g</span> = <span class="variable">parseInt</span>(<span class="variable">rgb</span>[<span class="number integer">1</span>] + <span class="variable">rgb</span>[<span class="number integer">1</span>], <span class="number integer">16</span>)
        , <span class="variable">b</span> = <span class="variable">parseInt</span>(<span class="variable">rgb</span>[<span class="number integer">2</span>] + <span class="variable">rgb</span>[<span class="number integer">2</span>], <span class="number integer">16</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'color'</span>, <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Color</span>(<span class="variable">r</span>, <span class="variable">g</span>, <span class="variable">b</span>, <span class="number integer">1</span>)); 
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h1>nnnnnn</h1>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">hex6</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^#([a-f-A-F0-9]{6}) */</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">var</span> <span class="variable">rgb</span> = <span class="variable">captures</span>[<span class="number integer">1</span>]
        , <span class="variable">r</span> = <span class="variable">parseInt</span>(<span class="variable">rgb</span>.<span class="variable">substr</span>(<span class="number integer">0</span>, <span class="number integer">2</span>), <span class="number integer">16</span>)
        , <span class="variable">g</span> = <span class="variable">parseInt</span>(<span class="variable">rgb</span>.<span class="variable">substr</span>(<span class="number integer">2</span>, <span class="number integer">2</span>), <span class="number integer">16</span>)
        , <span class="variable">b</span> = <span class="variable">parseInt</span>(<span class="variable">rgb</span>.<span class="variable">substr</span>(<span class="number integer">4</span>, <span class="number integer">2</span>), <span class="number integer">16</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'color'</span>, <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Color</span>(<span class="variable">r</span>, <span class="variable">g</span>, <span class="variable">b</span>, <span class="number integer">1</span>)); 
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Color string.
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">colorString</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="variable">color</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="keyword">var</span> <span class="variable">name</span> = <span class="variable">captures</span>[<span class="number integer">1</span>]
        , <span class="variable">rgb</span> = <span class="variable">colors</span>[<span class="variable">name</span>]
        , <span class="variable">fn</span> = <span class="variable">captures</span>[<span class="number integer">2</span>];
      <span class="keyword">if</span> (<span class="variable">fn</span>) <span class="keyword">return</span>;
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'color'</span>, <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Color</span>(<span class="variable">rgb</span>[<span class="number integer">0</span>], <span class="variable">rgb</span>[<span class="number integer">1</span>], <span class="variable">rgb</span>[<span class="number integer">2</span>], <span class="number integer">1</span>));
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>[^\n,]+
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">selector</span>() {
    <span class="keyword">var</span> <span class="variable">captures</span>;
    <span class="keyword">if</span> (<span class="variable">captures</span> = <span class="regexp">/^[^\n,]+/</span>.<span class="variable">exec</span>(<span class="this">this</span>.<span class="variable">str</span>)) {
      <span class="keyword">var</span> <span class="variable">selector</span> = <span class="variable">captures</span>[<span class="number integer">0</span>];
      <span class="this">this</span>.<span class="variable">skip</span>(<span class="variable">captures</span>);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Token</span>(<span class="string">'selector'</span>, <span class="variable">selector</span>);
    }
  }
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/binop.js"><a href="#">binop</a></h2></td><td>lib/nodes/binop.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>BinOp</code> with <code>op</code>, <code>left</code> and <code>right</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  op</p></li><li><p><strong>param</strong>: <em>Node</em>  left</p></li><li><p><strong>param</strong>: <em>Node</em>  right</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">BinOp</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">BinOp</span>(<span class="variable">op</span>, <span class="variable">left</span>, <span class="variable">right</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">op</span> = <span class="variable">op</span>;
  <span class="this">this</span>.<span class="variable">left</span> = <span class="variable">left</span>;
  <span class="this">this</span>.<span class="variable">right</span> = <span class="variable">right</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">BinOp</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">BinOp</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">BinOp</span>(
      <span class="this">this</span>.<span class="variable">op</span>
    , <span class="this">this</span>.<span class="variable">left</span>.<span class="variable">clone</span>()
    , <span class="this">this</span>.<span class="variable">right</span> ? <span class="this">this</span>.<span class="variable">right</span>.<span class="variable">clone</span>() : <span class="keyword">null</span>);
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">return</span> <span class="variable">clone</span>;
};</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/block.js"><a href="#">block</a></h2></td><td>lib/nodes/block.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Block</code> node with <code>parent</code> Block.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Block</em>  parent</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Block</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Block</span>(<span class="variable">parent</span>, <span class="variable">node</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">nodes</span> = [];
  <span class="this">this</span>.<span class="variable">parent</span> = <span class="variable">parent</span>;
  <span class="this">this</span>.<span class="variable">node</span> = <span class="variable">node</span>;
  <span class="this">this</span>.<span class="variable">scope</span> = <span class="variable">true</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Block</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Check if this block has properties..</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Block</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'hasProperties'</span>, <span class="keyword">function</span>(){
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="this">this</span>.<span class="variable">nodes</span>.<span class="variable">length</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
    <span class="keyword">if</span> (<span class="string">'property'</span> == <span class="this">this</span>.<span class="variable">nodes</span>[<span class="variable">i</span>].<span class="variable">nodeName</span>) {
      <span class="keyword">return</span> <span class="variable">true</span>;
    }
  }
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Check if this block is empty.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Block</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'isEmpty'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> !<span class="this">this</span>.<span class="variable">nodes</span>.<span class="variable">length</span>;
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Block</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">Block</span>(<span class="class">Block</span>.<span class="variable">parent</span> || <span class="this">this</span>.<span class="variable">parent</span>, <span class="this">this</span>.<span class="variable">node</span>);
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="class">Block</span>.<span class="variable">parent</span> = <span class="variable">clone</span>;
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="this">this</span>.<span class="variable">nodes</span>.<span class="variable">length</span>; ++<span class="variable">i</span>) {
    <span class="variable">clone</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">nodes</span>[<span class="variable">i</span>].<span class="variable">clone</span>());
  }
  <span class="keyword">delete</span> <span class="class">Block</span>.<span class="variable">parent</span>;
  <span class="keyword">return</span> <span class="variable">clone</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Push a <code>node</code> to this block.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  node</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Block</span>.<span class="variable">prototype</span>.<span class="variable">push</span> = <span class="keyword">function</span>(<span class="variable">node</span>){
  <span class="this">this</span>.<span class="variable">nodes</span>.<span class="variable">push</span>(<span class="variable">node</span>);
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/boolean.js"><a href="#">boolean</a></h2></td><td>lib/nodes/boolean.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Boolean</code> node with the given <code>val</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Boolean</em>  val</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Boolean</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Boolean</span>(<span class="variable">val</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="keyword">if</span> (<span class="this">this</span> <span class="variable">instanceof</span> <span class="class">Boolean</span>) {
    <span class="this">this</span>.<span class="variable">val</span> = !!<span class="variable">val</span>;
  } <span class="keyword">else</span> {
    <span class="keyword">return</span> <span class="variable">val</span> ? <span class="variable">nodes</span>.<span class="variable">true</span> : <span class="variable">nodes</span>.<span class="variable">false</span>;
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Boolean</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return <code>this</code> node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Boolean</span>.<span class="variable">prototype</span>.<span class="variable">toBoolean</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Negate the value.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Boolean</span>.<span class="variable">prototype</span>.<span class="variable">negate</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">val</span> ? <span class="variable">nodes</span>.<span class="variable">false</span> : <span class="variable">nodes</span>.<span class="variable">true</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return 'Boolean'.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Boolean</span>.<span class="variable">prototype</span>.<span class="variable">inspect</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="string">'[Boolean '</span> + <span class="this">this</span>.<span class="variable">val</span> + <span class="string">']'</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return 'true' or 'false'.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Boolean</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">val</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>;
};</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/call.js"><a href="#">call</a></h2></td><td>lib/nodes/call.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Call</code> with <code>name</code> and <code>args</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>param</strong>: <em>Expression</em>  args</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Call</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Call</span>(<span class="variable">name</span>, <span class="variable">args</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">name</span> = <span class="variable">name</span>;
  <span class="this">this</span>.<span class="variable">args</span> = <span class="variable">args</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Call</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Call</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">Call</span>(<span class="this">this</span>.<span class="variable">name</span>, <span class="this">this</span>.<span class="variable">args</span>.<span class="variable">clone</span>());
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">return</span> <span class="variable">clone</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return &lt;name&gt;().</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Call</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">name</span> + <span class="string">'()'</span>;
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/charset.js"><a href="#">charset</a></h2></td><td>lib/nodes/charset.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Charset</code> with the given <code>val</code></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  val</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Charset</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Charset</span>(<span class="variable">val</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">val</span> = <span class="variable">val</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Charset</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return @charset "val".</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Charset</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="string">'@charset '</span> + <span class="this">this</span>.<span class="variable">vals</span>;
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/color.js"><a href="#">color</a></h2></td><td>lib/nodes/color.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>)
  , <span class="class">HSLA</span> = <span class="variable">require</span>(<span class="string">'./hsla'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Color</code> with the given r,g,b,a component values.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  r</p></li><li><p><strong>param</strong>: <em>Number</em>  g</p></li><li><p><strong>param</strong>: <em>Number</em>  b</p></li><li><p><strong>param</strong>: <em>Number</em>  a</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Color</span> = <span class="variable">exports</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Color</span>(<span class="variable">r</span>,<span class="variable">g</span>,<span class="variable">b</span>,<span class="variable">a</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">r</span> = <span class="variable">clamp</span>(<span class="variable">r</span>);
  <span class="this">this</span>.<span class="variable">g</span> = <span class="variable">clamp</span>(<span class="variable">g</span>);
  <span class="this">this</span>.<span class="variable">b</span> = <span class="variable">clamp</span>(<span class="variable">b</span>);
  <span class="this">this</span>.<span class="variable">a</span> = <span class="variable">clampAlpha</span>(<span class="variable">a</span>);
  <span class="this">this</span>.<span class="variable">rgba</span> = <span class="this">this</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Color</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Color</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">Color</span>(
      <span class="this">this</span>.<span class="variable">r</span>
    , <span class="this">this</span>.<span class="variable">g</span>
    , <span class="this">this</span>.<span class="variable">b</span>
    , <span class="this">this</span>.<span class="variable">a</span>);
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">return</span> <span class="variable">clone</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return true.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Color</span>.<span class="variable">prototype</span>.<span class="variable">toBoolean</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="variable">true</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return <code>HSLA</code> representation.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>HSLA</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Color</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'hsl'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="class">HSLA</span>.<span class="variable">fromColor</span>(<span class="this">this</span>);
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return hash.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Color</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'hash'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">toString</span>();
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Coerce HSLA and Unit to color.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  other</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Color</span>.<span class="variable">prototype</span>.<span class="variable">coerce</span> = <span class="keyword">function</span>(<span class="variable">other</span>){
  <span class="keyword">if</span> (<span class="variable">other</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">HSLA</span>) {
    <span class="keyword">return</span> <span class="variable">other</span>.<span class="variable">rgba</span>;
  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">other</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Unit</span>) {
    <span class="keyword">var</span> <span class="variable">n</span> = <span class="variable">other</span>.<span class="variable">val</span>;
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Color</span>(<span class="variable">n</span>,<span class="variable">n</span>,<span class="variable">n</span>,<span class="number integer">1</span>);
  } <span class="keyword">else</span> {
    <span class="keyword">return</span> <span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">coerce</span>.<span class="variable">call</span>(<span class="this">this</span>, <span class="variable">other</span>);
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Operate on <code>right</code> with the given <code>op</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  op</p></li><li><p><strong>param</strong>: <em>Node</em>  right</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Color</span>.<span class="variable">prototype</span>.<span class="variable">operate</span> = <span class="keyword">function</span>(<span class="variable">op</span>, <span class="variable">right</span>){
  <span class="keyword">switch</span> (<span class="variable">op</span>) {
    <span class="keyword">case</span> <span class="string">'+'</span>:
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Color</span>(
          <span class="this">this</span>.<span class="variable">r</span> + <span class="variable">right</span>.<span class="variable">r</span>
        , <span class="this">this</span>.<span class="variable">g</span> + <span class="variable">right</span>.<span class="variable">g</span>
        , <span class="this">this</span>.<span class="variable">b</span> + <span class="variable">right</span>.<span class="variable">b</span>
        , <span class="number integer">1</span> == <span class="variable">right</span>.<span class="variable">a</span> ? <span class="this">this</span>.<span class="variable">a</span> : (<span class="this">this</span>.<span class="variable">a</span> + <span class="variable">right</span>.<span class="variable">a</span>)
        );
    <span class="keyword">case</span> <span class="string">'-'</span>:
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Color</span>(
          <span class="this">this</span>.<span class="variable">r</span> - <span class="variable">right</span>.<span class="variable">r</span>
        , <span class="this">this</span>.<span class="variable">g</span> - <span class="variable">right</span>.<span class="variable">g</span>
        , <span class="this">this</span>.<span class="variable">b</span> - <span class="variable">right</span>.<span class="variable">b</span>
        , <span class="number integer">1</span> == <span class="variable">right</span>.<span class="variable">a</span> ? <span class="this">this</span>.<span class="variable">a</span> : (<span class="this">this</span>.<span class="variable">a</span> - <span class="variable">right</span>.<span class="variable">a</span>)
        );
    <span class="keyword">case</span> <span class="string">'*'</span>:
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Color</span>(
          <span class="this">this</span>.<span class="variable">r</span> * <span class="variable">right</span>.<span class="variable">r</span>
        , <span class="this">this</span>.<span class="variable">g</span> * <span class="variable">right</span>.<span class="variable">g</span>
        , <span class="this">this</span>.<span class="variable">b</span> * <span class="variable">right</span>.<span class="variable">b</span>
        , <span class="this">this</span>.<span class="variable">a</span> * <span class="variable">right</span>.<span class="variable">a</span>
        );
    <span class="keyword">case</span> <span class="string">'/'</span>:
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Color</span>(
          <span class="this">this</span>.<span class="variable">r</span> / <span class="variable">right</span>.<span class="variable">r</span>
        , <span class="this">this</span>.<span class="variable">g</span> / <span class="variable">right</span>.<span class="variable">g</span>
        , <span class="this">this</span>.<span class="variable">b</span> / <span class="variable">right</span>.<span class="variable">b</span>
        , <span class="this">this</span>.<span class="variable">a</span> / <span class="variable">right</span>.<span class="variable">a</span>
        );
    <span class="keyword">default</span>:
      <span class="keyword">return</span> <span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">operate</span>.<span class="variable">call</span>(<span class="this">this</span>, <span class="variable">op</span>, <span class="variable">right</span>);
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return #nnnnnn, #nnn, or rgba(n,n,n,n) string representation of the color.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Color</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span>(){
  <span class="keyword">function</span> <span class="variable">pad</span>(<span class="variable">n</span>) { <span class="keyword">return</span> <span class="variable">n</span> &<span class="variable">lt</span>; <span class="number integer">10</span> ? <span class="string">'0'</span> + <span class="variable">n</span> : <span class="variable">n</span>.<span class="variable">toString</span>(<span class="number integer">16</span>); }

  <span class="keyword">if</span> (<span class="number integer">1</span> == <span class="this">this</span>.<span class="variable">a</span>) {
    <span class="keyword">var</span> <span class="variable">r</span> = <span class="variable">pad</span>(<span class="this">this</span>.<span class="variable">r</span>)
      , <span class="variable">g</span> = <span class="variable">pad</span>(<span class="this">this</span>.<span class="variable">g</span>)
      , <span class="variable">b</span> = <span class="variable">pad</span>(<span class="this">this</span>.<span class="variable">b</span>);
    
    <span class="comment">// Compress</span>
    <span class="keyword">if</span> (<span class="variable">r</span>[<span class="number integer">0</span>] == <span class="variable">r</span>[<span class="number integer">1</span>] &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="variable">g</span>[<span class="number integer">0</span>] == <span class="variable">g</span>[<span class="number integer">1</span>] &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="variable">b</span>[<span class="number integer">0</span>] == <span class="variable">b</span>[<span class="number integer">1</span>]) {
      <span class="keyword">return</span> <span class="string">'#'</span> + <span class="variable">r</span>[<span class="number integer">0</span>] + <span class="variable">g</span>[<span class="number integer">0</span>] + <span class="variable">b</span>[<span class="number integer">0</span>];
    } <span class="keyword">else</span> {
      <span class="keyword">return</span> <span class="string">'#'</span> + <span class="variable">r</span> + <span class="variable">g</span> + <span class="variable">b</span>;
    }
  } <span class="keyword">else</span> {
    <span class="keyword">return</span> <span class="string">'rgba('</span>
      + <span class="this">this</span>.<span class="variable">r</span> + <span class="string">','</span>
      + <span class="this">this</span>.<span class="variable">g</span> + <span class="string">','</span>
      + <span class="this">this</span>.<span class="variable">b</span> + <span class="string">','</span>
      + <span class="this">this</span>.<span class="variable">a</span> + <span class="string">')'</span>;
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a <code>Color</code> from the given <code>hsla</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>HSLA</em>  hsla</p></li><li><p><strong>return</strong>: <em>Color</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">fromHSLA</span> = <span class="keyword">function</span>(<span class="variable">hsla</span>){
  <span class="keyword">var</span> <span class="variable">h</span> = <span class="variable">hsla</span>.<span class="variable">h</span> / <span class="number integer">360</span>
    , <span class="variable">s</span> = <span class="variable">hsla</span>.<span class="variable">s</span> / <span class="number integer">100</span>
    , <span class="variable">l</span> = <span class="variable">hsla</span>.<span class="variable">l</span> / <span class="number integer">100</span>
    , <span class="variable">a</span> = <span class="variable">hsla</span>.<span class="variable">a</span>;

  <span class="keyword">var</span> <span class="variable">m2</span> = <span class="variable">l</span> &<span class="variable">lt</span>;= .<span class="number integer">5</span> ? <span class="variable">l</span> * (<span class="variable">s</span> + <span class="number integer">1</span>) : <span class="variable">l</span> + <span class="variable">s</span> - <span class="variable">l</span> * <span class="variable">s</span>
    , <span class="variable">m1</span> = <span class="variable">l</span> * <span class="number integer">2</span> - <span class="variable">m2</span>;

  <span class="keyword">var</span> <span class="variable">r</span> = <span class="variable">hue</span>(<span class="variable">h</span> + <span class="number integer">1</span>/<span class="number integer">3</span>) * <span class="variable">xff</span>
    , <span class="variable">g</span> = <span class="variable">hue</span>(<span class="variable">h</span>) * <span class="variable">xff</span>
    , <span class="variable">b</span> = <span class="variable">hue</span>(<span class="variable">h</span> - <span class="number integer">1</span>/<span class="number integer">3</span>) * <span class="variable">xff</span>;

  <span class="keyword">function</span> <span class="variable">hue</span>(<span class="variable">h</span>) {
    <span class="keyword">if</span> (<span class="variable">h</span> &<span class="variable">lt</span>; <span class="number integer">0</span>) ++<span class="variable">h</span>;
    <span class="keyword">if</span> (<span class="variable">h</span> &<span class="variable">gt</span>; <span class="number integer">1</span>) --<span class="variable">h</span>;
    <span class="keyword">if</span> (<span class="variable">h</span> * <span class="number integer">6</span> &<span class="variable">lt</span>; <span class="number integer">1</span>) <span class="keyword">return</span> <span class="variable">m1</span> + (<span class="variable">m2</span> - <span class="variable">m1</span>) * <span class="variable">h</span> * <span class="number integer">6</span>;
    <span class="keyword">if</span> (<span class="variable">h</span> * <span class="number integer">2</span> &<span class="variable">lt</span>; <span class="number integer">1</span>) <span class="keyword">return</span> <span class="variable">m2</span>;
    <span class="keyword">if</span> (<span class="variable">h</span> * <span class="number integer">3</span> &<span class="variable">lt</span>; <span class="number integer">2</span>) <span class="keyword">return</span> <span class="variable">m1</span> + (<span class="variable">m2</span> - <span class="variable">m1</span>) * (<span class="number integer">2</span>/<span class="number integer">3</span> - <span class="variable">h</span>) * <span class="number integer">6</span>;
    <span class="keyword">return</span> <span class="variable">m1</span>;
  }
  
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Color</span>(<span class="variable">r</span>,<span class="variable">g</span>,<span class="variable">b</span>,<span class="variable">a</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Clamp <code>n</code> &gt;= 0 and &lt;= 255.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  n</p></li><li><p><strong>return</strong>: <em>Number</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="variable">clamp</span>(<span class="variable">n</span>) {
  <span class="keyword">return</span> <span class="class">Math</span>.<span class="variable">max</span>(<span class="number integer">0</span>, <span class="class">Math</span>.<span class="variable">min</span>(<span class="variable">n</span>.<span class="variable">toFixed</span>(<span class="number integer">0</span>), <span class="number integer">255</span>));
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Clamp alpha <code>n</code> &gt;= 0 and &lt;= 1.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  n</p></li><li><p><strong>return</strong>: <em>Number</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="variable">clampAlpha</span>(<span class="variable">n</span>) {
  <span class="keyword">return</span> <span class="class">Math</span>.<span class="variable">max</span>(<span class="number integer">0</span>, <span class="class">Math</span>.<span class="variable">min</span>(<span class="variable">n</span>, <span class="number integer">1</span>));
}
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/expression.js"><a href="#">expression</a></h2></td><td>lib/nodes/expression.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'../nodes'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Expression</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Boolean</em>  isList</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Expression</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Expression</span>(<span class="variable">isList</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">nodes</span> = [];
  <span class="this">this</span>.<span class="variable">isList</span> = <span class="variable">isList</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Check if the variable has a value.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Expression</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'isEmpty'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> !<span class="this">this</span>.<span class="variable">nodes</span>.<span class="variable">length</span>;
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return the first node in this expression.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Expression</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'first'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">nodes</span>[<span class="number integer">0</span>].<span class="variable">first</span>;
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return the last node in this expression.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Expression</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'last'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">nodes</span>[<span class="this">this</span>.<span class="variable">nodes</span>.<span class="variable">length</span> - <span class="number integer">1</span>].<span class="variable">first</span>;
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Expression</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Expression</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">Expression</span>(<span class="this">this</span>.<span class="variable">isList</span>);
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="this">this</span>.<span class="variable">nodes</span>.<span class="variable">length</span>; ++<span class="variable">i</span>) {
    <span class="variable">clone</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">nodes</span>[<span class="variable">i</span>].<span class="variable">clone</span>());
  }
  <span class="keyword">return</span> <span class="variable">clone</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Push the given <code>node</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  node</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Expression</span>.<span class="variable">prototype</span>.<span class="variable">push</span> = <span class="keyword">function</span>(<span class="variable">node</span>){
  <span class="this">this</span>.<span class="variable">nodes</span>.<span class="variable">push</span>(<span class="variable">node</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Operate on <code>right</code> with the given <code>op</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  op</p></li><li><p><strong>param</strong>: <em>Node</em>  right</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Expression</span>.<span class="variable">prototype</span>.<span class="variable">operate</span> = <span class="keyword">function</span>(<span class="variable">op</span>, <span class="variable">right</span>){
  <span class="keyword">switch</span> (<span class="variable">op</span>) {
    <span class="keyword">case</span> <span class="string">'[]'</span>:
      <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">nodes</span>[<span class="variable">right</span>.<span class="variable">val</span>] || <span class="variable">nodes</span>.<span class="keyword">null</span>;
    <span class="keyword">default</span>:
      <span class="keyword">return</span> <span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">operate</span>.<span class="variable">call</span>(<span class="this">this</span>, <span class="variable">op</span>, <span class="variable">right</span>);
  }
};

</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/group.js"><a href="#">group</a></h2></td><td>lib/nodes/group.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Group</code>.</p>

<ul><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Group</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Group</span>(){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">nodes</span> = [];
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Group</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Push the given <code>selector</code> node.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Selector</em>  selector</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Group</span>.<span class="variable">prototype</span>.<span class="variable">push</span> = <span class="keyword">function</span>(<span class="variable">selector</span>){
  <span class="this">this</span>.<span class="variable">nodes</span>.<span class="variable">push</span>(<span class="variable">selector</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return this set's <code>Block</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Group</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'block'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">nodes</span>[<span class="number integer">0</span>].<span class="variable">block</span>;
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Assign <code>block</code> to each selector in this set.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Block</em>  block</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Group</span>.<span class="variable">prototype</span>.<span class="variable">__defineSetter__</span>(<span class="string">'block'</span>, <span class="keyword">function</span>(<span class="variable">block</span>){
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="this">this</span>.<span class="variable">nodes</span>.<span class="variable">length</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
    <span class="this">this</span>.<span class="variable">nodes</span>[<span class="variable">i</span>].<span class="variable">block</span> = <span class="variable">block</span>;
  }
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Group</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">Group</span>;
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="this">this</span>.<span class="variable">nodes</span>.<span class="variable">length</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
    <span class="variable">clone</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">nodes</span>[<span class="variable">i</span>].<span class="variable">clone</span>());
  }
  <span class="variable">clone</span>.<span class="variable">block</span> = <span class="this">this</span>.<span class="variable">block</span>.<span class="variable">clone</span>();
  <span class="keyword">return</span> <span class="variable">clone</span>;
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/hsla.js"><a href="#">hsla</a></h2></td><td>lib/nodes/hsla.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>HSLA</code> with the given h,s,l,a component values.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  h</p></li><li><p><strong>param</strong>: <em>Number</em>  s</p></li><li><p><strong>param</strong>: <em>Number</em>  l</p></li><li><p><strong>param</strong>: <em>Number</em>  a</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">HSLA</span> = <span class="variable">exports</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">HSLA</span>(<span class="variable">h</span>,<span class="variable">s</span>,<span class="variable">l</span>,<span class="variable">a</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">h</span> = <span class="variable">h</span>;
  <span class="this">this</span>.<span class="variable">s</span> = <span class="variable">s</span>;
  <span class="this">this</span>.<span class="variable">l</span> = <span class="variable">l</span>;
  <span class="this">this</span>.<span class="variable">a</span> = <span class="variable">clampAlpha</span>(<span class="variable">a</span>);
  <span class="this">this</span>.<span class="variable">hsl</span> = <span class="this">this</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">HSLA</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return hsla(n,n,n,n).</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">HSLA</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="string">'hsla('</span>
    + <span class="this">this</span>.<span class="variable">h</span> + <span class="string">','</span>
    + <span class="this">this</span>.<span class="variable">s</span> + <span class="string">','</span>
    + <span class="this">this</span>.<span class="variable">l</span> + <span class="string">','</span>
    + <span class="this">this</span>.<span class="variable">a</span> + <span class="string">')'</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">HSLA</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">HSLA</span>(
      <span class="this">this</span>.<span class="variable">h</span>
    , <span class="this">this</span>.<span class="variable">s</span>
    , <span class="this">this</span>.<span class="variable">l</span>
    , <span class="this">this</span>.<span class="variable">a</span>);
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">return</span> <span class="variable">clone</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return rgba <code>Color</code> representation.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Color</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">HSLA</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'rgba'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="class">Color</span>.<span class="variable">fromHSLA</span>(<span class="this">this</span>);
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return hash.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">HSLA</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'hash'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">rgba</span>.<span class="variable">toString</span>();
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Coerce color to HSLA.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  other</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">HSLA</span>.<span class="variable">prototype</span>.<span class="variable">coerce</span> = <span class="keyword">function</span>(<span class="variable">other</span>){
  <span class="keyword">if</span> (<span class="variable">other</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Color</span>) {
    <span class="keyword">return</span> <span class="variable">other</span>.<span class="variable">hsl</span>;
  } <span class="keyword">else</span> {
    <span class="keyword">return</span> <span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">coerce</span>.<span class="variable">call</span>(<span class="this">this</span>, <span class="variable">other</span>);
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Operate on <code>right</code> with the given <code>op</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  op</p></li><li><p><strong>param</strong>: <em>Node</em>  right</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">HSLA</span>.<span class="variable">prototype</span>.<span class="variable">operate</span> = <span class="keyword">function</span>(<span class="variable">op</span>, <span class="variable">right</span>){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">rgba</span>.<span class="variable">operate</span>(<span class="variable">op</span>, <span class="variable">right</span>.<span class="variable">rgba</span>).<span class="variable">hsl</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return <code>HSLA</code> representation of the given <code>color</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Color</em>  color</p></li><li><p><strong>return</strong>: <em>HSLA</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">fromColor</span> = <span class="keyword">function</span>(<span class="variable">color</span>){
  <span class="keyword">var</span> <span class="variable">r</span> = <span class="variable">color</span>.<span class="variable">r</span> / <span class="number integer">255</span>
    , <span class="variable">g</span> = <span class="variable">color</span>.<span class="variable">g</span> / <span class="number integer">255</span>
    , <span class="variable">b</span> = <span class="variable">color</span>.<span class="variable">b</span> / <span class="number integer">255</span>
    , <span class="variable">a</span> = <span class="variable">color</span>.<span class="variable">a</span>;

  <span class="keyword">var</span> <span class="variable">h</span>,<span class="variable">s</span>,<span class="variable">l</span>
    , <span class="variable">min</span> = <span class="class">Math</span>.<span class="variable">min</span>(<span class="variable">r</span>,<span class="variable">g</span>,<span class="variable">b</span>)
    , <span class="variable">max</span> = <span class="class">Math</span>.<span class="variable">max</span>(<span class="variable">r</span>,<span class="variable">g</span>,<span class="variable">b</span>)
    , <span class="variable">d</span> = <span class="variable">max</span> - <span class="variable">min</span>;

  <span class="keyword">switch</span> (<span class="variable">max</span>) {
    <span class="keyword">case</span> <span class="variable">min</span>: <span class="variable">h</span> = <span class="number integer">0</span>; <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="variable">r</span>: <span class="variable">h</span> = <span class="number integer">60</span> * (<span class="variable">g</span>-<span class="variable">b</span>) / <span class="variable">d</span>; <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="variable">g</span>: <span class="variable">h</span> = <span class="number integer">60</span> * (<span class="variable">b</span>-<span class="variable">r</span>) / <span class="variable">d</span> + <span class="number integer">120</span>; <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="variable">g</span>: <span class="variable">h</span> = <span class="number integer">60</span> * (<span class="variable">r</span>-<span class="variable">g</span>) / <span class="variable">d</span> + <span class="number integer">240</span>; <span class="keyword">break</span>;
  }
  
  <span class="variable">l</span> = (<span class="variable">max</span> + <span class="variable">min</span>) / <span class="number integer">2</span>;

  <span class="keyword">if</span> (<span class="variable">max</span> == <span class="variable">min</span>) {
    <span class="variable">s</span> = <span class="number integer">0</span>;
  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">l</span> &<span class="variable">lt</span>; .<span class="number integer">5</span>) {
    <span class="variable">s</span> = <span class="variable">d</span> / (<span class="number integer">2</span> * <span class="variable">l</span>);
  } <span class="keyword">else</span> {
    <span class="variable">s</span> = <span class="variable">d</span> / (<span class="number integer">2</span> - <span class="number integer">2</span> * <span class="variable">l</span>);
  }

  <span class="variable">h</span> %= <span class="number integer">360</span>;
  <span class="variable">s</span> *= <span class="number integer">100</span>;
  <span class="variable">l</span> *= <span class="number integer">100</span>;

  <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">HSLA</span>(<span class="variable">h</span>,<span class="variable">s</span>,<span class="variable">l</span>,<span class="variable">a</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Clamp alpha <code>n</code> &gt;= 0 and &lt;= 1.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  n</p></li><li><p><strong>return</strong>: <em>Number</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="variable">clampAlpha</span>(<span class="variable">n</span>) {
  <span class="keyword">return</span> <span class="class">Math</span>.<span class="variable">max</span>(<span class="number integer">0</span>, <span class="class">Math</span>.<span class="variable">min</span>(<span class="variable">n</span>, <span class="number integer">1</span>));
}
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/ident.js"><a href="#">ident</a></h2></td><td>lib/nodes/ident.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Ident</code> by <code>name</code> with the given <code>val</code> node.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>param</strong>: <em>Node</em>  val</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Ident</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Ident</span>(<span class="variable">name</span>, <span class="variable">val</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">name</span> = <span class="variable">name</span>;
  <span class="this">this</span>.<span class="variable">string</span> = <span class="variable">name</span>;
  <span class="this">this</span>.<span class="variable">val</span> = <span class="variable">val</span> || <span class="variable">nodes</span>.<span class="keyword">null</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Check if the variable has a value.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Ident</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'isEmpty'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="variable">undefined</span> == <span class="this">this</span>.<span class="variable">val</span>;
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return hash.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Ident</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'hash'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">name</span>;
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Ident</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Ident</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">Ident</span>(<span class="this">this</span>.<span class="variable">name</span>, <span class="this">this</span>.<span class="variable">val</span>.<span class="variable">clone</span>());
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">return</span> <span class="variable">clone</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return &lt;name&gt;.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Ident</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">name</span>;
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/if.js"><a href="#">if</a></h2></td><td>lib/nodes/if.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>If</code> with the given <code>cond</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Expression</em>  cond</p></li><li><p><strong>param</strong>: <em>Boolean | Block</em>  negate, block</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">If</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">If</span>(<span class="variable">cond</span>, <span class="variable">negate</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">cond</span> = <span class="variable">cond</span>;
  <span class="this">this</span>.<span class="variable">elses</span> = [];
  <span class="keyword">if</span> (<span class="variable">negate</span> <span class="variable">instanceof</span> <span class="class">Node</span>) {
    <span class="this">this</span>.<span class="variable">block</span> = <span class="variable">negate</span>;
  } <span class="keyword">else</span> {
    <span class="this">this</span>.<span class="variable">negate</span> = <span class="variable">negate</span>;
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">If</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">If</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">cond</span> = <span class="this">this</span>.<span class="variable">cond</span>.<span class="variable">clone</span>()
    , <span class="variable">block</span> = <span class="this">this</span>.<span class="variable">block</span>.<span class="variable">clone</span>();
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">If</span>(<span class="variable">cond</span>, <span class="variable">block</span>);
  <span class="variable">clone</span>.<span class="variable">elses</span> = <span class="this">this</span>.<span class="variable">elses</span>.<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">node</span>){ <span class="keyword">return</span> <span class="variable">node</span>.<span class="variable">clone</span>(); });
  <span class="variable">clone</span>.<span class="variable">negate</span> = <span class="this">this</span>.<span class="variable">negate</span>;
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">return</span> <span class="variable">clone</span>;
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/import.js"><a href="#">import</a></h2></td><td>lib/nodes/import.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Import</code> with the given <code>path</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  path</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Import</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Import</span>(<span class="variable">path</span>){
  <span class="this">this</span>.<span class="variable">path</span> = <span class="variable">path</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Import</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/index.js"><a href="#">index</a></h2></td><td>lib/nodes/index.js</td></tr><tr class="code">
<td class="docs">
<p>Constructors
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>);
<span class="variable">exports</span>.<span class="class">Root</span> = <span class="variable">require</span>(<span class="string">'./root'</span>);
<span class="variable">exports</span>.<span class="class">Null</span> = <span class="variable">require</span>(<span class="string">'./null'</span>);
<span class="variable">exports</span>.<span class="class">If</span> = <span class="variable">require</span>(<span class="string">'./if'</span>);
<span class="variable">exports</span>.<span class="class">Call</span> = <span class="variable">require</span>(<span class="string">'./call'</span>);
<span class="variable">exports</span>.<span class="class">UnaryOp</span> = <span class="variable">require</span>(<span class="string">'./unaryop'</span>);
<span class="variable">exports</span>.<span class="class">BinOp</span> = <span class="variable">require</span>(<span class="string">'./binop'</span>);
<span class="variable">exports</span>.<span class="class">Ternary</span> = <span class="variable">require</span>(<span class="string">'./ternary'</span>);
<span class="variable">exports</span>.<span class="class">Block</span> = <span class="variable">require</span>(<span class="string">'./block'</span>);
<span class="variable">exports</span>.<span class="class">Unit</span> = <span class="variable">require</span>(<span class="string">'./unit'</span>);
<span class="variable">exports</span>.<span class="class">String</span> = <span class="variable">require</span>(<span class="string">'./string'</span>);
<span class="variable">exports</span>.<span class="class">HSLA</span> = <span class="variable">require</span>(<span class="string">'./hsla'</span>);
<span class="variable">exports</span>.<span class="class">Color</span> = <span class="variable">require</span>(<span class="string">'./color'</span>);
<span class="variable">exports</span>.<span class="class">Ident</span> = <span class="variable">require</span>(<span class="string">'./ident'</span>);
<span class="variable">exports</span>.<span class="class">Group</span> = <span class="variable">require</span>(<span class="string">'./group'</span>);
<span class="variable">exports</span>.<span class="class">Literal</span> = <span class="variable">require</span>(<span class="string">'./literal'</span>);
<span class="variable">exports</span>.<span class="class">Boolean</span> = <span class="variable">require</span>(<span class="string">'./boolean'</span>);
<span class="variable">exports</span>.<span class="class">Return</span> = <span class="variable">require</span>(<span class="string">'./return'</span>);
<span class="variable">exports</span>.<span class="class">Params</span> = <span class="variable">require</span>(<span class="string">'./params'</span>);
<span class="variable">exports</span>.<span class="class">Charset</span> = <span class="variable">require</span>(<span class="string">'./charset'</span>);
<span class="variable">exports</span>.<span class="class">Import</span> = <span class="variable">require</span>(<span class="string">'./import'</span>);
<span class="variable">exports</span>.<span class="class">Function</span> = <span class="variable">require</span>(<span class="string">'./function'</span>);
<span class="variable">exports</span>.<span class="class">Property</span> = <span class="variable">require</span>(<span class="string">'./property'</span>);
<span class="variable">exports</span>.<span class="class">Selector</span> = <span class="variable">require</span>(<span class="string">'./selector'</span>);
<span class="variable">exports</span>.<span class="class">Expression</span> = <span class="variable">require</span>(<span class="string">'./expression'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Singletons.
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">true</span> = <span class="keyword">new</span> <span class="variable">exports</span>.<span class="class">Boolean</span>(<span class="variable">true</span>);
<span class="variable">exports</span>.<span class="variable">false</span> = <span class="keyword">new</span> <span class="variable">exports</span>.<span class="class">Boolean</span>(<span class="variable">false</span>);
<span class="variable">exports</span>.<span class="keyword">null</span> = <span class="keyword">new</span> <span class="variable">exports</span>.<span class="class">Null</span>;</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/literal.js"><a href="#">literal</a></h2></td><td>lib/nodes/literal.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Literal</code> with the given <code>str</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  str</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Literal</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Literal</span>(<span class="variable">str</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">val</span> = <span class="variable">str</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Literal</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return @&lt;name&gt;.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Literal</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="string">'css &quot;'</span> + <span class="this">this</span>.<span class="variable">val</span> + <span class="string">'&quot;'</span>;
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/node.js"><a href="#">node</a></h2></td><td>lib/nodes/node.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Evaluator</span> = <span class="variable">require</span>(<span class="string">'../visitor/evaluator'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Node constructor.</p>

<ul><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Node</span>(){
  <span class="this">this</span>.<span class="variable">lineno</span> = <span class="variable">nodes</span>.<span class="variable">lineno</span>;
  <span class="class">Object</span>.<span class="variable">defineProperty</span>(<span class="this">this</span>, <span class="string">'filename'</span>, { <span class="variable">value</span>: <span class="variable">nodes</span>.<span class="variable">filename</span> });
  <span class="class">Object</span>.<span class="variable">defineProperty</span>(<span class="this">this</span>, <span class="string">'source'</span>, { <span class="variable">value</span>: <span class="variable">nodes</span>.<span class="variable">source</span> });
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'first'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>;
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return hash.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'hash'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">val</span>;
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return node name.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'nodeName'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">constructor</span>.<span class="variable">name</span>.<span class="variable">toLowerCase</span>();
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Nodes by default evaluate to themselves.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">eval</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Evaluator</span>(<span class="this">this</span>).<span class="variable">evaluate</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return true.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">toBoolean</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="variable">true</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Operate on <code>right</code> with the given <code>op</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  op</p></li><li><p><strong>param</strong>: <em>Node</em>  right</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">operate</span> = <span class="keyword">function</span>(<span class="variable">op</span>, <span class="variable">right</span>){
  <span class="keyword">switch</span> (<span class="variable">op</span>) {
    <span class="keyword">case</span> <span class="string">'is a'</span>:
      <span class="keyword">if</span> (<span class="string">'string'</span> == <span class="variable">right</span>.<span class="variable">nodeName</span>) {
        <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="class">Boolean</span>(<span class="this">this</span>.<span class="variable">nodeName</span> == <span class="variable">right</span>.<span class="variable">val</span>);
      } <span class="keyword">else</span> {
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'&quot;is a&quot; expects a string, got '</span> + <span class="variable">right</span>.<span class="variable">nodeName</span>);
      }
    <span class="keyword">case</span> <span class="string">'=='</span>:
      <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="class">Boolean</span>(<span class="this">this</span>.<span class="variable">hash</span> == <span class="variable">right</span>.<span class="variable">hash</span>);
    <span class="keyword">case</span> <span class="string">'!='</span>:
      <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="class">Boolean</span>(<span class="this">this</span>.<span class="variable">hash</span> != <span class="variable">right</span>.<span class="variable">hash</span>);
    <span class="keyword">case</span> <span class="string">'&gt;='</span>:
      <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="class">Boolean</span>(<span class="this">this</span>.<span class="variable">hash</span> &<span class="variable">gt</span>;= <span class="variable">right</span>.<span class="variable">hash</span>);
    <span class="keyword">case</span> <span class="string">'&lt;='</span>:
      <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="class">Boolean</span>(<span class="this">this</span>.<span class="variable">hash</span> &<span class="variable">lt</span>;= <span class="variable">right</span>.<span class="variable">hash</span>);
    <span class="keyword">case</span> <span class="string">'&gt;'</span>:
      <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="class">Boolean</span>(<span class="this">this</span>.<span class="variable">hash</span> &<span class="variable">gt</span>; <span class="variable">right</span>.<span class="variable">hash</span>);
    <span class="keyword">case</span> <span class="string">'&lt;'</span>:
      <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="class">Boolean</span>(<span class="this">this</span>.<span class="variable">hash</span> &<span class="variable">lt</span>; <span class="variable">right</span>.<span class="variable">hash</span>);
    <span class="keyword">case</span> <span class="string">'||'</span>:
      <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="variable">true</span> == <span class="this">this</span>.<span class="variable">toBoolean</span>()
        ? <span class="this">this</span>
        : <span class="variable">right</span>;
    <span class="keyword">case</span> <span class="string">'&amp;&amp;'</span>:
      <span class="keyword">var</span> <span class="variable">a</span> = <span class="this">this</span>.<span class="variable">toBoolean</span>()
        , <span class="variable">b</span> = <span class="variable">right</span>.<span class="variable">toBoolean</span>();
      <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="variable">true</span> == <span class="variable">a</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="variable">nodes</span>.<span class="variable">true</span> == <span class="variable">b</span>
        ? <span class="variable">right</span>
        : <span class="variable">nodes</span>.<span class="variable">false</span> == <span class="variable">a</span>
          ? <span class="this">this</span>
          : <span class="variable">right</span>;
    <span class="keyword">default</span>:
      <span class="keyword">if</span> (<span class="string">'[]'</span> == <span class="variable">op</span>) {
        <span class="keyword">var</span> <span class="variable">msg</span> = <span class="string">'cannot perform '</span>
          + <span class="this">this</span>
          + <span class="string">'['</span> + <span class="variable">right</span> + <span class="string">']'</span>;
      } <span class="keyword">else</span> {
        <span class="keyword">var</span> <span class="variable">msg</span> = <span class="string">'cannot perform'</span>
          + <span class="string">' '</span> + <span class="this">this</span>
          + <span class="string">' '</span> + <span class="variable">op</span>
          + <span class="string">' '</span> + <span class="variable">right</span>;
      }
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="variable">msg</span>);
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Default coercion throws.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  other</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">coerce</span> = <span class="keyword">function</span>(<span class="variable">other</span>){
  <span class="keyword">if</span> (<span class="variable">other</span>.<span class="variable">nodeName</span> == <span class="this">this</span>.<span class="variable">nodeName</span>) <span class="keyword">return</span> <span class="variable">other</span>;
  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'cannot coerce '</span> + <span class="variable">other</span> + <span class="string">' to '</span> + <span class="this">this</span>.<span class="variable">nodeName</span>);
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/function.js"><a href="#">function</a></h2></td><td>lib/nodes/function.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Function</code> with <code>name</code>, <code>params</code>, and <code>body</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>param</strong>: <em>Params | Function</em>  params</p></li><li><p><strong>param</strong>: <em>Block</em>  body</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Function</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Function</span>(<span class="variable">name</span>, <span class="variable">params</span>, <span class="variable">body</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">name</span> = <span class="variable">name</span>;
  <span class="this">this</span>.<span class="variable">params</span> = <span class="variable">params</span>;
  <span class="this">this</span>.<span class="variable">block</span> = <span class="variable">body</span>;
  <span class="keyword">if</span> (<span class="string">'function'</span> == <span class="keyword">typeof</span> <span class="variable">params</span>) <span class="this">this</span>.<span class="variable">fn</span> = <span class="variable">params</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Check function arity.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Function</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'arity'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">params</span>.<span class="variable">length</span>;
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Function</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Function</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">fn</span>) {
    <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">Function</span>(
        <span class="this">this</span>.<span class="variable">name</span>
      , <span class="this">this</span>.<span class="variable">fn</span>);
  } <span class="keyword">else</span> {
    <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">Function</span>(
        <span class="this">this</span>.<span class="variable">name</span>
      , <span class="this">this</span>.<span class="variable">params</span>.<span class="variable">clone</span>()
      , <span class="this">this</span>.<span class="variable">block</span>.<span class="variable">clone</span>());
  }
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">return</span> <span class="variable">clone</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return &lt;name&gt;(param1, param2, ...).</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Function</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">name</span>
    + <span class="string">'('</span>
    + <span class="this">this</span>.<span class="variable">params</span>.<span class="variable">nodes</span>.<span class="variable">join</span>(<span class="string">', '</span>)
    + <span class="string">')'</span>;
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/null.js"><a href="#">null</a></h2></td><td>lib/nodes/null.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Null</code> node.</p>

<ul><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Null</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Null</span>(){};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Null</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return 'Null'.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Null</span>.<span class="variable">prototype</span>.<span class="variable">inspect</span> = 
<span class="class">Null</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="string">'[Null]'</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return false.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Null</span>.<span class="variable">prototype</span>.<span class="variable">toBoolean</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="variable">false</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return hash.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Null</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'hash'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="keyword">null</span>;
});</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/property.js"><a href="#">property</a></h2></td><td>lib/nodes/property.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Property</code> with the given <code>name</code> and optional <code>expr</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>param</strong>: <em>Expression</em>  expr</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Property</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Property</span>(<span class="variable">name</span>, <span class="variable">expr</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">name</span> = <span class="variable">name</span>;
  <span class="this">this</span>.<span class="variable">expr</span> = <span class="variable">expr</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Property</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Property</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">Property</span>(<span class="this">this</span>.<span class="variable">name</span>);
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">expr</span>) <span class="variable">clone</span>.<span class="variable">expr</span> = <span class="this">this</span>.<span class="variable">expr</span>.<span class="variable">clone</span>();
  <span class="keyword">return</span> <span class="variable">clone</span>;
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/return.js"><a href="#">return</a></h2></td><td>lib/nodes/return.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Return</code> node with the given <code>expr</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Expression</em>  expr</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Return</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Return</span>(<span class="variable">expr</span>){
  <span class="this">this</span>.<span class="variable">expr</span> = <span class="variable">expr</span> || <span class="variable">nodes</span>.<span class="keyword">null</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Return</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Return</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">Return</span>(<span class="this">this</span>.<span class="variable">expr</span>.<span class="variable">clone</span>());
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">return</span> <span class="variable">clone</span>;
};</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/root.js"><a href="#">root</a></h2></td><td>lib/nodes/root.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Root</code> node.</p>

<ul><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Root</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Root</span>(){
  <span class="this">this</span>.<span class="variable">nodes</span> = [];
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Root</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Push a <code>node</code> to this block.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  node</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Root</span>.<span class="variable">prototype</span>.<span class="variable">push</span> = <span class="keyword">function</span>(<span class="variable">node</span>){
  <span class="this">this</span>.<span class="variable">nodes</span>.<span class="variable">push</span>(<span class="variable">node</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return "root".</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Root</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="string">'[Root]'</span>;
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/selector.js"><a href="#">selector</a></h2></td><td>lib/nodes/selector.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Block</span> = <span class="variable">require</span>(<span class="string">'./block'</span>)
  , <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Selector</code> with the given <code>val</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  val</p></li><li><p><strong>param</strong>: <em>Boolean</em>  parent</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Selector</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Selector</span>(<span class="variable">val</span>, <span class="variable">parent</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">val</span> = <span class="variable">val</span>;
  <span class="this">this</span>.<span class="variable">parent</span> = <span class="variable">parent</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Selector</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return the selector string.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Selector</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">val</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Selector</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">Selector</span>(<span class="this">this</span>.<span class="variable">val</span>, <span class="this">this</span>.<span class="variable">parent</span>);
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">return</span> <span class="variable">clone</span>;
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/string.js"><a href="#">string</a></h2></td><td>lib/nodes/string.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>String</code> with the given <code>val</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  val</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">String</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">String</span>(<span class="variable">val</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">val</span> = <span class="variable">val</span>;
  <span class="this">this</span>.<span class="variable">string</span> = <span class="variable">val</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">String</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return quoted string.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">String</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="string">'&quot;'</span> + <span class="this">this</span>.<span class="variable">val</span> + <span class="string">'&quot;'</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">String</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">String</span>(<span class="this">this</span>.<span class="variable">val</span>);
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">return</span> <span class="variable">clone</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return Boolean based on the length of this string.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">String</span>.<span class="variable">prototype</span>.<span class="variable">toBoolean</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="class">Boolean</span>(<span class="this">this</span>.<span class="variable">val</span>.<span class="variable">length</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Coerce <code>other</code> to a string.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  other</p></li><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">String</span>.<span class="variable">prototype</span>.<span class="variable">coerce</span> = <span class="keyword">function</span>(<span class="variable">other</span>){
  <span class="keyword">if</span> (<span class="variable">other</span> <span class="variable">instanceof</span> <span class="class">String</span>) {
    <span class="keyword">return</span> <span class="variable">other</span>;
  } <span class="keyword">else</span> {
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">String</span>(<span class="variable">other</span>.<span class="variable">toString</span>());
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Operate on <code>right</code> with the given <code>op</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  op</p></li><li><p><strong>param</strong>: <em>Node</em>  right</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">String</span>.<span class="variable">prototype</span>.<span class="variable">operate</span> = <span class="keyword">function</span>(<span class="variable">op</span>, <span class="variable">right</span>){
  <span class="keyword">switch</span> (<span class="variable">op</span>) {
    <span class="keyword">case</span> <span class="string">'+'</span>:
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">String</span>(<span class="this">this</span>.<span class="variable">val</span> + <span class="variable">right</span>.<span class="variable">val</span>);
    <span class="keyword">default</span>:
      <span class="keyword">return</span> <span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">operate</span>.<span class="variable">call</span>(<span class="this">this</span>, <span class="variable">op</span>, <span class="variable">right</span>);
  }
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/ternary.js"><a href="#">ternary</a></h2></td><td>lib/nodes/ternary.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Ternary</code> with <code>cond</code>, <code>trueExpr</code> and <code>falseExpr</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Expression</em>  cond</p></li><li><p><strong>param</strong>: <em>Expression</em>  trueExpr</p></li><li><p><strong>param</strong>: <em>Expression</em>  falseExpr</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Ternary</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Ternary</span>(<span class="variable">cond</span>, <span class="variable">trueExpr</span>, <span class="variable">falseExpr</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">cond</span> = <span class="variable">cond</span>;
  <span class="this">this</span>.<span class="variable">trueExpr</span> = <span class="variable">trueExpr</span>;
  <span class="this">this</span>.<span class="variable">falseExpr</span> = <span class="variable">falseExpr</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Ternary</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Ternary</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">Ternary</span>(
      <span class="this">this</span>.<span class="variable">cond</span>.<span class="variable">clone</span>()
    , <span class="this">this</span>.<span class="variable">trueExpr</span>.<span class="variable">clone</span>()
    , <span class="this">this</span>.<span class="variable">falseExpr</span>.<span class="variable">clone</span>());
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">return</span> <span class="variable">clone</span>;
};</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/unaryop.js"><a href="#">unaryop</a></h2></td><td>lib/nodes/unaryop.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>UnaryOp</code> with <code>op</code>, and <code>expr</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  op</p></li><li><p><strong>param</strong>: <em>Node</em>  expr</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">UnaryOp</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">UnaryOp</span>(<span class="variable">op</span>, <span class="variable">expr</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">op</span> = <span class="variable">op</span>;
  <span class="this">this</span>.<span class="variable">expr</span> = <span class="variable">expr</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">UnaryOp</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">UnaryOp</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">UnaryOp</span>(<span class="this">this</span>.<span class="variable">op</span>, <span class="this">this</span>.<span class="variable">expr</span>.<span class="variable">clone</span>());
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">return</span> <span class="variable">clone</span>;
};</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/unit.js"><a href="#">unit</a></h2></td><td>lib/nodes/unit.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Unit</code> with the given <code>val</code> and unit <code>type</code>
such as "px", "pt", "in", etc.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  val</p></li><li><p><strong>param</strong>: <em>String</em>  type</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Unit</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Unit</span>(<span class="variable">val</span>, <span class="variable">type</span>){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">val</span> = <span class="variable">val</span>;
  <span class="this">this</span>.<span class="variable">type</span> = <span class="variable">type</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Unit</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return Boolean based on the unit value.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">toBoolean</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="class">Boolean</span>(<span class="this">this</span>.<span class="variable">val</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return unit string.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Unit</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">n</span> = <span class="this">this</span>.<span class="variable">val</span>;
  <span class="keyword">if</span> (<span class="string">'px'</span> == <span class="this">this</span>.<span class="variable">type</span>) <span class="variable">n</span> = <span class="variable">n</span>.<span class="variable">toFixed</span>(<span class="number integer">0</span>);
  <span class="keyword">return</span> <span class="variable">n</span> + (<span class="this">this</span>.<span class="variable">type</span> || <span class="string">''</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Unit</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">Unit</span>(<span class="this">this</span>.<span class="variable">val</span>, <span class="this">this</span>.<span class="variable">type</span>);
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">return</span> <span class="variable">clone</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Operate on <code>right</code> with the given <code>op</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  op</p></li><li><p><strong>param</strong>: <em>Node</em>  right</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Unit</span>.<span class="variable">prototype</span>.<span class="variable">operate</span> = <span class="keyword">function</span>(<span class="variable">op</span>, <span class="variable">right</span>){
  <span class="keyword">switch</span> (<span class="variable">op</span>) {
    <span class="keyword">case</span> <span class="string">'-'</span>:
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Unit</span>(<span class="this">this</span>.<span class="variable">val</span> - <span class="variable">right</span>.<span class="variable">val</span>, <span class="this">this</span>.<span class="variable">type</span>);
    <span class="keyword">case</span> <span class="string">'+'</span>:
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Unit</span>(<span class="this">this</span>.<span class="variable">val</span> + <span class="variable">right</span>.<span class="variable">val</span>, <span class="this">this</span>.<span class="variable">type</span>);
    <span class="keyword">case</span> <span class="string">'/'</span>:
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Unit</span>(<span class="this">this</span>.<span class="variable">val</span> / <span class="variable">right</span>.<span class="variable">val</span>, <span class="this">this</span>.<span class="variable">type</span>);
    <span class="keyword">case</span> <span class="string">'*'</span>:
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Unit</span>(<span class="this">this</span>.<span class="variable">val</span> * <span class="variable">right</span>.<span class="variable">val</span>, <span class="this">this</span>.<span class="variable">type</span>);
    <span class="keyword">case</span> <span class="string">'%'</span>:
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Unit</span>(<span class="this">this</span>.<span class="variable">val</span> % <span class="variable">right</span>.<span class="variable">val</span>, <span class="this">this</span>.<span class="variable">type</span>);
    <span class="keyword">case</span> <span class="string">'**'</span>:
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Unit</span>(<span class="class">Math</span>.<span class="variable">pow</span>(<span class="this">this</span>.<span class="variable">val</span>, <span class="variable">right</span>.<span class="variable">val</span>), <span class="this">this</span>.<span class="variable">type</span>);
    <span class="keyword">case</span> <span class="string">'..'</span>:
    <span class="keyword">case</span> <span class="string">'...'</span>:
      <span class="keyword">var</span> <span class="variable">start</span> = <span class="this">this</span>.<span class="variable">val</span>
        , <span class="variable">end</span> = <span class="variable">right</span>.<span class="variable">val</span>
        , <span class="variable">expr</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Expression</span>
        , <span class="variable">inclusive</span> = <span class="string">'..'</span> == <span class="variable">op</span>;
      <span class="keyword">do</span> {
        <span class="variable">expr</span>.<span class="variable">push</span>(<span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">start</span>));
      } <span class="keyword">while</span> (<span class="variable">inclusive</span> ? ++<span class="variable">start</span> &<span class="variable">lt</span>;= <span class="variable">end</span> : ++<span class="variable">start</span> &<span class="variable">lt</span>; <span class="variable">end</span>);
      <span class="keyword">return</span> <span class="variable">expr</span>;
    <span class="keyword">default</span>:
      <span class="keyword">return</span> <span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">operate</span>.<span class="variable">call</span>(<span class="this">this</span>, <span class="variable">op</span>, <span class="variable">right</span>);
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Coerce <code>other</code> unit to the same type as <code>this</code> unit.</p>

<h2>Supports</h2>

<p>   mm -&gt; cm | in
   cm -&gt; mm | in
   in -&gt; mm | cm</p>

<p>   ms -&gt; s
   s  -&gt; ms</p>

<p>   Hz  -&gt; kHz
   kHz -&gt; Hz</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Unit</em>  other</p></li><li><p><strong>return</strong>: <em>Unit</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Unit</span>.<span class="variable">prototype</span>.<span class="variable">coerce</span> = <span class="keyword">function</span>(<span class="variable">other</span>){
  <span class="keyword">if</span> (<span class="variable">other</span> <span class="variable">instanceof</span> <span class="class">Unit</span>) {
    <span class="keyword">var</span> <span class="variable">a</span> = <span class="this">this</span>
      , <span class="variable">b</span> = <span class="variable">other</span>;
    <span class="keyword">switch</span> (<span class="variable">a</span>.<span class="variable">type</span>) {
      <span class="keyword">case</span> <span class="string">'mm'</span>:
        <span class="keyword">switch</span> (<span class="variable">b</span>.<span class="variable">type</span>) {
          <span class="keyword">case</span> <span class="string">'cm'</span>:
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">b</span>.<span class="variable">val</span> * <span class="number float">2.54</span>, <span class="string">'mm'</span>);
          <span class="keyword">case</span> <span class="string">'in'</span>:
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">b</span>.<span class="variable">val</span> * <span class="number float">25.4</span>, <span class="string">'mm'</span>);
        }
      <span class="keyword">case</span> <span class="string">'cm'</span>:
        <span class="keyword">switch</span> (<span class="variable">b</span>.<span class="variable">type</span>) {
          <span class="keyword">case</span> <span class="string">'mm'</span>:
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">b</span>.<span class="variable">val</span> / <span class="number integer">10</span>, <span class="string">'cm'</span>);
          <span class="keyword">case</span> <span class="string">'in'</span>:
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">b</span>.<span class="variable">val</span> * <span class="number float">2.54</span>, <span class="string">'cm'</span>);
        }
      <span class="keyword">case</span> <span class="string">'in'</span>:
        <span class="keyword">switch</span> (<span class="variable">b</span>.<span class="variable">type</span>) {
          <span class="keyword">case</span> <span class="string">'mm'</span>:
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">b</span>.<span class="variable">val</span> / <span class="number float">25.4</span>, <span class="string">'in'</span>);
          <span class="keyword">case</span> <span class="string">'cm'</span>:
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">b</span>.<span class="variable">val</span> / <span class="number float">2.54</span>, <span class="string">'in'</span>);
        }
      <span class="keyword">case</span> <span class="string">'ms'</span>:
        <span class="keyword">switch</span> (<span class="variable">b</span>.<span class="variable">type</span>) {
          <span class="keyword">case</span> <span class="string">'s'</span>:
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">b</span>.<span class="variable">val</span> * <span class="number integer">1000</span>, <span class="string">'ms'</span>);
        }
      <span class="keyword">case</span> <span class="string">'s'</span>:
        <span class="keyword">switch</span> (<span class="variable">b</span>.<span class="variable">type</span>) {
          <span class="keyword">case</span> <span class="string">'ms'</span>:
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">b</span>.<span class="variable">val</span> / <span class="number integer">1000</span>, <span class="string">'s'</span>);
        }
      <span class="keyword">case</span> <span class="string">'Hz'</span>:
        <span class="keyword">switch</span> (<span class="variable">b</span>.<span class="variable">type</span>) {
          <span class="keyword">case</span> <span class="string">'kHz'</span>:
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">b</span>.<span class="variable">val</span> * <span class="number integer">1000</span>, <span class="string">'Hz'</span>);
        }
      <span class="keyword">case</span> <span class="string">'kHz'</span>:
        <span class="keyword">switch</span> (<span class="variable">b</span>.<span class="variable">type</span>) {
          <span class="keyword">case</span> <span class="string">'Hz'</span>:
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">b</span>.<span class="variable">val</span> / <span class="number integer">1000</span>, <span class="string">'kHz'</span>);
        }
    }
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Unit</span>(<span class="variable">b</span>.<span class="variable">val</span>, <span class="variable">a</span>.<span class="variable">type</span>);
  } <span class="keyword">else</span> {
    <span class="keyword">return</span> <span class="class">Node</span>.<span class="variable">prototype</span>.<span class="variable">coerce</span>.<span class="variable">call</span>(<span class="this">this</span>, <span class="variable">other</span>);
  }
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/parser.js"><a href="#">parser</a></h2></td><td>lib/parser.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Lexer</span> = <span class="variable">require</span>(<span class="string">'./lexer'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./nodes'</span>)
  , <span class="variable">inspect</span> = <span class="variable">require</span>(<span class="string">'sys'</span>).<span class="variable">inspect</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Selector composite tokens.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">selectorTokens</span> = [
    <span class="string">'ident'</span>
  , <span class="string">'string'</span>
  , <span class="string">'selector'</span>
  , <span class="string">'function'</span>
  , <span class="string">'color'</span>
  , <span class="string">'unit'</span>
  , <span class="string">'['</span>
  , <span class="string">']'</span>
  , <span class="string">'('</span>
  , <span class="string">')'</span>
  , <span class="string">'+'</span>
  , <span class="string">'-'</span>
  , <span class="string">'*'</span>
  , <span class="string">'&lt;'</span>
  , <span class="string">'&gt;'</span>
  , <span class="string">'='</span>
  , <span class="string">':'</span>
  , <span class="string">'&amp;'</span>
  , <span class="string">'~'</span>
];</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Parser</code> with the given <code>str</code> and <code>options</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  str</p></li><li><p><strong>param</strong>: <em>Object</em>  options</p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Parser</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Parser</span>(<span class="variable">str</span>, <span class="variable">options</span>) {
  <span class="variable">options</span> = <span class="variable">options</span> || {};
  <span class="this">this</span>.<span class="variable">str</span> = <span class="variable">nodes</span>.<span class="variable">source</span> = <span class="variable">str</span>;
  <span class="this">this</span>.<span class="variable">filename</span> = <span class="variable">nodes</span>.<span class="variable">filename</span> = <span class="variable">options</span>.<span class="variable">filename</span> || <span class="string">'stylus'</span>;
  <span class="this">this</span>.<span class="variable">lexer</span> = <span class="keyword">new</span> <span class="class">Lexer</span>(<span class="variable">str</span>, <span class="variable">options</span>);
  <span class="this">this</span>.<span class="variable">root</span> = <span class="variable">options</span>.<span class="variable">root</span> || <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Root</span>;
  <span class="this">this</span>.<span class="variable">state</span> = [<span class="string">'root'</span>];
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Parser prototype.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Parser</span>.<span class="variable">prototype</span> = {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Constructor.
   </p>
</td>
<td class="code">
<pre><code><span class="variable">constructor</span>: <span class="class">Parser</span>,</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return current state.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">currentState</span>() {
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">state</span>[<span class="this">this</span>.<span class="variable">state</span>.<span class="variable">length</span> - <span class="number integer">1</span>];
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Parse the input, then return the root node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">parse</span>: <span class="keyword">function</span>(){
    <span class="keyword">var</span> <span class="variable">block</span> = <span class="this">this</span>.<span class="variable">parent</span> = <span class="this">this</span>.<span class="variable">root</span>;
    <span class="keyword">while</span> (<span class="string">'eos'</span> != <span class="this">this</span>.<span class="variable">peek</span>.<span class="variable">type</span>) {
      <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'newline'</span>)) <span class="keyword">continue</span>;
      <span class="keyword">var</span> <span class="variable">stmt</span> = <span class="this">this</span>.<span class="variable">statement</span>;
      <span class="keyword">if</span> (!<span class="variable">stmt</span>) <span class="this">this</span>.<span class="variable">error</span>(<span class="string">'unexpected token {peek}, not allowed at the root level'</span>);
      <span class="variable">block</span>.<span class="variable">push</span>(<span class="variable">stmt</span>);
    }
    <span class="keyword">return</span> <span class="variable">block</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Throw an <code>Error</code> with the given <code>msg</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  msg</p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">error</span>: <span class="keyword">function</span>(<span class="variable">msg</span>){
    <span class="keyword">var</span> <span class="variable">type</span> = <span class="this">this</span>.<span class="variable">peek</span>.<span class="variable">type</span>
      , <span class="variable">val</span> = <span class="variable">undefined</span> == <span class="this">this</span>.<span class="variable">peek</span>.<span class="variable">val</span>
        ? <span class="string">''</span>
        : <span class="string">' '</span> + <span class="this">this</span>.<span class="variable">peek</span>.<span class="variable">toString</span>();
    <span class="keyword">if</span> (<span class="variable">val</span>.<span class="variable">trim</span>() == <span class="variable">type</span>.<span class="variable">trim</span>()) <span class="variable">val</span> = <span class="string">''</span>;
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="variable">msg</span>.<span class="variable">replace</span>(<span class="string">'{peek}'</span>, <span class="variable">type</span> + <span class="variable">val</span>));
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Accept the given token <code>type</code>, and return it,
otherwise return <code>undefined</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  type</p></li><li><p><strong>return</strong>: <em>Token</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">accept</span>: <span class="keyword">function</span>(<span class="variable">type</span>){
    <span class="keyword">if</span> (<span class="variable">type</span> == <span class="this">this</span>.<span class="variable">peek</span>.<span class="variable">type</span>) {
      <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">next</span>;
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expect token <code>type</code> and return it, throw otherwise.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  type</p></li><li><p><strong>return</strong>: <em>Token</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">expect</span>: <span class="keyword">function</span>(<span class="variable">type</span>){
    <span class="keyword">if</span> (<span class="variable">type</span> != <span class="this">this</span>.<span class="variable">peek</span>.<span class="variable">type</span>) {
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'expected '</span> + <span class="variable">type</span> + <span class="string">', got '</span> + <span class="this">this</span>.<span class="variable">peek</span>);
    }
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">next</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Get the next token.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Token</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">next</span>() {
    <span class="keyword">var</span> <span class="variable">tok</span> = <span class="this">this</span>.<span class="variable">lexer</span>.<span class="variable">next</span>;
    <span class="variable">nodes</span>.<span class="variable">lineno</span> = <span class="variable">tok</span>.<span class="variable">lineno</span>;
    <span class="keyword">return</span> <span class="variable">tok</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Peek with lookahead(1).</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Token</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">peek</span>() {
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">lexer</span>.<span class="variable">peek</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Lookahead <code>n</code> tokens.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  n</p></li><li><p><strong>return</strong>: <em>Token</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">lookahead</span>: <span class="keyword">function</span>(<span class="variable">n</span>){
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">lexer</span>.<span class="variable">lookahead</span>(<span class="variable">n</span>);
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Check if the token at <code>n</code> is a valid selector token. </p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number</em>  n</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">isSelectorToken</span>: <span class="keyword">function</span>(<span class="variable">n</span>) {
    <span class="keyword">return</span> ~<span class="variable">selectorTokens</span>.<span class="variable">indexOf</span>(<span class="this">this</span>.<span class="variable">lookahead</span>(<span class="variable">n</span>).<span class="variable">type</span>);
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Valid selector tokens.
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">selectorToken</span>() {
    <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">isSelectorToken</span>(<span class="number integer">1</span>)) <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">next</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>   ident
 | selector
 | literal
 | charset
 | import
 | expression
 | 'return' expression
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">statement</span>() {
    <span class="keyword">var</span> <span class="variable">type</span> = <span class="this">this</span>.<span class="variable">peek</span>.<span class="variable">type</span>;
    <span class="keyword">switch</span> (<span class="variable">type</span>) {
      <span class="keyword">case</span> <span class="string">'selector'</span>:
      <span class="keyword">case</span> <span class="string">'literal'</span>:
      <span class="keyword">case</span> <span class="string">'charset'</span>:
      <span class="keyword">case</span> <span class="string">'import'</span>:
      <span class="keyword">case</span> <span class="string">'ident'</span>:
      <span class="keyword">case</span> <span class="string">'unless'</span>:
      <span class="keyword">case</span> <span class="string">'function'</span>:
      <span class="keyword">case</span> <span class="string">'if'</span>:
        <span class="keyword">return</span> <span class="this">this</span>[<span class="variable">type</span>];
      <span class="keyword">case</span> <span class="string">'return'</span>:
        <span class="keyword">return</span> <span class="this">this</span>.<span class="keyword">return</span>;
      <span class="keyword">default</span>:
        <span class="comment">// Contextual selectors</span>
        <span class="keyword">switch</span> (<span class="this">this</span>.<span class="variable">currentState</span>) {
          <span class="keyword">case</span> <span class="string">'root'</span>:
          <span class="keyword">case</span> <span class="string">'selector'</span>:
          <span class="keyword">case</span> <span class="string">'conditional'</span>:
          <span class="keyword">case</span> <span class="string">'function body'</span>:
            <span class="keyword">switch</span> (<span class="variable">type</span>) {
              <span class="keyword">case</span> <span class="string">'color'</span>:
              <span class="keyword">case</span> <span class="string">'~'</span>:
              <span class="keyword">case</span> <span class="string">'+'</span>:
              <span class="keyword">case</span> <span class="string">'&gt;'</span>:
              <span class="keyword">case</span> <span class="string">'&lt;'</span>:
              <span class="keyword">case</span> <span class="string">'*'</span>:
              <span class="keyword">case</span> <span class="string">':'</span>:
              <span class="keyword">case</span> <span class="string">'&amp;'</span>:
              <span class="keyword">case</span> <span class="string">'['</span>:
                <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">selector</span>;
            }
        }

        <span class="comment">// Expression fallback</span>
        <span class="keyword">var</span> <span class="variable">expr</span> = <span class="this">this</span>.<span class="variable">expression</span>;
        <span class="keyword">if</span> (<span class="variable">expr</span>.<span class="variable">isEmpty</span>) <span class="this">this</span>.<span class="variable">error</span>(<span class="string">'unexpected {peek}'</span>);
        <span class="keyword">return</span> <span class="variable">expr</span>;
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>indent (!outdent)+ outdent
   </p>
</td>
<td class="code">
<pre><code><span class="variable">block</span>: <span class="keyword">function</span>(<span class="variable">node</span>, <span class="variable">scope</span>) {
    <span class="keyword">var</span> <span class="variable">block</span> = <span class="this">this</span>.<span class="variable">parent</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Block</span>(<span class="this">this</span>.<span class="variable">parent</span>, <span class="variable">node</span>);
    <span class="keyword">if</span> (<span class="variable">false</span> === <span class="variable">scope</span>) <span class="variable">block</span>.<span class="variable">scope</span> = <span class="variable">false</span>;
    <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">'indent'</span>);
    <span class="keyword">while</span> (<span class="string">'outdent'</span> != <span class="this">this</span>.<span class="variable">peek</span>.<span class="variable">type</span>) {
      <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'newline'</span>)) <span class="keyword">continue</span>;
      <span class="keyword">var</span> <span class="variable">stmt</span> = <span class="this">this</span>.<span class="variable">statement</span>;
      <span class="keyword">if</span> (!<span class="variable">stmt</span>) <span class="this">this</span>.<span class="variable">error</span>(<span class="string">'unexpected token {peek} in block'</span>);
      <span class="variable">block</span>.<span class="variable">push</span>(<span class="variable">stmt</span>);
    }
    <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">'outdent'</span>);
    <span class="this">this</span>.<span class="variable">parent</span> = <span class="variable">block</span>.<span class="variable">parent</span>;
    <span class="keyword">return</span> <span class="variable">block</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>return expression
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="keyword">return</span>() {
    <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">'return'</span>);
    <span class="keyword">var</span> <span class="variable">expr</span> = <span class="this">this</span>.<span class="variable">expression</span>;
    <span class="keyword">return</span> <span class="variable">expr</span>.<span class="variable">isEmpty</span>
      ? <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Return</span>
      : <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Return</span>(<span class="variable">expr</span>);
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>unless expression block
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">unless</span>() {
    <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">'unless'</span>);
    <span class="keyword">var</span> <span class="variable">node</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">If</span>(<span class="this">this</span>.<span class="variable">expression</span>, <span class="variable">true</span>);
    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">push</span>(<span class="string">'conditional'</span>);
    <span class="variable">node</span>.<span class="variable">block</span> = <span class="this">this</span>.<span class="variable">block</span>(<span class="variable">node</span>, <span class="variable">false</span>);
    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">pop</span>();
    <span class="keyword">return</span> <span class="variable">node</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>if expression block (else block)?
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="keyword">if</span>() {
    <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">'if'</span>);
    <span class="keyword">var</span> <span class="variable">node</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">If</span>(<span class="this">this</span>.<span class="variable">expression</span>);
    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">push</span>(<span class="string">'conditional'</span>);
    <span class="variable">node</span>.<span class="variable">block</span> = <span class="this">this</span>.<span class="variable">block</span>(<span class="variable">node</span>, <span class="variable">false</span>);
    <span class="keyword">while</span> (<span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'else'</span>)) {
      <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'if'</span>)) {
        <span class="keyword">var</span> <span class="variable">cond</span> = <span class="this">this</span>.<span class="variable">expression</span>
          , <span class="variable">block</span> = <span class="this">this</span>.<span class="variable">block</span>(<span class="variable">node</span>, <span class="variable">false</span>);
        <span class="variable">node</span>.<span class="variable">elses</span>.<span class="variable">push</span>(<span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">If</span>(<span class="variable">cond</span>, <span class="variable">block</span>));
      } <span class="keyword">else</span> {
        <span class="variable">node</span>.<span class="variable">elses</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">block</span>(<span class="variable">node</span>, <span class="variable">false</span>));
        <span class="keyword">break</span>;
      }
    }
    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">pop</span>();
    <span class="keyword">return</span> <span class="variable">node</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>import string
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="keyword">import</span>() {
    <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">'import'</span>);
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Import</span>(<span class="this">this</span>.<span class="variable">expect</span>(<span class="string">'string'</span>).<span class="variable">val</span>.<span class="variable">val</span>);
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>charset string
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">charset</span>() {
    <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">'charset'</span>);
    <span class="keyword">var</span> <span class="variable">str</span> = <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">'string'</span>).<span class="variable">val</span>;
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Charset</span>(<span class="variable">str</span>);
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>literal
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">literal</span>() {
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">'literal'</span>).<span class="variable">val</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>  ident
| assignment
| property
| selector
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">ident</span>() {
    <span class="keyword">var</span> <span class="variable">la</span> = <span class="this">this</span>.<span class="variable">lookahead</span>(<span class="number integer">2</span>).<span class="variable">type</span>
      , <span class="variable">ident</span> = <span class="this">this</span>.<span class="variable">_ident</span>;

    <span class="keyword">switch</span> (<span class="variable">la</span>) {
      <span class="comment">// Assignment</span>
      <span class="keyword">case</span> <span class="string">'='</span>:
      <span class="keyword">case</span> <span class="string">'?='</span>:
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">assignment</span>;
      <span class="comment">// Operation</span>
      <span class="comment">// TODO: cleanup / abstract</span>
      <span class="keyword">case</span> <span class="string">'-'</span>:
      <span class="keyword">case</span> <span class="string">'+'</span>:
      <span class="keyword">case</span> <span class="string">'/'</span>:
      <span class="keyword">case</span> <span class="string">'*'</span>:
      <span class="keyword">case</span> <span class="string">'%'</span>:
      <span class="keyword">case</span> <span class="string">'**'</span>:
      <span class="keyword">case</span> <span class="string">'and'</span>:
      <span class="keyword">case</span> <span class="string">'or'</span>:
      <span class="keyword">case</span> <span class="string">'&amp;&amp;'</span>:
      <span class="keyword">case</span> <span class="string">'||'</span>:
      <span class="keyword">case</span> <span class="string">'&gt;'</span>:
      <span class="keyword">case</span> <span class="string">'&lt;'</span>:
      <span class="keyword">case</span> <span class="string">'&gt;='</span>:
      <span class="keyword">case</span> <span class="string">'&lt;='</span>:
      <span class="keyword">case</span> <span class="string">'!='</span>:
      <span class="keyword">case</span> <span class="string">'=='</span>:
      <span class="keyword">case</span> <span class="string">'?'</span>:
      <span class="keyword">case</span> <span class="string">'is a'</span>:
      <span class="keyword">case</span> <span class="string">'is defined'</span>:
        <span class="comment">// Prevent cyclic .ident, return literal</span>
        <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">_ident</span> == <span class="this">this</span>.<span class="variable">peek</span>) {
          <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">next</span>.<span class="variable">val</span>;
        } <span class="keyword">else</span> {
          <span class="this">this</span>.<span class="variable">_ident</span> = <span class="this">this</span>.<span class="variable">peek</span>;
          <span class="keyword">switch</span> (<span class="this">this</span>.<span class="variable">currentState</span>) {
            <span class="comment">// unary op in property</span>
            <span class="keyword">case</span> <span class="string">'selector'</span>:
              <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">property</span>;
            <span class="comment">// Part of a selector</span>
            <span class="keyword">case</span> <span class="string">'root'</span>:
              <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">selector</span>;
            <span class="comment">// Do not disrupt the ident when an operand</span>
            <span class="keyword">default</span>:
              <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">operand</span>
                ? <span class="this">this</span>.<span class="variable">next</span>.<span class="variable">val</span>
                : <span class="this">this</span>.<span class="variable">expression</span>;
          }
        }
      <span class="comment">// Selector or property</span>
      <span class="keyword">default</span>:
        <span class="keyword">switch</span> (<span class="this">this</span>.<span class="variable">currentState</span>) {
          <span class="keyword">case</span> <span class="string">'root'</span>:
            <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">selector</span>;
          <span class="keyword">case</span> <span class="string">'selector'</span>:
          <span class="keyword">case</span> <span class="string">'function body'</span>:
          <span class="keyword">case</span> <span class="string">'conditional'</span>:
            <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">property</span>;
          <span class="keyword">default</span>:
            <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">next</span>.<span class="variable">val</span>;
        }
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>  property expression
| ident
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">property</span>() {
    <span class="comment">// TODO: refactor</span>

    <span class="comment">// Look-ahead for trailing comma</span>
    <span class="comment">// indicating that this is really</span>
    <span class="comment">// a selector</span>
    <span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>;
    <span class="keyword">while</span> (<span class="this">this</span>.<span class="variable">isSelectorToken</span>(++<span class="variable">i</span>)) ;
    <span class="keyword">if</span> (<span class="string">','</span> == <span class="this">this</span>.<span class="variable">lookahead</span>(<span class="variable">i</span>).<span class="variable">type</span>
      &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="string">'newline'</span> == <span class="this">this</span>.<span class="variable">lookahead</span>(<span class="variable">i</span> + <span class="number integer">1</span>).<span class="variable">type</span>)
      <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">selector</span>;

    <span class="comment">// Look-ahead for indentation</span>
    <span class="comment">// again indicating that this is</span>
    <span class="comment">// a selector</span>
    <span class="keyword">while</span> (<span class="string">'newline'</span> != <span class="this">this</span>.<span class="variable">lookahead</span>(<span class="variable">i</span>)
      &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="string">'outdent'</span> != <span class="this">this</span>.<span class="variable">lookahead</span>(<span class="variable">i</span>)
      &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="string">'indent'</span> != <span class="this">this</span>.<span class="variable">lookahead</span>(<span class="variable">i</span>)) ++<span class="variable">i</span>;

    <span class="keyword">if</span> (<span class="string">'indent'</span> == <span class="this">this</span>.<span class="variable">lookahead</span>(<span class="variable">i</span>))
      <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">selector</span>;

    <span class="comment">// Property</span>
    <span class="keyword">var</span> <span class="variable">ident</span> = <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">'ident'</span>).<span class="variable">val</span>
      , <span class="variable">name</span> = <span class="variable">ident</span>.<span class="variable">name</span>
      , <span class="variable">prop</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Property</span>(<span class="variable">name</span>);

    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">push</span>(<span class="string">'property value'</span>);
    <span class="variable">prop</span>.<span class="variable">expr</span> = <span class="this">this</span>.<span class="variable">list</span>;
    <span class="keyword">if</span> (<span class="variable">prop</span>.<span class="variable">expr</span>.<span class="variable">isEmpty</span>) <span class="keyword">return</span> <span class="variable">ident</span>;
    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">pop</span>();

    <span class="keyword">return</span> <span class="variable">prop</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>  selector ',' selector
| selector newline selector
| selector block
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">selector</span>() {
    <span class="keyword">var</span> <span class="variable">tok</span>
      , <span class="variable">arr</span>
      , <span class="variable">val</span>
      , <span class="variable">prev</span>
      , <span class="variable">parent</span>
      , <span class="variable">group</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Group</span>;

    <span class="keyword">do</span> {
      <span class="variable">val</span> = <span class="variable">prev</span> = <span class="keyword">null</span>;
      <span class="variable">arr</span> = [];

      <span class="comment">// Clobber newline after ,</span>
      <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'newline'</span>);

      <span class="comment">// Parent ref</span>
      <span class="variable">parent</span> = !! <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'&amp;'</span>);

      <span class="comment">// Selector candidates,</span>
      <span class="comment">// stitched together to</span>
      <span class="comment">// form a selector.</span>
      <span class="keyword">while</span> (<span class="variable">tok</span> = <span class="this">this</span>.<span class="variable">selectorToken</span>) {
        <span class="comment">// Selector component</span>
        <span class="keyword">switch</span> (<span class="variable">tok</span>.<span class="variable">type</span>) {
          <span class="keyword">case</span> <span class="string">'unit'</span>: <span class="variable">val</span> = <span class="variable">tok</span>.<span class="variable">val</span>.<span class="variable">val</span>; <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">'ident'</span>: <span class="variable">val</span> = <span class="variable">tok</span>.<span class="variable">val</span>.<span class="variable">name</span>; <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">'function'</span>: <span class="variable">val</span> = <span class="variable">tok</span>.<span class="variable">val</span>.<span class="variable">name</span> + <span class="string">'('</span>; <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">'string'</span>: <span class="variable">val</span> = <span class="variable">tok</span>.<span class="variable">val</span>.<span class="variable">toString</span>(); <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">'color'</span>: <span class="variable">val</span> = <span class="variable">tok</span>.<span class="variable">val</span>.<span class="variable">toString</span>(); <span class="keyword">break</span>;
          <span class="keyword">default</span>: <span class="variable">val</span> = <span class="variable">tok</span>.<span class="variable">val</span>;
        }

        <span class="comment">// Whitespace support</span>
        <span class="keyword">if</span> (!<span class="variable">prev</span> || <span class="variable">prev</span>.<span class="variable">space</span>) {
          <span class="variable">arr</span>.<span class="variable">push</span>(<span class="variable">val</span>);
        } <span class="keyword">else</span> {
          <span class="variable">arr</span>[<span class="variable">arr</span>.<span class="variable">length</span>-<span class="number integer">1</span>] += <span class="variable">val</span>;
        }
        <span class="variable">prev</span> = <span class="variable">tok</span>;
      }

      <span class="comment">// Push the selector</span>
      <span class="variable">group</span>.<span class="variable">push</span>(<span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Selector</span>(<span class="variable">arr</span>.<span class="variable">join</span>(<span class="string">' '</span>), <span class="variable">parent</span>));
    } <span class="keyword">while</span> (<span class="this">this</span>.<span class="variable">accept</span>(<span class="string">','</span>) || <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'newline'</span>));

    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">push</span>(<span class="string">'selector'</span>);
    <span class="variable">group</span>.<span class="variable">block</span> = <span class="this">this</span>.<span class="variable">block</span>(<span class="variable">group</span>);
    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">pop</span>();

    <span class="keyword">return</span> <span class="variable">group</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>ident ('=' | '?=') expression
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">assignment</span>() {
    <span class="keyword">var</span> <span class="variable">name</span> = <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">'ident'</span>).<span class="variable">val</span>.<span class="variable">name</span>
      , <span class="variable">op</span> = <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'='</span>) || <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'?='</span>);

    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">push</span>(<span class="string">'assignment'</span>);
    <span class="keyword">var</span> <span class="variable">expr</span> = <span class="this">this</span>.<span class="variable">list</span>;
    <span class="keyword">if</span> (<span class="variable">expr</span>.<span class="variable">isEmpty</span>) <span class="this">this</span>.<span class="variable">error</span>(<span class="string">'invalid right-hand side operand in assignment, got {peek}'</span>)
    <span class="keyword">var</span> <span class="variable">node</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Ident</span>(<span class="variable">name</span>, <span class="variable">expr</span>);
    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">pop</span>();

    <span class="comment">// Conditional assignment</span>
    <span class="keyword">if</span> (<span class="string">'?='</span> == <span class="variable">op</span>) {
      <span class="keyword">var</span> <span class="variable">defined</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">BinOp</span>(<span class="string">'is defined'</span>, <span class="variable">node</span>)
        , <span class="variable">lookup</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Ident</span>(<span class="variable">name</span>);
      <span class="variable">node</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Ternary</span>(<span class="variable">defined</span>, <span class="variable">lookup</span>, <span class="variable">node</span>);
    }

    <span class="keyword">return</span> <span class="variable">node</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>  definition
| call
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="keyword">function</span>() {
    <span class="keyword">var</span> <span class="variable">ident</span> = <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">'function'</span>).<span class="variable">val</span>
      , <span class="variable">name</span> = <span class="this">this</span>.<span class="variable">_name</span> = <span class="variable">ident</span>.<span class="variable">name</span>
      , <span class="variable">tok</span>
      , <span class="variable">i</span> = <span class="number integer">1</span>
      , <span class="variable">parens</span> = <span class="number integer">1</span>;

    <span class="comment">// Lookahead and determine if we are dealing</span>
    <span class="comment">// with a function call or definition. Here</span>
    <span class="comment">// we pair parens to prevent false negatives</span>
    <span class="variable">out</span>:
    <span class="keyword">while</span> (<span class="variable">tok</span> = <span class="this">this</span>.<span class="variable">lookahead</span>(<span class="variable">i</span>++)) {
      <span class="keyword">switch</span> (<span class="variable">tok</span>.<span class="variable">type</span>) {
        <span class="keyword">case</span> <span class="string">'function'</span>: <span class="keyword">case</span> <span class="string">'('</span>: ++<span class="variable">parens</span>; <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="string">')'</span>: <span class="keyword">if</span> (!--<span class="variable">parens</span>) <span class="keyword">break</span> <span class="variable">out</span>;
      }
    }
    
    <span class="comment">// Definition or call</span>
    <span class="keyword">switch</span> (<span class="this">this</span>.<span class="variable">currentState</span>) {
      <span class="keyword">case</span> <span class="string">'expression'</span>:
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">functionCall</span>;
      <span class="keyword">default</span>:
        <span class="keyword">return</span> <span class="string">'indent'</span> == <span class="this">this</span>.<span class="variable">lookahead</span>(<span class="variable">i</span>).<span class="variable">type</span>
          ? <span class="this">this</span>.<span class="variable">functionDefinition</span>
          : <span class="this">this</span>.<span class="variable">functionCall</span>;
    }
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>ident '(' expression ')'
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">functionCall</span>() {
    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">push</span>(<span class="string">'function arguments'</span>);
    <span class="keyword">var</span> <span class="variable">name</span> = <span class="this">this</span>.<span class="variable">_name</span>
      , <span class="variable">args</span> = <span class="this">this</span>.<span class="variable">list</span>;
    <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">')'</span>);
    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">pop</span>();
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Call</span>(<span class="variable">name</span>, <span class="variable">args</span>);
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>ident '(' params ')' block
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">functionDefinition</span>() {
    <span class="comment">// Params</span>
    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">push</span>(<span class="string">'function params'</span>);
    <span class="keyword">var</span> <span class="variable">name</span> = <span class="this">this</span>.<span class="variable">_name</span>
      , <span class="variable">params</span> = <span class="this">this</span>.<span class="variable">params</span>;
    <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">')'</span>);
    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">pop</span>();

    <span class="comment">// Body</span>
    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">push</span>(<span class="string">'function body'</span>);
    <span class="keyword">var</span> <span class="variable">fn</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Function</span>(<span class="variable">name</span>, <span class="variable">params</span>);
    <span class="variable">fn</span>.<span class="variable">block</span> = <span class="this">this</span>.<span class="variable">block</span>(<span class="variable">fn</span>);
    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">pop</span>();
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Ident</span>(<span class="variable">name</span>, <span class="variable">fn</span>);
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>(ident (',' ident ('=' expression)?)*)?
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">params</span>() {
    <span class="keyword">var</span> <span class="variable">tok</span>
      , <span class="variable">params</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Params</span>;
    <span class="keyword">while</span> (<span class="variable">tok</span> = <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'ident'</span>)) {
      <span class="variable">params</span>.<span class="variable">push</span>(<span class="variable">tok</span>.<span class="variable">val</span>);
      <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'='</span>)) {
        <span class="variable">tok</span>.<span class="variable">val</span>.<span class="variable">val</span> = <span class="this">this</span>.<span class="variable">expression</span>;
      }
      <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">','</span>);
    }
    <span class="keyword">return</span> <span class="variable">params</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>expression (',' expression)*
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">list</span>() {
    <span class="keyword">var</span> <span class="variable">node</span> = <span class="this">this</span>.<span class="variable">expression</span>;
    <span class="keyword">while</span> (<span class="this">this</span>.<span class="variable">accept</span>(<span class="string">','</span>)) {
      <span class="keyword">if</span> (<span class="variable">node</span>.<span class="variable">isList</span>) {
        <span class="variable">list</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">expression</span>);
      } <span class="keyword">else</span> {
        <span class="keyword">var</span> <span class="variable">list</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Expression</span>(<span class="variable">true</span>);
        <span class="variable">list</span>.<span class="variable">push</span>(<span class="variable">node</span>);
        <span class="variable">list</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">expression</span>);
        <span class="variable">node</span> = <span class="variable">list</span>;
      }
    }
    <span class="keyword">return</span> <span class="variable">node</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>negation+
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">expression</span>() {
    <span class="keyword">var</span> <span class="variable">node</span>
      , <span class="variable">expr</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Expression</span>;
    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">push</span>(<span class="string">'expression'</span>);
    <span class="keyword">while</span> (<span class="variable">node</span> = <span class="this">this</span>.<span class="variable">negation</span>) {
      <span class="keyword">if</span> (!<span class="variable">node</span>) <span class="this">this</span>.<span class="variable">error</span>(<span class="string">'unexpected token {peek} in expression'</span>);
      <span class="variable">expr</span>.<span class="variable">push</span>(<span class="variable">node</span>);
    }
    <span class="this">this</span>.<span class="variable">state</span>.<span class="variable">pop</span>();
    <span class="keyword">return</span> <span class="variable">expr</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>  'not' ternary
| ternary
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">negation</span>() {
    <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'not'</span>)) {
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">UnaryOp</span>(<span class="string">'!'</span>, <span class="this">this</span>.<span class="variable">negation</span>);
    }
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">ternary</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>logical ('?' expression ':' expression)?
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">ternary</span>() {
    <span class="keyword">var</span> <span class="variable">node</span> = <span class="this">this</span>.<span class="variable">logical</span>;
    <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'?'</span>)) {
      <span class="keyword">var</span> <span class="variable">trueExpr</span> = <span class="this">this</span>.<span class="variable">expression</span>;
      <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">':'</span>);
      <span class="keyword">var</span> <span class="variable">falseExpr</span> = <span class="this">this</span>.<span class="variable">expression</span>;
      <span class="variable">node</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Ternary</span>(<span class="variable">node</span>, <span class="variable">trueExpr</span>, <span class="variable">falseExpr</span>);
    }
    <span class="keyword">return</span> <span class="variable">node</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>typecheck (('&amp;&amp;' | '||') typecheck)*
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">logical</span>() {
    <span class="keyword">var</span> <span class="variable">op</span>
      , <span class="variable">node</span> = <span class="this">this</span>.<span class="variable">typecheck</span>;
    <span class="keyword">while</span> (<span class="variable">op</span> = <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'&amp;&amp;'</span>) || <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'||'</span>)) {
      <span class="variable">node</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">BinOp</span>(<span class="variable">op</span>.<span class="variable">type</span>, <span class="variable">node</span>, <span class="this">this</span>.<span class="variable">typecheck</span>);
    }
    <span class="keyword">return</span> <span class="variable">node</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>equality ('is a' equality)*
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">typecheck</span>() {
    <span class="keyword">var</span> <span class="variable">op</span>
      , <span class="variable">node</span> = <span class="this">this</span>.<span class="variable">equality</span>;
    <span class="keyword">while</span> (<span class="variable">op</span> = <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'is a'</span>)) {
      <span class="this">this</span>.<span class="variable">operand</span> = <span class="variable">true</span>;
      <span class="keyword">if</span> (!<span class="variable">node</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'illegal unary '</span> + <span class="variable">op</span>);
      <span class="variable">node</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">BinOp</span>(<span class="variable">op</span>.<span class="variable">type</span>, <span class="variable">node</span>, <span class="this">this</span>.<span class="variable">equality</span>);
      <span class="this">this</span>.<span class="variable">operand</span> = <span class="variable">false</span>;
    }
    <span class="keyword">return</span> <span class="variable">node</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>relational (('==' | '!=') relational)*
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">equality</span>() {
    <span class="keyword">var</span> <span class="variable">op</span>
      , <span class="variable">node</span> = <span class="this">this</span>.<span class="variable">relational</span>;
    <span class="keyword">while</span> (<span class="variable">op</span> = <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'=='</span>) || <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'!='</span>)) {
      <span class="this">this</span>.<span class="variable">operand</span> = <span class="variable">true</span>;
      <span class="keyword">if</span> (!<span class="variable">node</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'illegal unary '</span> + <span class="variable">op</span>);
      <span class="variable">node</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">BinOp</span>(<span class="variable">op</span>.<span class="variable">type</span>, <span class="variable">node</span>, <span class="this">this</span>.<span class="variable">relational</span>);
      <span class="this">this</span>.<span class="variable">operand</span> = <span class="variable">false</span>;
    }
    <span class="keyword">return</span> <span class="variable">node</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>range (('&gt;=' | '&lt;=' | '&gt;' | '&lt;') range)*
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">relational</span>() {
    <span class="keyword">var</span> <span class="variable">op</span>
      , <span class="variable">node</span> = <span class="this">this</span>.<span class="variable">range</span>;
    <span class="keyword">while</span> (<span class="variable">op</span> = 
         <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'&gt;='</span>)
      || <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'&lt;='</span>)
      || <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'&lt;'</span>)
      || <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'&gt;'</span>)
      ) {
      <span class="this">this</span>.<span class="variable">operand</span> = <span class="variable">true</span>;
      <span class="keyword">if</span> (!<span class="variable">node</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'illegal unary '</span> + <span class="variable">op</span>);
      <span class="variable">node</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">BinOp</span>(<span class="variable">op</span>.<span class="variable">type</span>, <span class="variable">node</span>, <span class="this">this</span>.<span class="variable">range</span>);
      <span class="this">this</span>.<span class="variable">operand</span> = <span class="variable">false</span>;
    }
    <span class="keyword">return</span> <span class="variable">node</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>additive (('..' | '...') additive)*
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">range</span>() {
    <span class="keyword">var</span> <span class="variable">op</span>
      , <span class="variable">node</span> = <span class="this">this</span>.<span class="variable">additive</span>;
    <span class="keyword">if</span> (<span class="variable">op</span> = <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'...'</span>) || <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'..'</span>)) {
      <span class="this">this</span>.<span class="variable">operand</span> = <span class="variable">true</span>;
      <span class="keyword">if</span> (!<span class="variable">node</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'illegal unary '</span> + <span class="variable">op</span>);
      <span class="variable">node</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">BinOp</span>(<span class="variable">op</span>.<span class="variable">val</span>, <span class="variable">node</span>, <span class="this">this</span>.<span class="variable">additive</span>);
      <span class="this">this</span>.<span class="variable">operand</span> = <span class="variable">false</span>;
    }
    <span class="keyword">return</span> <span class="variable">node</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>multiplicative (('+' | '-') multiplicative)*
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">additive</span>() {
    <span class="keyword">var</span> <span class="variable">op</span>
      , <span class="variable">node</span> = <span class="this">this</span>.<span class="variable">multiplicative</span>;
    <span class="keyword">while</span> (<span class="variable">op</span> = <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'+'</span>) || <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'-'</span>)) {
      <span class="this">this</span>.<span class="variable">operand</span> = <span class="variable">true</span>;
      <span class="variable">node</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">BinOp</span>(<span class="variable">op</span>.<span class="variable">type</span>, <span class="variable">node</span>, <span class="this">this</span>.<span class="variable">multiplicative</span>);
      <span class="this">this</span>.<span class="variable">operand</span> = <span class="variable">false</span>;
    }
    <span class="keyword">return</span> <span class="variable">node</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>defined (('**' | '<em>' | '/' | '%') defined)</em>
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">multiplicative</span>() {
    <span class="keyword">var</span> <span class="variable">op</span>
      , <span class="variable">node</span> = <span class="this">this</span>.<span class="variable">defined</span>;
    <span class="keyword">while</span> (<span class="variable">op</span> =
         <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'**'</span>)
      || <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'*'</span>)
      || <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'/'</span>)
      || <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'%'</span>)) {
      <span class="this">this</span>.<span class="variable">operand</span> = <span class="variable">true</span>;
      <span class="keyword">if</span> (!<span class="variable">node</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'illegal unary '</span> + <span class="variable">op</span>);
      <span class="variable">node</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">BinOp</span>(<span class="variable">op</span>.<span class="variable">type</span>, <span class="variable">node</span>, <span class="this">this</span>.<span class="variable">defined</span>);
      <span class="this">this</span>.<span class="variable">operand</span> = <span class="variable">false</span>;
    }
    <span class="keyword">return</span> <span class="variable">node</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>   unary 'is defined'
 | unary
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">defined</span>() {
    <span class="keyword">var</span> <span class="variable">node</span> = <span class="this">this</span>.<span class="variable">unary</span>;
    <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'is defined'</span>)) {
      <span class="keyword">if</span> (!<span class="variable">node</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'illegal use of &quot;is defined&quot;'</span>);
      <span class="variable">node</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">BinOp</span>(<span class="string">'is defined'</span>, <span class="variable">node</span>);
    }
    <span class="keyword">return</span> <span class="variable">node</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>  ('!' | '~' | '+' | '-') unary
| subscript
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">unary</span>() {
    <span class="keyword">if</span> (<span class="variable">op</span> =
         <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'!'</span>)
      || <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'~'</span>)
      || <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'+'</span>)
      || <span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'-'</span>)) {
      <span class="this">this</span>.<span class="variable">operand</span> = <span class="variable">true</span>;
      <span class="variable">node</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">UnaryOp</span>(<span class="variable">op</span>.<span class="variable">type</span>, <span class="this">this</span>.<span class="variable">unary</span>);
      <span class="this">this</span>.<span class="variable">operand</span> = <span class="variable">false</span>;
      <span class="keyword">return</span> <span class="variable">node</span>;
    }
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">subscript</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>  primary ('[' expression ']')+
| primary
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">subscript</span>() {
    <span class="keyword">var</span> <span class="variable">node</span> = <span class="this">this</span>.<span class="variable">primary</span>;
    <span class="keyword">while</span> (<span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'['</span>)) {
      <span class="variable">node</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">BinOp</span>(<span class="string">'[]'</span>, <span class="variable">node</span>, <span class="this">this</span>.<span class="variable">expression</span>);
      <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">']'</span>);
    }
    <span class="keyword">return</span> <span class="variable">node</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>  unit
| null
| color
| string
| ident
| boolean
| literal
| '(' expression ')'
   </p>
</td>
<td class="code">
<pre><code><span class="variable">get</span> <span class="variable">primary</span>() {
    <span class="keyword">var</span> <span class="variable">op</span>
      , <span class="variable">node</span>;

    <span class="comment">// Parenthesis</span>
    <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">accept</span>(<span class="string">'('</span>)) {
      <span class="keyword">var</span> <span class="variable">expr</span> = <span class="this">this</span>.<span class="variable">expression</span>;
      <span class="this">this</span>.<span class="variable">expect</span>(<span class="string">')'</span>);
      <span class="keyword">return</span> <span class="variable">expr</span>;
    }

    <span class="comment">// Primitive</span>
    <span class="keyword">switch</span> (<span class="this">this</span>.<span class="variable">peek</span>.<span class="variable">type</span>) {
      <span class="keyword">case</span> <span class="string">'null'</span>:
      <span class="keyword">case</span> <span class="string">'unit'</span>:
      <span class="keyword">case</span> <span class="string">'color'</span>:
      <span class="keyword">case</span> <span class="string">'string'</span>:
      <span class="keyword">case</span> <span class="string">'literal'</span>:
      <span class="keyword">case</span> <span class="string">'boolean'</span>:
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">next</span>.<span class="variable">val</span>;
      <span class="keyword">case</span> <span class="string">'ident'</span>:
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">ident</span>;
      <span class="keyword">case</span> <span class="string">'function'</span>:
        <span class="keyword">return</span> <span class="this">this</span>.<span class="keyword">function</span>;
    }
  }
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/renderer.js"><a href="#">renderer</a></h2></td><td>lib/renderer.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Parser</span> = <span class="variable">require</span>(<span class="string">'./parser'</span>)
  , <span class="class">Compiler</span> = <span class="variable">require</span>(<span class="string">'./visitor/compiler'</span>)
  , <span class="class">Evaluator</span> = <span class="variable">require</span>(<span class="string">'./visitor/evaluator'</span>)
  , <span class="variable">utils</span> = <span class="variable">require</span>(<span class="string">'./utils'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./nodes'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Renderer</code> with the given <code>str</code> and <code>options</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  str</p></li><li><p><strong>param</strong>: <em>Object</em>  options</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Renderer</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Renderer</span>(<span class="variable">str</span>, <span class="variable">options</span>) {
  <span class="variable">options</span> = <span class="variable">options</span> || {};
  <span class="variable">options</span>.<span class="variable">functions</span> = {};
  <span class="this">this</span>.<span class="variable">options</span> = <span class="variable">options</span>;
  <span class="this">this</span>.<span class="variable">str</span> = <span class="variable">str</span>;
  <span class="this">this</span>.<span class="variable">filename</span> = <span class="variable">options</span>.<span class="variable">filename</span> || <span class="string">'stylus'</span>;
  <span class="this">this</span>.<span class="variable">parser</span> = <span class="keyword">new</span> <span class="class">Parser</span>(<span class="variable">str</span>, <span class="variable">options</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Parse and evaluate AST, then callback <code>fn(err, css)</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  fn</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Renderer</span>.<span class="variable">prototype</span>.<span class="variable">render</span> = <span class="keyword">function</span>(<span class="variable">fn</span>){
  <span class="keyword">try</span> {
    <span class="keyword">var</span> <span class="variable">ast</span> = <span class="this">this</span>.<span class="variable">parser</span>.<span class="variable">parse</span>();
    <span class="this">this</span>.<span class="variable">evaluator</span> = <span class="keyword">new</span> <span class="class">Evaluator</span>(<span class="variable">ast</span>, <span class="this">this</span>.<span class="variable">options</span>);
    <span class="variable">ast</span> = <span class="this">this</span>.<span class="variable">evaluator</span>.<span class="variable">evaluate</span>();
    <span class="keyword">new</span> <span class="class">Compiler</span>(<span class="variable">ast</span>, <span class="this">this</span>.<span class="variable">options</span>).<span class="variable">compile</span>(<span class="variable">fn</span>);
  } <span class="keyword">catch</span> (<span class="variable">err</span>) {
    <span class="variable">fn</span>(<span class="variable">utils</span>.<span class="variable">formatException</span>(
        <span class="this">this</span>
      , <span class="variable">err</span>
      , <span class="this">this</span>.<span class="variable">options</span>));
  }
  <span class="variable">nodes</span>.<span class="variable">source</span> = <span class="keyword">null</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Set option <code>key</code> to <code>val</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  key</p></li><li><p><strong>param</strong>: <em>Mixed</em>  val</p></li><li><p><strong>return</strong>: <em>Renderer</em>  for chaining</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Renderer</span>.<span class="variable">prototype</span>.<span class="variable">set</span> = <span class="keyword">function</span>(<span class="variable">key</span>, <span class="variable">val</span>){
  <span class="this">this</span>.<span class="variable">options</span>[<span class="variable">key</span>] = <span class="variable">val</span>;
  <span class="keyword">return</span> <span class="this">this</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Define function with the given <code>name</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>param</strong>: <em>Function</em>  fn</p></li><li><p><strong>return</strong>: <em>Renderer</em>  for chaining</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Renderer</span>.<span class="variable">prototype</span>.<span class="variable">define</span> = <span class="keyword">function</span>(<span class="variable">name</span>, <span class="variable">fn</span>){
  <span class="this">this</span>.<span class="variable">options</span>.<span class="variable">functions</span>[<span class="variable">name</span>] = <span class="variable">fn</span>;
  <span class="keyword">return</span> <span class="this">this</span>;
};

</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/stack/frame.js"><a href="#">frame</a></h2></td><td>lib/stack/frame.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Scope</span> = <span class="variable">require</span>(<span class="string">'./scope'</span>)
  , <span class="variable">blocks</span> = <span class="variable">require</span>(<span class="string">'../nodes'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Frame</code> with the given <code>block</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Block</em>  block</p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Frame</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Frame</span>(<span class="variable">block</span>) {
  <span class="this">this</span>.<span class="variable">scope</span> = <span class="keyword">new</span> <span class="class">Scope</span>;
  <span class="this">this</span>.<span class="variable">block</span> = <span class="variable">block</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Lookup the given local variable <code>name</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Frame</span>.<span class="variable">prototype</span>.<span class="variable">lookup</span> = <span class="keyword">function</span>(<span class="variable">name</span>){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">scope</span>.<span class="variable">lookup</span>(<span class="variable">name</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Custom inspect.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Frame</span>.<span class="variable">prototype</span>.<span class="variable">inspect</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="string">'[Frame '</span>
    + <span class="this">this</span>.<span class="variable">scope</span>.<span class="variable">inspect</span>()
    + <span class="string">']'</span>;
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/stack/index.js"><a href="#">index</a></h2></td><td>lib/stack/index.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Frame</span> = <span class="variable">require</span>(<span class="string">'./frame'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Stack</code>.</p>

<ul><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Stack</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Stack</span>() {
  <span class="class">Array</span>.<span class="variable">apply</span>(<span class="this">this</span>, <span class="variable">arguments</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Array.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Stack</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Array</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return the current stack <code>Frame</code>.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Frame</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Stack</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'currentFrame'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>[<span class="this">this</span>.<span class="variable">length</span> - <span class="number integer">1</span>];
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Lookup stack frame for the given <code>block</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Block</em>  block</p></li><li><p><strong>return</strong>: <em>Frame</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Stack</span>.<span class="variable">prototype</span>.<span class="variable">getBlockFrame</span> = <span class="keyword">function</span>(<span class="variable">block</span>){
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="this">this</span>.<span class="variable">length</span>; ++<span class="variable">i</span>) {
    <span class="keyword">if</span> (<span class="variable">block</span> == <span class="this">this</span>[<span class="variable">i</span>].<span class="variable">block</span>) {
      <span class="keyword">return</span> <span class="this">this</span>[<span class="variable">i</span>];
    }
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Lookup the given local variable <code>name</code>, relative
to the lexical scope of the current frame's <code>Block</code>.</p>

<p>When the result of a lookup is an identifier
a recursive lookup is performed, defaulting to
returning the identifier itself.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Stack</span>.<span class="variable">prototype</span>.<span class="variable">lookup</span> = <span class="keyword">function</span>(<span class="variable">name</span>){
  <span class="keyword">var</span> <span class="variable">val</span>
    , <span class="variable">ret</span>
    , <span class="variable">block</span> = <span class="this">this</span>.<span class="variable">currentFrame</span>.<span class="variable">block</span>;

  <span class="keyword">do</span> {
    <span class="keyword">var</span> <span class="variable">frame</span> = <span class="this">this</span>.<span class="variable">getBlockFrame</span>(<span class="variable">block</span>);
    <span class="comment">// TODO: fix issue, we should not need to</span>
    <span class="comment">// frame &amp;&amp; here</span>
    <span class="keyword">if</span> (<span class="variable">frame</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; (<span class="variable">val</span> = <span class="variable">frame</span>.<span class="variable">lookup</span>(<span class="variable">name</span>))) {
      <span class="keyword">switch</span> (<span class="variable">val</span>.<span class="variable">first</span>.<span class="variable">nodeName</span>) {
        <span class="keyword">case</span> <span class="string">'ident'</span>:
          <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">lookup</span>(<span class="variable">val</span>.<span class="variable">first</span>.<span class="variable">name</span>) || <span class="variable">val</span>;
        <span class="keyword">default</span>:
          <span class="keyword">return</span> <span class="variable">val</span>;
      }
    }
  } <span class="keyword">while</span> (<span class="variable">block</span> = <span class="variable">block</span>.<span class="variable">parent</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Custom inspect.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Stack</span>.<span class="variable">prototype</span>.<span class="variable">inspect</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">reverse</span>().<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">frame</span>){
    <span class="keyword">return</span> <span class="variable">frame</span>.<span class="variable">inspect</span>();
  }).<span class="variable">join</span>(<span class="string">'\n'</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return stack string formatted as:</p>

<p>  at &lt;context&gt; (&lt;filename&gt;:&lt;lineno&gt;)</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Stack</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">block</span>
    , <span class="variable">node</span>
    , <span class="variable">buf</span> = []
    , <span class="variable">location</span>
    , <span class="variable">len</span> = <span class="this">this</span>.<span class="variable">length</span>;

  <span class="keyword">while</span> (<span class="variable">len</span>--) {
    <span class="variable">block</span> = <span class="this">this</span>[<span class="variable">len</span>].<span class="variable">block</span>;
    <span class="keyword">if</span> (<span class="variable">node</span> = <span class="variable">block</span>.<span class="variable">node</span>) {
      <span class="variable">location</span> = <span class="string">'('</span> + <span class="variable">node</span>.<span class="variable">filename</span> + <span class="string">':'</span> + <span class="variable">node</span>.<span class="variable">lineno</span> + <span class="string">')'</span>;
      <span class="keyword">switch</span> (<span class="variable">node</span>.<span class="variable">nodeName</span>) {
        <span class="keyword">case</span> <span class="string">'function'</span>:
          <span class="variable">buf</span>.<span class="variable">push</span>(<span class="string">'    at '</span> + <span class="variable">node</span>.<span class="variable">name</span> + <span class="string">'() '</span> + <span class="variable">location</span>);
          <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="string">'group'</span>:
          <span class="variable">buf</span>.<span class="variable">push</span>(<span class="string">'    at &quot;'</span> + <span class="variable">node</span>.<span class="variable">nodes</span>[<span class="number integer">0</span>].<span class="variable">val</span> + <span class="string">'&quot; '</span> + <span class="variable">location</span>);
          <span class="keyword">break</span>;
      }
    }
  }

  <span class="keyword">return</span> <span class="variable">buf</span>.<span class="variable">join</span>(<span class="string">'\n'</span>);
};</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/stack/scope.js"><a href="#">scope</a></h2></td><td>lib/stack/scope.js</td></tr><tr class="code">
<td class="docs">
<p>Initialize a new <code>Scope</code>.</p>

<ul><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Scope</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Scope</span>() {
  <span class="this">this</span>.<span class="variable">locals</span> = {};
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Add <code>ident</code> node to the current scope.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Ident</em>  ident</p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Scope</span>.<span class="variable">prototype</span>.<span class="variable">add</span> = <span class="keyword">function</span>(<span class="variable">ident</span>){
  <span class="this">this</span>.<span class="variable">locals</span>[<span class="variable">ident</span>.<span class="variable">name</span>] = <span class="variable">ident</span>.<span class="variable">val</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Lookup the given local variable <code>name</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Scope</span>.<span class="variable">prototype</span>.<span class="variable">lookup</span> = <span class="keyword">function</span>(<span class="variable">name</span>){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">locals</span>[<span class="variable">name</span>];
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Custom inspect.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Scope</span>.<span class="variable">prototype</span>.<span class="variable">inspect</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">keys</span> = <span class="class">Object</span>.<span class="variable">keys</span>(<span class="this">this</span>.<span class="variable">locals</span>).<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">key</span>){ <span class="keyword">return</span> <span class="string">'@'</span> + <span class="variable">key</span>; });
  <span class="keyword">return</span> <span class="string">'[Scope'</span>
    + (<span class="variable">keys</span>.<span class="variable">length</span> ? <span class="string">' '</span> + <span class="variable">keys</span>.<span class="variable">join</span>(<span class="string">', '</span>) : <span class="string">''</span>)
    + <span class="string">']'</span>;
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/stylus.js"><a href="#">stylus</a></h2></td><td>lib/stylus.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Renderer</span> = <span class="variable">require</span>(<span class="string">'./renderer'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./nodes'</span>)
  , <span class="variable">utils</span> = <span class="variable">require</span>(<span class="string">'./utils'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Export render as the module.
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="variable">render</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Library version.
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">version</span> = <span class="string">'0.0.1'</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose nodes.
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">nodes</span> = <span class="variable">nodes</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose BIFs.
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">functions</span> = <span class="variable">require</span>(<span class="string">'./functions'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose utils.
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">utils</span> = <span class="variable">require</span>(<span class="string">'./utils'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Convert the given <code>css</code> to <code>stylus</code> source.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  css</p></li><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">convertCSS</span> = <span class="variable">require</span>(<span class="string">'./convert/css'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Parse the given <code>str</code> with <code>options</code> and return the AST.</p>

<h2>Examples</h2>

<pre><code>css.parse(str);
// raw ast comprised of nodes

css.parse(str).toObject();
// plain object representation

css.parse(str).toJSON();
// JSON representation</code></pre>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  str</p></li><li><p><strong>param</strong>: <em>Object</em>  options</p></li><li><p><strong>return</strong>: <em>Object</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">parse</span> = <span class="keyword">function</span>(<span class="variable">str</span>, <span class="variable">options</span>){
  <span class="keyword">var</span> <span class="variable">renderer</span> = <span class="keyword">new</span> <span class="class">Renderer</span>(<span class="variable">str</span>, <span class="variable">options</span>);
  <span class="keyword">try</span> {
    <span class="keyword">return</span> <span class="variable">renderer</span>.<span class="variable">parser</span>.<span class="variable">parse</span>();
  } <span class="keyword">catch</span> (<span class="variable">err</span>) {
    <span class="keyword">throw</span> <span class="variable">utils</span>.<span class="variable">formatException</span>(
        <span class="variable">renderer</span>
      , <span class="variable">err</span>
      , <span class="variable">options</span>);
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Render the given <code>str</code> with <code>options</code> and callback <code>fn(err, css)</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  str</p></li><li><p><strong>param</strong>: <em>Object | Function</em>  options</p></li><li><p><strong>param</strong>: <em>Function</em>  fn</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">render</span> = <span class="keyword">function</span>(<span class="variable">str</span>, <span class="variable">options</span>, <span class="variable">fn</span>){
  <span class="keyword">if</span> (<span class="string">'function'</span> == <span class="keyword">typeof</span> <span class="variable">options</span>) <span class="variable">fn</span> = <span class="variable">options</span>, <span class="variable">options</span> = {};
  <span class="keyword">new</span> <span class="class">Renderer</span>(<span class="variable">str</span>, <span class="variable">options</span>).<span class="variable">render</span>(<span class="variable">fn</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a new <code>Renderer</code> for the given <code>str</code> and <code>options</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  str</p></li><li><p><strong>param</strong>: <em>Object</em>  options</p></li><li><p><strong>return</strong>: <em>Renderer</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="variable">render</span>(<span class="variable">str</span>, <span class="variable">options</span>) {
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Renderer</span>(<span class="variable">str</span>, <span class="variable">options</span>);
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose functions.
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">url</span> = <span class="variable">require</span>(<span class="string">'./functions/url'</span>);</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/token.js"><a href="#">token</a></h2></td><td>lib/token.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">inspect</span> = <span class="variable">require</span>(<span class="string">'sys'</span>).<span class="variable">inspect</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Token</code> with the given <code>type</code> and <code>val</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  type</p></li><li><p><strong>param</strong>: <em>Mixed</em>  val</p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Token</span> = <span class="variable">exports</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Token</span>(<span class="variable">type</span>, <span class="variable">val</span>) {
  <span class="this">this</span>.<span class="variable">type</span> = <span class="variable">type</span>;
  <span class="this">this</span>.<span class="variable">val</span> = <span class="variable">val</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Custom inspect.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Token</span>.<span class="variable">prototype</span>.<span class="variable">inspect</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">val</span> = <span class="string">' '</span> + <span class="variable">inspect</span>(<span class="this">this</span>.<span class="variable">val</span>);
  <span class="keyword">return</span> <span class="string">'[Token:'</span> + <span class="this">this</span>.<span class="variable">lineno</span> + <span class="string">' '</span>
    + <span class="string">'\x1b[32m'</span> + <span class="this">this</span>.<span class="variable">type</span> + <span class="string">'\x1b[0m'</span>
    + <span class="string">'\x1b[33m'</span> + (<span class="this">this</span>.<span class="variable">val</span> ? <span class="variable">val</span> : <span class="string">''</span>) + <span class="string">'\x1b[0m'</span>
    + <span class="string">']'</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return type or val.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Token</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> (<span class="variable">undefined</span> === <span class="this">this</span>.<span class="variable">val</span>
    ? <span class="this">this</span>.<span class="variable">type</span>
    : <span class="this">this</span>.<span class="variable">val</span>).<span class="variable">toString</span>();
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/utils.js"><a href="#">utils</a></h2></td><td>lib/utils.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'./nodes'</span>)
  , <span class="variable">inspect</span> = <span class="variable">require</span>(<span class="string">'sys'</span>).<span class="variable">inspect</span>
  , <span class="variable">fs</span> = <span class="variable">require</span>(<span class="string">'fs'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Attempt to lookup <code>path</code> within <code>paths</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  path</p></li><li><p><strong>param</strong>: <em>String</em>  paths</p></li><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">lookup</span> = <span class="keyword">function</span>(<span class="variable">path</span>, <span class="variable">paths</span>){
  <span class="keyword">var</span> <span class="variable">lookup</span>;
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="variable">paths</span>.<span class="variable">length</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
    <span class="keyword">try</span> {
      <span class="variable">lookup</span> = <span class="variable">paths</span>[<span class="variable">i</span>] + <span class="string">'/'</span> + <span class="variable">path</span>;
      <span class="variable">fs</span>.<span class="variable">statSync</span>(<span class="variable">lookup</span>);
      <span class="keyword">return</span> <span class="variable">lookup</span>;
    } <span class="keyword">catch</span> (<span class="variable">err</span>) {
      <span class="comment">// Ignore</span>
    }
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Format the given <code>err</code> in context to <code>renderer</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Renderer</em>  renderer</p></li><li><p><strong>param</strong>: <em>Error</em>  err</p></li><li><p><strong>param</strong>: <em>Object</em>  options</p></li><li><p><strong>return</strong>: <em>Error</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">formatException</span> = <span class="keyword">function</span>(<span class="variable">renderer</span>, <span class="variable">err</span>, <span class="variable">options</span>){
  <span class="keyword">var</span> <span class="variable">lineno</span> = <span class="variable">renderer</span>.<span class="variable">evaluator</span>
      ? <span class="variable">renderer</span>.<span class="variable">evaluator</span>.<span class="variable">lineno</span>
      : <span class="variable">renderer</span>.<span class="variable">parser</span>.<span class="variable">lexer</span>.<span class="variable">lineno</span>
    , <span class="variable">contextLineno</span> = <span class="variable">lineno</span> - <span class="number integer">2</span>
    , <span class="variable">contextLines</span> = <span class="variable">options</span>.<span class="variable">context</span> || <span class="number integer">6</span>
    , <span class="variable">lastWidth</span> = (<span class="variable">contextLineno</span> + <span class="variable">contextLines</span>).<span class="variable">toString</span>().<span class="variable">length</span>;

  <span class="keyword">var</span> <span class="variable">src</span> = (<span class="variable">err</span>.<span class="variable">str</span> || <span class="variable">renderer</span>.<span class="variable">str</span>).<span class="variable">split</span>(<span class="string">'\n'</span>)
    .<span class="variable">slice</span>(<span class="variable">contextLineno</span>, <span class="variable">contextLineno</span> + <span class="variable">contextLines</span>)
    .<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">line</span>){
      <span class="keyword">var</span> <span class="variable">n</span> = ++<span class="variable">contextLineno</span>
        , <span class="variable">width</span> = <span class="variable">n</span>.<span class="variable">toString</span>().<span class="variable">length</span>
        , <span class="variable">pad</span> = <span class="class">Array</span>(<span class="variable">lastWidth</span> - <span class="variable">width</span> + <span class="number integer">1</span>).<span class="variable">join</span>(<span class="string">' '</span>);
      <span class="keyword">return</span> <span class="string">'  '</span> + <span class="variable">pad</span> + <span class="variable">n</span> + <span class="string">': '</span> + <span class="variable">inspect</span>(<span class="variable">line</span>);
    }).<span class="variable">join</span>(<span class="string">'\n'</span>);

  <span class="variable">err</span>.<span class="variable">message</span> = <span class="variable">renderer</span>.<span class="variable">filename</span>
    + <span class="string">':'</span> + <span class="variable">lineno</span>
    + <span class="string">'\n'</span> + <span class="variable">src</span>
    + <span class="string">'\n\n'</span> + <span class="variable">err</span>.<span class="variable">message</span> + <span class="string">'\n'</span>
    + (<span class="variable">err</span>.<span class="variable">stylusStack</span> ? <span class="variable">err</span>.<span class="variable">stylusStack</span> + <span class="string">'\n'</span> : <span class="string">''</span>);

  <span class="keyword">return</span> <span class="variable">err</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Assert that <code>node</code> is of the given <code>type</code>, or throw.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  node</p></li><li><p><strong>param</strong>: <em>Function</em>  type</p></li><li><p><strong>param</strong>: <em>String</em>  param</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">assertType</span> = <span class="keyword">function</span>(<span class="variable">node</span>, <span class="variable">type</span>, <span class="variable">param</span>){
  <span class="variable">exports</span>.<span class="variable">assertPresent</span>(<span class="variable">node</span>, <span class="variable">param</span>);
  <span class="keyword">if</span> (<span class="variable">node</span> <span class="variable">instanceof</span> <span class="variable">type</span>) <span class="keyword">return</span>;
  <span class="keyword">var</span> <span class="variable">actual</span> = <span class="variable">node</span>.<span class="variable">constructor</span>.<span class="variable">name</span>
    , <span class="variable">msg</span> = <span class="string">'expected '</span> + <span class="variable">type</span>.<span class="variable">name</span> + <span class="string">', but got '</span> + <span class="variable">actual</span> + <span class="string">':'</span> + <span class="variable">node</span>;
  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'TypeError: '</span> + <span class="variable">msg</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Assert that <code>node</code> is a <code>String</code> or <code>Ident</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  node</p></li><li><p><strong>param</strong>: <em>String</em>  param</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">assertString</span> = <span class="keyword">function</span>(<span class="variable">node</span>, <span class="variable">param</span>){
  <span class="variable">exports</span>.<span class="variable">assertPresent</span>(<span class="variable">node</span>, <span class="variable">param</span>);
  <span class="keyword">if</span> (<span class="variable">node</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">String</span>) <span class="keyword">return</span>;
  <span class="keyword">if</span> (<span class="variable">node</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Ident</span>) <span class="keyword">return</span>;
  <span class="keyword">var</span> <span class="variable">actual</span> = <span class="variable">node</span>.<span class="variable">constructor</span>.<span class="variable">name</span>;
  <span class="variable">msg</span> = <span class="variable">msg</span> || <span class="string">'expected String or Ident, but got '</span> + <span class="variable">actual</span> + <span class="string">':'</span> + <span class="variable">node</span>;
  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'TypeError: '</span> + <span class="variable">msg</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Assert that <code>node</code> is a <code>Color</code> or <code>HSLA</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  node</p></li><li><p><strong>param</strong>: <em>String</em>  param</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">assertColor</span> = <span class="keyword">function</span>(<span class="variable">node</span>, <span class="variable">param</span>){
  <span class="variable">exports</span>.<span class="variable">assertPresent</span>(<span class="variable">node</span>, <span class="variable">param</span>);
  <span class="keyword">if</span> (<span class="variable">node</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Color</span>) <span class="keyword">return</span>;
  <span class="keyword">if</span> (<span class="variable">node</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">HSLA</span>) <span class="keyword">return</span>;
  <span class="keyword">var</span> <span class="variable">actual</span> = <span class="variable">node</span>.<span class="variable">constructor</span>.<span class="variable">name</span>;
  <span class="variable">msg</span> = <span class="variable">msg</span> || <span class="string">'expected Color or HSLA, but got '</span> + <span class="variable">actual</span> + <span class="string">':'</span> + <span class="variable">node</span>;
  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'TypeError: '</span> + <span class="variable">msg</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Assert that param <code>name</code> is given, aka the <code>node</code> is passed.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  node</p></li><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">assertPresent</span> = <span class="keyword">function</span>(<span class="variable">node</span>, <span class="variable">name</span>){
  <span class="keyword">if</span> (<span class="variable">node</span>) <span class="keyword">return</span>;
  <span class="keyword">if</span> (<span class="variable">name</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'ArgumentError: argument '</span> + <span class="variable">name</span> + <span class="string">' required'</span>);
  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'ArgumentError: argument missing'</span>);
}</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/visitor/compiler.js"><a href="#">compiler</a></h2></td><td>lib/visitor/compiler.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Visitor</span> = <span class="variable">require</span>(<span class="string">'./'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'../nodes'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Compiler</code> with the given <code>root</code> Node
and the following <code>options</code>.</p>

<h2>Options</h2>

<ul><li><code>compress</code>  Compress the css output, defaults to false</li></ul>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  root</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Compiler</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Compiler</span>(<span class="variable">root</span>, <span class="variable">options</span>) {
  <span class="variable">options</span> = <span class="variable">options</span> || {};
  <span class="this">this</span>.<span class="variable">compress</span> = <span class="variable">options</span>.<span class="variable">compress</span>;
  <span class="this">this</span>.<span class="variable">indents</span> = <span class="number integer">1</span>;
  <span class="class">Visitor</span>.<span class="variable">call</span>(<span class="this">this</span>, <span class="variable">root</span>);
  <span class="this">this</span>.<span class="variable">tree</span> = [];
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Visitor.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Visitor</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Compile to css, and callback <code>fn(err, css)</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  fn</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">compile</span> = <span class="keyword">function</span>(<span class="variable">fn</span>){
  <span class="this">this</span>.<span class="variable">callback</span> = <span class="variable">fn</span>;
  <span class="this">this</span>.<span class="variable">css</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="this">this</span>.<span class="variable">root</span>);
  <span class="variable">fn</span>(<span class="keyword">null</span>, <span class="this">this</span>.<span class="variable">css</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return indentation string.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'indent'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">compress</span>
     ? <span class="string">''</span>
     : <span class="keyword">new</span> <span class="class">Array</span>(<span class="this">this</span>.<span class="variable">indents</span>).<span class="variable">join</span>(<span class="string">'  '</span>);
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Root.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitRoot</span> = <span class="keyword">function</span>(<span class="variable">block</span>){
  <span class="this">this</span>.<span class="variable">buf</span> = <span class="string">''</span>;
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="variable">block</span>.<span class="variable">nodes</span>.<span class="variable">length</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
    <span class="keyword">var</span> <span class="variable">node</span> = <span class="variable">block</span>.<span class="variable">nodes</span>[<span class="variable">i</span>];
    <span class="keyword">if</span> (<span class="variable">node</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Null</span>
      || <span class="variable">node</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Expression</span>
      || <span class="variable">node</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Function</span>) <span class="keyword">continue</span>;
    <span class="keyword">var</span> <span class="variable">ret</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">node</span>);
    <span class="keyword">if</span> (<span class="variable">ret</span>) <span class="this">this</span>.<span class="variable">buf</span> += <span class="variable">ret</span> + <span class="string">'\n'</span>;
  }
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">buf</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Block.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitBlock</span> = <span class="keyword">function</span>(<span class="variable">block</span>){
  <span class="keyword">if</span> (<span class="variable">block</span>.<span class="variable">hasProperties</span>) {
    <span class="keyword">var</span> <span class="variable">arr</span> = [<span class="this">this</span>.<span class="variable">compress</span> ? <span class="string">'{'</span> : <span class="string">' {'</span>];
    ++<span class="this">this</span>.<span class="variable">indents</span>;
    <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="variable">block</span>.<span class="variable">nodes</span>.<span class="variable">length</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
      <span class="this">this</span>.<span class="variable">last</span> = <span class="variable">len</span> - <span class="number integer">1</span> == <span class="variable">i</span>;
      <span class="keyword">var</span> <span class="variable">node</span> = <span class="variable">block</span>.<span class="variable">nodes</span>[<span class="variable">i</span>];
      <span class="keyword">if</span> (<span class="variable">node</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Null</span>
        || <span class="variable">node</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Expression</span>
        || <span class="variable">node</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Function</span>
        || <span class="variable">node</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Group</span>) <span class="keyword">continue</span>;
      <span class="variable">arr</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">node</span>));
    }
    --<span class="this">this</span>.<span class="variable">indents</span>;
    <span class="variable">arr</span>.<span class="variable">push</span>(<span class="string">'}'</span>);
    <span class="this">this</span>.<span class="variable">buf</span> += <span class="variable">arr</span>.<span class="variable">join</span>(<span class="this">this</span>.<span class="variable">compress</span> ? <span class="string">''</span> : <span class="string">'\n'</span>);
    <span class="this">this</span>.<span class="variable">buf</span> += <span class="string">'\n'</span>;
  }

  <span class="comment">// Nesting</span>
  <span class="comment">// TODO: apply in same order</span>
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="variable">block</span>.<span class="variable">nodes</span>.<span class="variable">length</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
    <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">block</span>.<span class="variable">nodes</span>[<span class="variable">i</span>]);
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Function.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitFunction</span> = <span class="keyword">function</span>(<span class="variable">fn</span>){
  <span class="keyword">return</span> <span class="variable">fn</span>.<span class="variable">name</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Variable.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitVariable</span> = <span class="keyword">function</span>(<span class="variable">variable</span>){
  <span class="keyword">return</span> <span class="string">''</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Charset.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitCharset</span> = <span class="keyword">function</span>(<span class="variable">charset</span>){
  <span class="keyword">return</span> <span class="string">'@charset '</span> + <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">charset</span>.<span class="variable">val</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Literal.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitLiteral</span> = <span class="keyword">function</span>(<span class="variable">lit</span>){
  <span class="keyword">return</span> <span class="variable">lit</span>.<span class="variable">val</span>.<span class="variable">trim</span>().<span class="variable">replace</span>(<span class="regexp">/^  /gm</span>, <span class="string">''</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Boolean.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitBoolean</span> = <span class="keyword">function</span>(<span class="variable">bool</span>){
  <span class="keyword">return</span> <span class="variable">bool</span>.<span class="variable">toString</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Color.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitColor</span> = <span class="keyword">function</span>(<span class="variable">color</span>){
  <span class="keyword">return</span> <span class="variable">color</span>.<span class="variable">toString</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit HSLA.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitHSLA</span> = <span class="keyword">function</span>(<span class="variable">hsla</span>){
  <span class="keyword">return</span> <span class="variable">hsla</span>.<span class="variable">rgba</span>.<span class="variable">toString</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Unit.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitUnit</span> = <span class="keyword">function</span>(<span class="variable">unit</span>){
  <span class="keyword">var</span> <span class="variable">type</span> = <span class="variable">unit</span>.<span class="variable">type</span> || <span class="string">''</span>
    , <span class="variable">n</span> = <span class="variable">unit</span>.<span class="variable">val</span>;

  <span class="comment">// Int</span>
  <span class="keyword">if</span> (<span class="string">'px'</span> == <span class="variable">type</span>) <span class="variable">n</span> = <span class="variable">n</span>.<span class="variable">toFixed</span>(<span class="number integer">0</span>);

  <span class="comment">// Compress</span>
  <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">compress</span>) {
    <span class="comment">// Zero is always '0'</span>
    <span class="keyword">if</span> (<span class="number integer">0</span> == <span class="variable">unit</span>.<span class="variable">val</span>) <span class="keyword">return</span> <span class="string">'0'</span>;
    <span class="comment">// Omit leading '0'</span>
    <span class="keyword">if</span> (<span class="variable">unit</span>.<span class="variable">val</span> &<span class="variable">lt</span>; <span class="number integer">1</span>) {
      <span class="keyword">return</span> <span class="variable">n</span>.<span class="variable">toString</span>().<span class="variable">substr</span>(<span class="number integer">1</span>) + <span class="variable">type</span>;
    }
  }

  <span class="keyword">return</span> <span class="variable">n</span>.<span class="variable">toString</span>() + <span class="variable">type</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Group.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitGroup</span> = <span class="keyword">function</span>(<span class="variable">group</span>){
  <span class="keyword">var</span> <span class="variable">tree</span> = <span class="this">this</span>.<span class="variable">tree</span>
    , <span class="variable">prev</span> = <span class="variable">tree</span>[<span class="variable">tree</span>.<span class="variable">length</span> - <span class="number integer">1</span>]
    , <span class="variable">curr</span> = [];

  <span class="comment">// Construct an array of arrays</span>
  <span class="comment">// representing the selector hierarchy</span>
  <span class="variable">group</span>.<span class="variable">nodes</span>.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">node</span>){
    <span class="variable">curr</span>.<span class="variable">push</span>(<span class="variable">node</span>.<span class="variable">parent</span>
        ? <span class="variable">node</span>
        : <span class="variable">node</span>.<span class="variable">val</span>);
  });

  <span class="variable">tree</span>.<span class="variable">push</span>(<span class="variable">curr</span>);

  <span class="comment">// Reverse recurse the</span>
  <span class="comment">// hierarchy array to build</span>
  <span class="comment">// up the selector permutations.</span>
  <span class="comment">// When we reach root, we have our</span>
  <span class="comment">// selector string built</span>
  <span class="keyword">var</span> <span class="variable">selectors</span> = []
    , <span class="variable">buf</span> = [];
  <span class="keyword">function</span> <span class="variable">join</span>(<span class="variable">arr</span>, <span class="variable">i</span>) {
    <span class="keyword">if</span> (<span class="variable">i</span>) {
      <span class="variable">arr</span>[<span class="variable">i</span>].<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">str</span>){
        <span class="variable">buf</span>.<span class="variable">unshift</span>(<span class="variable">str</span>);
        <span class="variable">join</span>(<span class="variable">arr</span>, <span class="variable">i</span> - <span class="number integer">1</span>);
        <span class="variable">buf</span>.<span class="variable">shift</span>();
      });
    } <span class="keyword">else</span> {
      <span class="variable">arr</span>[<span class="number integer">0</span>].<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">selector</span>){
        <span class="keyword">var</span> <span class="variable">str</span> = <span class="variable">buf</span>.<span class="variable">length</span>
          ? <span class="variable">buf</span>.<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">str</span>){
            <span class="keyword">return</span> <span class="variable">str</span>.<span class="variable">parent</span>
              ? <span class="variable">str</span>.<span class="variable">val</span>
              : <span class="string">' '</span> + <span class="variable">str</span>;
          }).<span class="variable">join</span>(<span class="string">''</span>)
          : <span class="string">''</span>;
        <span class="variable">selectors</span>.<span class="variable">push</span>(<span class="variable">selector</span> + <span class="variable">str</span>);
      });
    }
  }

  <span class="comment">// Join selectors</span>
  <span class="keyword">if</span> (<span class="variable">group</span>.<span class="variable">block</span>.<span class="variable">hasProperties</span>) {
    <span class="variable">join</span>(<span class="variable">tree</span>, <span class="variable">tree</span>.<span class="variable">length</span> - <span class="number integer">1</span>);
    <span class="this">this</span>.<span class="variable">buf</span> += <span class="variable">selectors</span>.<span class="variable">join</span>(<span class="this">this</span>.<span class="variable">compress</span> ? <span class="string">','</span> : <span class="string">',\n'</span>);
  }

  <span class="comment">// Output blocks</span>
  <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">group</span>.<span class="variable">block</span>);
  <span class="variable">tree</span>.<span class="variable">pop</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Ident.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitIdent</span> = <span class="keyword">function</span>(<span class="variable">ident</span>){
  <span class="keyword">return</span> <span class="variable">ident</span>.<span class="variable">name</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit String.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitString</span> = <span class="keyword">function</span>(<span class="variable">string</span>){
  <span class="keyword">return</span> <span class="variable">string</span>.<span class="variable">toString</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Null.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitNull</span> = <span class="keyword">function</span>(<span class="variable">node</span>){
  <span class="keyword">return</span> <span class="string">''</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Call.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitCall</span> = <span class="keyword">function</span>(<span class="variable">call</span>){
  <span class="keyword">return</span> <span class="variable">call</span>.<span class="variable">name</span> + <span class="string">'('</span> + <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">call</span>.<span class="variable">args</span>) + <span class="string">')'</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Import.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitImport</span> = <span class="keyword">function</span>(<span class="keyword">import</span>){
  <span class="keyword">return</span> <span class="string">'@import &quot;'</span> + <span class="keyword">import</span>.<span class="variable">path</span> + <span class="string">'&quot;'</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Expression.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitExpression</span> = <span class="keyword">function</span>(<span class="variable">expr</span>){
  <span class="keyword">return</span> <span class="variable">expr</span>.<span class="variable">nodes</span>.<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">node</span>){
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">node</span>);
  }, <span class="this">this</span>).<span class="variable">join</span>(<span class="variable">expr</span>.<span class="variable">isList</span>
      ? (<span class="this">this</span>.<span class="variable">compress</span> ? <span class="string">','</span> : <span class="string">', '</span>)
      : <span class="string">' '</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Property.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Compiler</span>.<span class="variable">prototype</span>.<span class="variable">visitProperty</span> = <span class="keyword">function</span>(<span class="variable">prop</span>){
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>
    , <span class="variable">val</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">prop</span>.<span class="variable">expr</span>);
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">indent</span> + <span class="variable">prop</span>.<span class="variable">name</span>
    + (<span class="this">this</span>.<span class="variable">compress</span> ? <span class="string">':'</span> + <span class="variable">val</span> : <span class="string">': '</span> + <span class="variable">val</span>)
    + (<span class="this">this</span>.<span class="variable">compress</span>
        ? (<span class="this">this</span>.<span class="variable">last</span> ? <span class="string">''</span> : <span class="string">';'</span>)
        : <span class="string">';'</span>);
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/visitor/evaluator.js"><a href="#">evaluator</a></h2></td><td>lib/visitor/evaluator.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Visitor</span> = <span class="variable">require</span>(<span class="string">'./'</span>)
  , <span class="variable">nodes</span> = <span class="variable">require</span>(<span class="string">'../nodes'</span>)
  , <span class="class">Stack</span> = <span class="variable">require</span>(<span class="string">'../stack'</span>)
  , <span class="class">Frame</span> = <span class="variable">require</span>(<span class="string">'../stack/frame'</span>)
  , <span class="class">Scope</span> = <span class="variable">require</span>(<span class="string">'../stack/scope'</span>)
  , <span class="variable">utils</span> = <span class="variable">require</span>(<span class="string">'../utils'</span>)
  , <span class="variable">bifs</span> = <span class="variable">require</span>(<span class="string">'../functions'</span>)
  , <span class="variable">dirname</span> = <span class="variable">require</span>(<span class="string">'path'</span>).<span class="variable">dirname</span>
  , <span class="variable">fs</span> = <span class="variable">require</span>(<span class="string">'fs'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Evaluator</code> with the given <code>root</code> Node
and the following <code>options</code>.</p>

<h2>Options</h2>

<ul><li><code>compress</code>  Compress the css output, defaults to false</li></ul>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  root</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Evaluator</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Evaluator</span>(<span class="variable">root</span>, <span class="variable">options</span>) {
  <span class="variable">options</span> = <span class="variable">options</span> || {};
  <span class="class">Visitor</span>.<span class="variable">call</span>(<span class="this">this</span>, <span class="variable">root</span>);
  <span class="this">this</span>.<span class="variable">stack</span> = <span class="keyword">new</span> <span class="class">Stack</span>;
  <span class="this">this</span>.<span class="variable">filename</span> = <span class="variable">options</span>.<span class="variable">filename</span>;
  <span class="this">this</span>.<span class="variable">functions</span> = <span class="variable">options</span>.<span class="variable">functions</span> || {};
  <span class="this">this</span>.<span class="variable">paths</span> = <span class="variable">options</span>.<span class="variable">paths</span> || [];
  <span class="this">this</span>.<span class="variable">paths</span>.<span class="variable">push</span>(<span class="variable">dirname</span>(<span class="variable">options</span>.<span class="variable">filename</span> || <span class="string">'.'</span>));
  <span class="this">this</span>.<span class="variable">stack</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">global</span> = <span class="keyword">new</span> <span class="class">Frame</span>(<span class="variable">root</span>));
  <span class="this">this</span>.<span class="variable">calling</span> = []; <span class="comment">// TODO: remove, use stack</span>
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Visitor.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Visitor</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Proxy visit to expose node line numbers.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  node</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">visit</span> = <span class="class">Visitor</span>.<span class="variable">prototype</span>.<span class="variable">visit</span>;
<span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visit</span> = <span class="keyword">function</span>(<span class="variable">node</span>){
  <span class="keyword">try</span> {
    <span class="this">this</span>.<span class="variable">lineno</span> = <span class="variable">node</span>.<span class="variable">lineno</span>;
    <span class="keyword">return</span> <span class="variable">visit</span>.<span class="variable">call</span>(<span class="this">this</span>, <span class="variable">node</span>);
  } <span class="keyword">catch</span> (<span class="variable">err</span>) {
    <span class="comment">// TODO: less-lame hack to reference</span>
    <span class="comment">// the origin node source input</span>
    <span class="variable">err</span>.<span class="variable">str</span> = <span class="variable">err</span>.<span class="variable">str</span> || <span class="variable">node</span>.<span class="variable">source</span>;
    <span class="variable">err</span>.<span class="variable">stylusStack</span> = <span class="variable">err</span>.<span class="variable">stylusStack</span> || <span class="this">this</span>.<span class="variable">stack</span>.<span class="variable">toString</span>();
    <span class="keyword">throw</span> <span class="variable">err</span>;
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Evaluate the tree.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">evaluate</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">visit</span>(<span class="this">this</span>.<span class="variable">root</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Color.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitColor</span> = <span class="keyword">function</span>(<span class="variable">color</span>){
  <span class="keyword">return</span> <span class="variable">color</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit HSLA.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitHSLA</span> = <span class="keyword">function</span>(<span class="variable">hsla</span>){
  <span class="keyword">return</span> <span class="variable">hsla</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Literal.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitLiteral</span> = <span class="keyword">function</span>(<span class="variable">lit</span>){
  <span class="keyword">return</span> <span class="variable">lit</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Boolean.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitBoolean</span> = <span class="keyword">function</span>(<span class="variable">bool</span>){
  <span class="keyword">return</span> <span class="variable">bool</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Unit.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitUnit</span> = <span class="keyword">function</span>(<span class="variable">unit</span>){
  <span class="keyword">return</span> <span class="variable">unit</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit String.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitString</span> = <span class="keyword">function</span>(<span class="variable">string</span>){
  <span class="keyword">return</span> <span class="variable">string</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Null.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitNull</span> = <span class="keyword">function</span>(<span class="variable">node</span>){
  <span class="keyword">return</span> <span class="variable">node</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Function.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitFunction</span> = <span class="keyword">function</span>(<span class="variable">fn</span>){
  <span class="keyword">return</span> <span class="variable">fn</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Group.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitGroup</span> = <span class="keyword">function</span>(<span class="variable">group</span>){
  <span class="this">this</span>.<span class="variable">group</span> = <span class="variable">group</span>;
  <span class="variable">group</span>.<span class="variable">block</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">group</span>.<span class="variable">block</span>);
  <span class="this">this</span>.<span class="variable">group</span> = <span class="keyword">null</span>;
  <span class="keyword">return</span> <span class="variable">group</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Charset.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitCharset</span> = <span class="keyword">function</span>(<span class="variable">charset</span>){
  <span class="keyword">return</span> <span class="variable">charset</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Return.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitReturn</span> = <span class="keyword">function</span>(<span class="variable">ret</span>){
  <span class="variable">ret</span>.<span class="variable">expr</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">ret</span>.<span class="variable">expr</span>);
  <span class="keyword">return</span> <span class="variable">ret</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Call.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitCall</span> = <span class="keyword">function</span>(<span class="variable">call</span>){
  <span class="keyword">var</span> <span class="variable">fn</span> = <span class="this">this</span>.<span class="variable">lookup</span>(<span class="variable">call</span>.<span class="variable">name</span>);

  <span class="comment">// Undefined function, render literal css</span>
  <span class="keyword">if</span> (!<span class="variable">fn</span>) <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">literalCall</span>(<span class="variable">call</span>);
  <span class="this">this</span>.<span class="variable">calling</span>.<span class="variable">push</span>(<span class="variable">call</span>.<span class="variable">name</span>);

  <span class="comment">// Massive stack</span>
  <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">calling</span>.<span class="variable">length</span> &<span class="variable">gt</span>; <span class="number integer">200</span>) {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">RangeError</span>(<span class="string">'Maximum call stack size exceeded'</span>);
  }

  <span class="comment">// First node in expression</span>
  <span class="keyword">if</span> (<span class="variable">fn</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Expression</span>) <span class="variable">fn</span> = <span class="variable">fn</span>.<span class="variable">first</span>;

  <span class="comment">// Evaluate arguments</span>
  <span class="keyword">var</span> <span class="variable">_</span> = <span class="this">this</span>.<span class="keyword">return</span>;
  <span class="this">this</span>.<span class="keyword">return</span> = <span class="variable">true</span>;
  <span class="keyword">var</span> <span class="variable">args</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">call</span>.<span class="variable">args</span>);
  <span class="this">this</span>.<span class="keyword">return</span> = <span class="variable">_</span>;

  <span class="comment">// Built-in</span>
  <span class="keyword">if</span> (<span class="variable">fn</span>.<span class="variable">fn</span>) {
    <span class="variable">ret</span> = <span class="this">this</span>.<span class="variable">invokeBuiltin</span>(<span class="variable">fn</span>.<span class="variable">fn</span>, <span class="variable">args</span>);
  <span class="comment">// User-defined</span>
  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">fn</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Function</span>) {
    <span class="variable">ret</span> = <span class="this">this</span>.<span class="variable">invokeFunction</span>(<span class="variable">fn</span>, <span class="variable">args</span>);
  }

  <span class="this">this</span>.<span class="variable">calling</span>.<span class="variable">pop</span>();
  <span class="keyword">return</span> <span class="variable">ret</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Ident.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitIdent</span> = <span class="keyword">function</span>(<span class="variable">ident</span>){
  <span class="comment">// Lookup</span>
  <span class="keyword">if</span> (<span class="variable">nodes</span>.<span class="keyword">null</span> == <span class="variable">ident</span>.<span class="variable">val</span>) {
    <span class="keyword">var</span> <span class="variable">val</span> = <span class="this">this</span>.<span class="variable">lookup</span>(<span class="variable">ident</span>.<span class="variable">name</span>);
    <span class="keyword">return</span> <span class="variable">val</span> ? <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">val</span>) : <span class="variable">ident</span>;
  <span class="comment">// Assign  </span>
  } <span class="keyword">else</span> {
    <span class="keyword">var</span> <span class="variable">_</span> = <span class="this">this</span>.<span class="keyword">return</span>;
    <span class="this">this</span>.<span class="keyword">return</span> = <span class="variable">true</span>;
    <span class="variable">ident</span>.<span class="variable">val</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">ident</span>.<span class="variable">val</span>);
    <span class="this">this</span>.<span class="keyword">return</span> = <span class="variable">_</span>;
    <span class="this">this</span>.<span class="variable">stack</span>.<span class="variable">currentFrame</span>.<span class="variable">scope</span>.<span class="variable">add</span>(<span class="variable">ident</span>);
    <span class="keyword">return</span> <span class="variable">ident</span>.<span class="variable">val</span>;
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit BinOp.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitBinOp</span> = <span class="keyword">function</span>(<span class="variable">binop</span>){
  <span class="comment">// Special-case &quot;is defined&quot; pseudo binop</span>
  <span class="keyword">if</span> (<span class="string">'is defined'</span> == <span class="variable">binop</span>.<span class="variable">op</span>) <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">isDefined</span>(<span class="variable">binop</span>.<span class="variable">left</span>);

  <span class="keyword">var</span> <span class="variable">_</span> = <span class="this">this</span>.<span class="keyword">return</span>;
  <span class="this">this</span>.<span class="keyword">return</span> = <span class="variable">true</span>;
  <span class="comment">// Visit operands</span>
  <span class="keyword">var</span> <span class="variable">op</span> = <span class="variable">binop</span>.<span class="variable">op</span>
    , <span class="variable">ident</span> = <span class="string">'ident'</span> == <span class="variable">binop</span>.<span class="variable">left</span>.<span class="variable">nodeName</span>
    , <span class="variable">left</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">binop</span>.<span class="variable">left</span>)
    , <span class="variable">right</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">binop</span>.<span class="variable">right</span>).<span class="variable">first</span>;
  <span class="this">this</span>.<span class="keyword">return</span> = <span class="variable">_</span>;

  <span class="comment">// First node in expression</span>
  <span class="keyword">if</span> (<span class="string">'[]'</span> != <span class="variable">op</span>) <span class="variable">left</span> = <span class="variable">left</span>.<span class="variable">first</span>;

  <span class="comment">// Coercion</span>
  <span class="keyword">switch</span> (<span class="variable">op</span>) {
    <span class="keyword">case</span> <span class="string">'[]'</span>:
      <span class="comment">// Special-case usage from an assignment.</span>
      <span class="comment">// For example:</span>
      <span class="comment">//</span>
      <span class="comment">//    size = image-size('path-to-image.png')</span>
      <span class="comment">//</span>
      <span class="comment">// size is an Expression it-self, so if image-size()</span>
      <span class="comment">// returns an expression, we have to access height via</span>
      <span class="comment">// the less ideal size[0][1] vs size[1].</span>
      <span class="comment">//</span>
      <span class="comment">// This means that you will only be able to access the first</span>
      <span class="comment">// tuple, [0] yielding 1, and [1] yielding 2</span>
      <span class="comment">//</span>
      <span class="comment">//    size = (1 2) (3 4)</span>
      <span class="comment">//</span>
      <span class="comment">// However in the following [0] will give you (1 2), and [1]</span>
      <span class="comment">// will give you (3 4)</span>
      <span class="comment">//</span>
      <span class="keyword">if</span> (<span class="variable">ident</span>) {
        <span class="keyword">if</span> (<span class="variable">left</span>.<span class="variable">nodes</span>[<span class="number integer">0</span>] <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Expression</span>) {
          <span class="variable">left</span> = <span class="variable">left</span>.<span class="variable">nodes</span>[<span class="number integer">0</span>];
        }
      }
    <span class="keyword">case</span> <span class="string">'||'</span>:
    <span class="keyword">case</span> <span class="string">'&amp;&amp;'</span>:
    <span class="keyword">case</span> <span class="string">'is a'</span>:
      <span class="keyword">break</span>;
    <span class="keyword">default</span>:
      <span class="comment">// Special-case '-' against ident</span>
      <span class="keyword">if</span> (<span class="string">'-'</span> == <span class="variable">op</span>
        &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="string">'ident'</span> == <span class="variable">left</span>.<span class="variable">nodeName</span>
        &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="string">'unit'</span> == <span class="variable">right</span>.<span class="variable">nodeName</span>) {
        <span class="keyword">var</span> <span class="variable">expr</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Expression</span>;
        <span class="variable">right</span>.<span class="variable">val</span> = -<span class="variable">right</span>.<span class="variable">val</span>;
        <span class="variable">expr</span>.<span class="variable">push</span>(<span class="variable">left</span>);
        <span class="variable">expr</span>.<span class="variable">push</span>(<span class="variable">right</span>);
        <span class="keyword">return</span> <span class="variable">expr</span>;
      }

      <span class="comment">// Attempt coercion</span>
      <span class="keyword">try</span> {
        <span class="variable">right</span> = <span class="variable">left</span>.<span class="variable">coerce</span>(<span class="variable">right</span>);
      } <span class="keyword">catch</span> (<span class="variable">err</span>) {
        <span class="comment">// Disgregard coercion issues</span>
        <span class="comment">// and simply return false</span>
        <span class="keyword">if</span> (<span class="string">'=='</span> == <span class="variable">op</span> || <span class="string">'!='</span> == <span class="variable">op</span>) {
          <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="variable">false</span>;
        } <span class="keyword">else</span> {
          <span class="keyword">throw</span> <span class="variable">err</span>;
        }
      }
  }

  <span class="comment">// Operate</span>
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">left</span>.<span class="variable">operate</span>(<span class="variable">op</span>, <span class="variable">right</span>));
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit UnaryOp.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitUnaryOp</span> = <span class="keyword">function</span>(<span class="variable">unary</span>){
  <span class="keyword">var</span> <span class="variable">op</span> = <span class="variable">unary</span>.<span class="variable">op</span>
    , <span class="variable">node</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">unary</span>.<span class="variable">expr</span>).<span class="variable">first</span>;

  <span class="keyword">if</span> (<span class="string">'!'</span> != <span class="variable">op</span>) <span class="variable">utils</span>.<span class="variable">assertType</span>(<span class="variable">node</span>, <span class="variable">nodes</span>.<span class="class">Unit</span>);

  <span class="keyword">switch</span> (<span class="variable">op</span>) {
    <span class="keyword">case</span> <span class="string">'-'</span>:
      <span class="variable">node</span>.<span class="variable">val</span> = -<span class="variable">node</span>.<span class="variable">val</span>;
      <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="string">'+'</span>:
      <span class="variable">node</span>.<span class="variable">val</span> = +<span class="variable">node</span>.<span class="variable">val</span>;
      <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="string">'~'</span>:
      <span class="variable">node</span>.<span class="variable">val</span> = ~<span class="variable">node</span>.<span class="variable">val</span>;
      <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="string">'!'</span>:
      <span class="keyword">return</span> <span class="variable">node</span>.<span class="variable">toBoolean</span>().<span class="variable">negate</span>();
  }
  
  <span class="keyword">return</span> <span class="variable">node</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit TernaryOp.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitTernary</span> = <span class="keyword">function</span>(<span class="variable">ternary</span>){
  <span class="keyword">var</span> <span class="variable">ok</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">ternary</span>.<span class="variable">cond</span>).<span class="variable">toBoolean</span>();
  <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="variable">true</span> == <span class="variable">ok</span>
    ? <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">ternary</span>.<span class="variable">trueExpr</span>)
    : <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">ternary</span>.<span class="variable">falseExpr</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Expression.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitExpression</span> = <span class="keyword">function</span>(<span class="variable">expr</span>){
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="variable">expr</span>.<span class="variable">nodes</span>.<span class="variable">length</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
    <span class="variable">expr</span>.<span class="variable">nodes</span>[<span class="variable">i</span>] = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">expr</span>.<span class="variable">nodes</span>[<span class="variable">i</span>]);
  }
  <span class="keyword">return</span> <span class="variable">expr</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Property.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitProperty</span> = <span class="keyword">function</span>(<span class="variable">prop</span>){
  <span class="keyword">var</span> <span class="variable">name</span> = <span class="variable">prop</span>.<span class="variable">name</span>
    , <span class="variable">fn</span> = <span class="this">this</span>.<span class="variable">lookup</span>(<span class="variable">name</span>)
    , <span class="variable">call</span> = <span class="variable">fn</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Function</span>
    , <span class="variable">literal</span> = ~<span class="this">this</span>.<span class="variable">calling</span>.<span class="variable">indexOf</span>(<span class="variable">name</span>);

  <span class="comment">// Function of the same name</span>
  <span class="keyword">if</span> (<span class="variable">call</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; !<span class="variable">literal</span>) {
    <span class="this">this</span>.<span class="variable">calling</span>.<span class="variable">push</span>(<span class="variable">name</span>);
    <span class="keyword">var</span> <span class="variable">ret</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Call</span>(<span class="variable">name</span>, <span class="variable">prop</span>.<span class="variable">expr</span>));
    <span class="this">this</span>.<span class="variable">calling</span>.<span class="variable">pop</span>();
    <span class="keyword">return</span> <span class="variable">ret</span>;
  <span class="comment">// Regular property</span>
  } <span class="keyword">else</span> {
    <span class="keyword">var</span> <span class="variable">_</span> = <span class="this">this</span>.<span class="keyword">return</span>;
    <span class="this">this</span>.<span class="keyword">return</span> = <span class="variable">true</span>;
    <span class="variable">prop</span>.<span class="variable">expr</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">prop</span>.<span class="variable">expr</span>);
    <span class="this">this</span>.<span class="keyword">return</span> = <span class="variable">_</span>;
    <span class="keyword">return</span> <span class="variable">prop</span>;
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Root.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitRoot</span> = <span class="keyword">function</span>(<span class="variable">block</span>){
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">block</span>.<span class="variable">nodes</span>.<span class="variable">length</span>; ++<span class="variable">i</span>) {
    <span class="this">this</span>.<span class="variable">rootIndex</span> = <span class="variable">i</span>;
    <span class="variable">block</span>.<span class="variable">nodes</span>[<span class="variable">i</span>] = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">block</span>.<span class="variable">nodes</span>[<span class="variable">i</span>]);
  }
  <span class="keyword">return</span> <span class="variable">block</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Block.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitBlock</span> = <span class="keyword">function</span>(<span class="variable">block</span>){
  <span class="keyword">if</span> (<span class="variable">block</span>.<span class="variable">scope</span>) <span class="this">this</span>.<span class="variable">stack</span>.<span class="variable">push</span>(<span class="keyword">new</span> <span class="class">Frame</span>(<span class="variable">block</span>));
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="variable">block</span>.<span class="variable">nodes</span>.<span class="variable">length</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
    <span class="variable">block</span>.<span class="variable">nodes</span>[<span class="variable">i</span>] = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">block</span>.<span class="variable">nodes</span>[<span class="variable">i</span>]);
  }
  <span class="keyword">if</span> (<span class="variable">block</span>.<span class="variable">scope</span>) <span class="this">this</span>.<span class="variable">stack</span>.<span class="variable">pop</span>();
  <span class="keyword">return</span> <span class="variable">block</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit If.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitIf</span> = <span class="keyword">function</span>(<span class="variable">node</span>){
  <span class="keyword">var</span> <span class="variable">ret</span>
    , <span class="variable">_</span> = <span class="this">this</span>.<span class="keyword">return</span>
    , <span class="variable">group</span> = <span class="this">this</span>.<span class="variable">group</span>
    , <span class="variable">negate</span> = <span class="variable">node</span>.<span class="variable">negate</span>;

  <span class="this">this</span>.<span class="keyword">return</span> = <span class="variable">true</span>;
  <span class="keyword">var</span> <span class="variable">ok</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">node</span>.<span class="variable">cond</span>).<span class="variable">first</span>.<span class="variable">toBoolean</span>();
  <span class="this">this</span>.<span class="keyword">return</span> = <span class="variable">_</span>;

  <span class="comment">// Evaluate body</span>
  <span class="keyword">if</span> (<span class="variable">negate</span>) {
    <span class="comment">// unless</span>
    <span class="keyword">if</span> (<span class="variable">nodes</span>.<span class="variable">false</span> == <span class="variable">ok</span>) {
      <span class="variable">ret</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">node</span>.<span class="variable">block</span>);
    }
  } <span class="keyword">else</span> {
    <span class="comment">// if</span>
    <span class="keyword">if</span> (<span class="variable">nodes</span>.<span class="variable">true</span> == <span class="variable">ok</span>) {
      <span class="variable">ret</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">node</span>.<span class="variable">block</span>);
    <span class="comment">// else</span>
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">node</span>.<span class="variable">elses</span>.<span class="variable">length</span>) {
      <span class="keyword">var</span> <span class="variable">elses</span> = <span class="variable">node</span>.<span class="variable">elses</span>
        , <span class="variable">len</span> = <span class="variable">elses</span>.<span class="variable">length</span>;
      <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
        <span class="comment">// else if</span>
        <span class="keyword">if</span> (<span class="variable">elses</span>[<span class="variable">i</span>].<span class="variable">cond</span>) {
          <span class="keyword">if</span> (<span class="variable">nodes</span>.<span class="variable">true</span> == <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">elses</span>[<span class="variable">i</span>].<span class="variable">cond</span>).<span class="variable">first</span>.<span class="variable">toBoolean</span>()) {
            <span class="variable">ret</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">elses</span>[<span class="variable">i</span>].<span class="variable">block</span>);
            <span class="keyword">break</span>;
          }
        <span class="comment">// else </span>
        } <span class="keyword">else</span> {
          <span class="variable">ret</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">elses</span>[<span class="variable">i</span>]);
        }
      }
    }
  }

  <span class="comment">// Selector mixin</span>
  <span class="keyword">if</span> (<span class="variable">group</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="variable">ret</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; !<span class="this">this</span>.<span class="keyword">return</span>) {
    <span class="this">this</span>.<span class="variable">mixin</span>(<span class="variable">ret</span>.<span class="variable">nodes</span>, <span class="variable">group</span>.<span class="variable">block</span>);
    <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="keyword">null</span>;
  }

  <span class="keyword">return</span> <span class="variable">ret</span> || <span class="variable">nodes</span>.<span class="keyword">null</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit Import.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">visitImport</span> = <span class="keyword">function</span>(<span class="keyword">import</span>){
  <span class="keyword">var</span> <span class="variable">found</span>
    , <span class="variable">root</span> = <span class="this">this</span>.<span class="variable">root</span>
    , <span class="variable">i</span> = <span class="this">this</span>.<span class="variable">rootIndex</span>
    , <span class="variable">stylus</span> = <span class="variable">require</span>(<span class="string">'../stylus'</span>)
    , <span class="variable">path</span> = <span class="keyword">import</span>.<span class="variable">path</span>
    , <span class="variable">relative</span> = <span class="this">this</span>.<span class="variable">importPath</span>;

  <span class="comment">// Literal</span>
  <span class="keyword">if</span> (<span class="regexp">/\.css$/</span>.<span class="variable">test</span>(<span class="variable">path</span>)) <span class="keyword">return</span> <span class="keyword">import</span>;
  <span class="variable">path</span> += <span class="string">'.styl'</span>;

  <span class="comment">// Lookup</span>
  <span class="keyword">if</span> (<span class="variable">relative</span>) <span class="this">this</span>.<span class="variable">paths</span>.<span class="variable">push</span>(<span class="variable">relative</span>);
  <span class="variable">found</span> = <span class="variable">utils</span>.<span class="variable">lookup</span>(<span class="variable">path</span>, <span class="this">this</span>.<span class="variable">paths</span>);
  <span class="keyword">if</span> (<span class="variable">relative</span>) <span class="this">this</span>.<span class="variable">paths</span>.<span class="variable">pop</span>();

  <span class="comment">// Throw if import failed</span>
  <span class="keyword">if</span> (!<span class="variable">found</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'failed to locate @import file '</span> + <span class="variable">path</span>);
  <span class="this">this</span>.<span class="variable">importPath</span> = <span class="variable">dirname</span>(<span class="variable">found</span>);

  <span class="comment">// Parse the file</span>
  <span class="keyword">var</span> <span class="variable">str</span> = <span class="variable">fs</span>.<span class="variable">readFileSync</span>(<span class="variable">found</span>, <span class="string">'utf8'</span>)
    , <span class="variable">rest</span> = <span class="variable">root</span>.<span class="variable">nodes</span>.<span class="variable">splice</span>(++<span class="variable">i</span>, <span class="variable">root</span>.<span class="variable">nodes</span>.<span class="variable">length</span>);

  <span class="variable">stylus</span>.<span class="variable">parse</span>(<span class="variable">str</span>, {
      <span class="variable">filename</span>: <span class="variable">found</span>
    , <span class="variable">root</span>: <span class="variable">root</span>
  });

  <span class="variable">rest</span>.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">node</span>){
    <span class="variable">root</span>.<span class="variable">push</span>(<span class="variable">node</span>);
  });

  <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="keyword">null</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Invoke <code>fn</code> with <code>args</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  fn</p></li><li><p><strong>param</strong>: <em>Array</em>  args</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">invokeFunction</span> = <span class="keyword">function</span>(<span class="variable">fn</span>, <span class="variable">args</span>){
  <span class="comment">// Clone the function body</span>
  <span class="comment">// to prevent mutation of subsequent calls</span>
  <span class="keyword">var</span> <span class="variable">body</span> = <span class="variable">fn</span>.<span class="variable">block</span>.<span class="variable">clone</span>();

  <span class="comment">// Inject argument scope</span>
  <span class="keyword">var</span> <span class="variable">block</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Block</span>(<span class="variable">body</span>.<span class="variable">parent</span>);
  <span class="variable">body</span>.<span class="variable">parent</span> = <span class="variable">block</span>;

  <span class="comment">// Inject arguments as locals</span>
  <span class="this">this</span>.<span class="variable">stack</span>.<span class="variable">push</span>(<span class="keyword">new</span> <span class="class">Frame</span>(<span class="variable">block</span>));
  <span class="variable">fn</span>.<span class="variable">params</span>.<span class="variable">nodes</span>.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">node</span>, <span class="variable">i</span>){
    <span class="comment">// Argument default support</span>
    <span class="keyword">var</span> <span class="variable">val</span> = <span class="variable">args</span>.<span class="variable">nodes</span>[<span class="variable">i</span>] || <span class="variable">node</span>.<span class="variable">val</span>;
    <span class="variable">node</span> = <span class="variable">node</span>.<span class="variable">clone</span>();
    <span class="variable">node</span>.<span class="variable">val</span> = <span class="variable">val</span>;

    <span class="comment">// Required argument not satisfied</span>
    <span class="keyword">if</span> (<span class="variable">node</span>.<span class="variable">val</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Null</span>) {
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'argument '</span> + <span class="variable">node</span> + <span class="string">' required for '</span> + <span class="variable">fn</span>);
    }
    <span class="this">this</span>.<span class="variable">stack</span>.<span class="variable">currentFrame</span>.<span class="variable">scope</span>.<span class="variable">add</span>(<span class="variable">node</span>);
  }, <span class="this">this</span>);

  <span class="comment">// Evaluate</span>
  <span class="variable">body</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">body</span>);
  <span class="this">this</span>.<span class="variable">stack</span>.<span class="variable">pop</span>();

  <span class="comment">// Invoke</span>
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">invoke</span>(<span class="variable">body</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Invoke built-in <code>fn</code> with <code>args</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  fn</p></li><li><p><strong>param</strong>: <em>Array</em>  args</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">invokeBuiltin</span> = <span class="keyword">function</span>(<span class="variable">fn</span>, <span class="variable">args</span>){
  <span class="comment">// Map arguments to first node</span>
  <span class="comment">// providing a nicer js api for</span>
  <span class="comment">// BIFs. Functions may specify that</span>
  <span class="comment">// they wish to accept tuples via .tuple</span>
  <span class="keyword">if</span> (<span class="variable">fn</span>.<span class="variable">tuple</span>) {
    <span class="variable">args</span> = <span class="variable">args</span>.<span class="variable">nodes</span>;
  } <span class="keyword">else</span> {
    <span class="variable">args</span> = <span class="variable">args</span>.<span class="variable">nodes</span>.<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">node</span>){
      <span class="keyword">return</span> <span class="variable">node</span>.<span class="variable">first</span>;
    });
  }

  <span class="comment">// Invoke the BIF</span>
  <span class="variable">body</span> = <span class="variable">fn</span>.<span class="variable">apply</span>(<span class="this">this</span>, <span class="variable">args</span>);

  <span class="comment">// Wrap non-expressions as an Expression,</span>
  <span class="comment">// again just providing a nicer api</span>
  <span class="comment">// to work with.</span>
  <span class="keyword">if</span> (!(<span class="variable">body</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Expression</span>)) {
    <span class="keyword">var</span> <span class="variable">expr</span> = <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Expression</span>;
    <span class="variable">expr</span>.<span class="variable">push</span>(<span class="variable">body</span>);
    <span class="variable">body</span> = <span class="variable">expr</span>;
  }

  <span class="comment">// Invoke</span>
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">invoke</span>(<span class="variable">body</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Invoke the given function <code>body</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Block</em>  body</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">invoke</span> = <span class="keyword">function</span>(<span class="variable">body</span>){
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;

  <span class="comment">// Return</span>
  <span class="keyword">if</span> (<span class="this">this</span>.<span class="keyword">return</span>) {
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">eval</span>(<span class="variable">body</span>.<span class="variable">nodes</span>);
  <span class="comment">// Mixin</span>
  } <span class="keyword">else</span> {
    <span class="this">this</span>.<span class="variable">mixin</span>(<span class="variable">body</span>.<span class="variable">nodes</span>, <span class="this">this</span>.<span class="variable">stack</span>.<span class="variable">currentFrame</span>.<span class="variable">block</span>);
    <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="keyword">null</span>;
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Mixin the given <code>nodes</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Array</em>  nodes</p></li><li><p><strong>param</strong>: <em>Block</em>  block</p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">mixin</span> = <span class="keyword">function</span>(<span class="variable">nodes</span>, <span class="variable">block</span>){
  <span class="keyword">var</span> <span class="variable">node</span>
    , <span class="variable">len</span> = <span class="variable">nodes</span>.<span class="variable">length</span>;
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
    <span class="keyword">switch</span> ((<span class="variable">node</span> = <span class="variable">nodes</span>[<span class="variable">i</span>]).<span class="variable">nodeName</span>) {
      <span class="keyword">case</span> <span class="string">'return'</span>:
        <span class="keyword">return</span>;
      <span class="keyword">case</span> <span class="string">'block'</span>:
        <span class="this">this</span>.<span class="variable">mixin</span>(<span class="variable">node</span>.<span class="variable">nodes</span>, <span class="variable">block</span>);
        <span class="keyword">break</span>;
      <span class="keyword">default</span>:
        <span class="variable">block</span>.<span class="variable">nodes</span>.<span class="variable">push</span>(<span class="variable">node</span>);
    }
  }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Evaluate the given <code>nodes</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Array</em>  nodes</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">eval</span> = <span class="keyword">function</span>(<span class="variable">nodes</span>){
  <span class="keyword">var</span> <span class="variable">node</span>
    , <span class="variable">len</span> = <span class="variable">nodes</span>.<span class="variable">length</span>;
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
    <span class="keyword">switch</span> ((<span class="variable">node</span> = <span class="variable">nodes</span>[<span class="variable">i</span>]).<span class="variable">nodeName</span>) {
      <span class="keyword">case</span> <span class="string">'return'</span>:
        <span class="keyword">return</span> <span class="variable">node</span>.<span class="variable">expr</span>;
      <span class="keyword">case</span> <span class="string">'block'</span>:
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">eval</span>(<span class="variable">node</span>.<span class="variable">nodes</span>);
    }
  }
  <span class="keyword">return</span> <span class="variable">node</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Literal function <code>call</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Call</em>  call</p></li><li><p><strong>return</strong>: <em>call</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">literalCall</span> = <span class="keyword">function</span>(<span class="variable">call</span>){
  <span class="variable">call</span>.<span class="variable">args</span> = <span class="this">this</span>.<span class="variable">visit</span>(<span class="variable">call</span>.<span class="variable">args</span>);
  <span class="keyword">return</span> <span class="variable">call</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Lookup <code>name</code>, with support for JavaScript
functions, and BIFs.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">lookup</span> = <span class="keyword">function</span>(<span class="variable">name</span>){
  <span class="keyword">var</span> <span class="variable">val</span> = <span class="this">this</span>.<span class="variable">stack</span>.<span class="variable">lookup</span>(<span class="variable">name</span>);
  <span class="keyword">if</span> (<span class="variable">val</span>) <span class="keyword">return</span> <span class="variable">val</span>;
  <span class="keyword">var</span> <span class="variable">fn</span> = <span class="this">this</span>.<span class="variable">functions</span>[<span class="variable">name</span>] || <span class="variable">bifs</span>[<span class="variable">name</span>];
  <span class="keyword">if</span> (<span class="variable">fn</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable">nodes</span>.<span class="class">Function</span>(<span class="variable">name</span>, <span class="variable">fn</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Check if the given <code>node</code> is an ident, and if it is defined.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  node</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Evaluator</span>.<span class="variable">prototype</span>.<span class="variable">isDefined</span> = <span class="keyword">function</span>(<span class="variable">node</span>){
  <span class="keyword">if</span> (<span class="variable">node</span> <span class="variable">instanceof</span> <span class="variable">nodes</span>.<span class="class">Ident</span>) {
    <span class="keyword">return</span> <span class="variable">nodes</span>.<span class="class">Boolean</span>(<span class="this">this</span>.<span class="variable">lookup</span>(<span class="variable">node</span>.<span class="variable">name</span>));
  } <span class="keyword">else</span> {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'invalid &quot;is defined&quot; check on non-variable '</span> + <span class="variable">node</span>);
  }
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/visitor/index.js"><a href="#">index</a></h2></td><td>lib/visitor/index.js</td></tr><tr class="code">
<td class="docs">
<p>Initialize a new <code>Visitor</code> with the given <code>root</code> Node.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  root</p></li><li><p><strong>api</strong>: <em>private</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Visitor</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Visitor</span>(<span class="variable">root</span>) {
  <span class="this">this</span>.<span class="variable">root</span> = <span class="variable">root</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Visit the given <code>node</code> or an array of nodes.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node | Array</em>  node</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Visitor</span>.<span class="variable">prototype</span>.<span class="variable">visit</span> = <span class="keyword">function</span>(<span class="variable">node</span>, <span class="variable">fn</span>){
  <span class="keyword">var</span> <span class="variable">method</span> = <span class="string">'visit'</span> + <span class="variable">node</span>.<span class="variable">constructor</span>.<span class="variable">name</span>
    , <span class="variable">cons</span> = <span class="this">this</span>.<span class="variable">constructor</span>.<span class="variable">name</span>;
  <span class="keyword">if</span> (!<span class="this">this</span>[<span class="variable">method</span>]) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="variable">cons</span> + <span class="string">' visitor method '</span> + <span class="variable">method</span> + <span class="string">'() not defined'</span>);
  <span class="keyword">return</span> <span class="this">this</span>[<span class="variable">method</span>](<span class="variable">node</span>);
};

</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/nodes/params.js"><a href="#">params</a></h2></td><td>lib/nodes/params.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Node</span> = <span class="variable">require</span>(<span class="string">'./node'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Params</code> with <code>name</code>, <code>params</code>, and <code>body</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>param</strong>: <em>Params</em>  params</p></li><li><p><strong>param</strong>: <em>Expression</em>  body</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Params</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Params</span>(){
  <span class="class">Node</span>.<span class="variable">call</span>(<span class="this">this</span>);
  <span class="this">this</span>.<span class="variable">nodes</span> = [];
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Check function arity.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Params</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'length'</span>, <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">nodes</span>.<span class="variable">length</span>;
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>Node.prototype</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Params</span>.<span class="variable">prototype</span>.<span class="variable">__proto__</span> = <span class="class">Node</span>.<span class="variable">prototype</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Push the given <code>node</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Node</em>  node</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Params</span>.<span class="variable">prototype</span>.<span class="variable">push</span> = <span class="keyword">function</span>(<span class="variable">node</span>){
  <span class="this">this</span>.<span class="variable">nodes</span>.<span class="variable">push</span>(<span class="variable">node</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return a clone of this node.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Node</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Params</span>.<span class="variable">prototype</span>.<span class="variable">clone</span> = <span class="keyword">function</span>(){
  <span class="keyword">var</span> <span class="variable">clone</span> = <span class="keyword">new</span> <span class="class">Params</span>;
  <span class="variable">clone</span>.<span class="variable">lineno</span> = <span class="this">this</span>.<span class="variable">lineno</span>;
  <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="this">this</span>.<span class="variable">length</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
    <span class="variable">clone</span>.<span class="variable">push</span>(<span class="this">this</span>.<span class="variable">nodes</span>[<span class="variable">i</span>].<span class="variable">clone</span>());
  }
  <span class="keyword">return</span> <span class="variable">clone</span>;
};

</code></pre>
</td>
</tr>	</body>
</html></tbody></table>